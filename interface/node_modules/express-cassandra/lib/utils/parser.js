'use strict';

var Promise = require('bluebird');
var _ = require('lodash');
var util = require('util');

var dseDriver = void 0;
try {
  // eslint-disable-next-line import/no-extraneous-dependencies, import/no-unresolved
  dseDriver = require('dse-driver');
} catch (e) {
  dseDriver = null;
}

var cql = Promise.promisifyAll(dseDriver || require('cassandra-driver'));

var buildError = require('../orm/apollo_error.js');
var datatypes = require('../validators/datatypes');
var schemer = require('../validators/schema');

var parser = {};

parser.callback_or_throw = function f(err, callback) {
  if (typeof callback === 'function') {
    callback(err);
    return;
  }
  throw err;
};

parser.extract_type = function f(val) {
  // decompose composite types
  var decomposed = val ? val.replace(/[\s]/g, '').split(/[<,>]/g) : [''];

  for (var d = 0; d < decomposed.length; d++) {
    if (_.has(datatypes, decomposed[d])) {
      return decomposed[d];
    }
  }

  return val;
};

parser.extract_typeDef = function f(val) {
  // decompose composite types
  var decomposed = val ? val.replace(/[\s]/g, '') : '';
  decomposed = decomposed.substr(decomposed.indexOf('<'), decomposed.length - decomposed.indexOf('<'));

  return decomposed;
};

parser.extract_altered_type = function f(normalizedModelSchema, diff) {
  var fieldName = diff.path[0];
  var type = '';
  if (diff.path.length > 1) {
    if (diff.path[1] === 'type') {
      type = diff.rhs;
      if (normalizedModelSchema.fields[fieldName].typeDef) {
        type += normalizedModelSchema.fields[fieldName].typeDef;
      }
    } else {
      type = normalizedModelSchema.fields[fieldName].type;
      type += diff.rhs;
    }
  } else {
    type = diff.rhs.type;
    if (diff.rhs.typeDef) type += diff.rhs.typeDef;
  }
  return type;
};

parser.get_db_value_expression = function f(schema, fieldName, fieldValue) {
  if (fieldValue == null || fieldValue === cql.types.unset) {
    return { query_segment: '?', parameter: fieldValue };
  }

  if (_.isPlainObject(fieldValue) && fieldValue.$db_function) {
    return fieldValue.$db_function;
  }

  var fieldType = schemer.get_field_type(schema, fieldName);
  var validators = schemer.get_validators(schema, fieldName);

  if (_.isArray(fieldValue) && fieldType !== 'list' && fieldType !== 'set' && fieldType !== 'frozen') {
    var val = fieldValue.map(function (v) {
      var dbVal = parser.get_db_value_expression(schema, fieldName, v);

      if (_.isPlainObject(dbVal) && dbVal.query_segment) return dbVal.parameter;
      return dbVal;
    });

    return { query_segment: '?', parameter: val };
  }

  var validationMessage = schemer.get_validation_message(validators, fieldValue);
  if (typeof validationMessage === 'function') {
    throw buildError('model.validator.invalidvalue', validationMessage(fieldValue, fieldName, fieldType));
  }

  if (fieldType === 'counter') {
    var counterQuerySegment = util.format('"%s"', fieldName);
    if (fieldValue >= 0) counterQuerySegment += ' + ?';else counterQuerySegment += ' - ?';
    fieldValue = Math.abs(fieldValue);
    return { query_segment: counterQuerySegment, parameter: fieldValue };
  }

  return { query_segment: '?', parameter: fieldValue };
};

parser.unset_not_allowed = function f(operation, schema, fieldName, callback) {
  if (schemer.is_primary_key_field(schema, fieldName)) {
    parser.callback_or_throw(buildError(`model.${operation}.unsetkey`, fieldName), callback);
    return true;
  }
  if (schemer.is_required_field(schema, fieldName)) {
    parser.callback_or_throw(buildError(`model.${operation}.unsetrequired`, fieldName), callback);
    return true;
  }
  return false;
};

parser.get_inplace_update_expression = function f(schema, fieldName, fieldValue, updateClauses, queryParams) {
  var $add = _.isPlainObject(fieldValue) && fieldValue.$add || false;
  var $append = _.isPlainObject(fieldValue) && fieldValue.$append || false;
  var $prepend = _.isPlainObject(fieldValue) && fieldValue.$prepend || false;
  var $replace = _.isPlainObject(fieldValue) && fieldValue.$replace || false;
  var $remove = _.isPlainObject(fieldValue) && fieldValue.$remove || false;

  fieldValue = $add || $append || $prepend || $replace || $remove || fieldValue;

  var dbVal = parser.get_db_value_expression(schema, fieldName, fieldValue);

  if (!_.isPlainObject(dbVal) || !dbVal.query_segment) {
    updateClauses.push(util.format('"%s"=%s', fieldName, dbVal));
    return;
  }

  var fieldType = schemer.get_field_type(schema, fieldName);

  if (['map', 'list', 'set'].includes(fieldType)) {
    if ($add || $append) {
      dbVal.query_segment = util.format('"%s" + %s', fieldName, dbVal.query_segment);
    } else if ($prepend) {
      if (fieldType === 'list') {
        dbVal.query_segment = util.format('%s + "%s"', dbVal.query_segment, fieldName);
      } else {
        throw buildError('model.update.invalidprependop', util.format('%s datatypes does not support $prepend, use $add instead', fieldType));
      }
    } else if ($remove) {
      dbVal.query_segment = util.format('"%s" - %s', fieldName, dbVal.query_segment);
      if (fieldType === 'map') dbVal.parameter = Object.keys(dbVal.parameter);
    }
  }

  if ($replace) {
    if (fieldType === 'map') {
      updateClauses.push(util.format('"%s"[?]=%s', fieldName, dbVal.query_segment));
      var replaceKeys = Object.keys(dbVal.parameter);
      var replaceValues = _.values(dbVal.parameter);
      if (replaceKeys.length === 1) {
        queryParams.push(replaceKeys[0]);
        queryParams.push(replaceValues[0]);
      } else {
        throw buildError('model.update.invalidreplaceop', '$replace in map does not support more than one item');
      }
    } else if (fieldType === 'list') {
      updateClauses.push(util.format('"%s"[?]=%s', fieldName, dbVal.query_segment));
      if (dbVal.parameter.length === 2) {
        queryParams.push(dbVal.parameter[0]);
        queryParams.push(dbVal.parameter[1]);
      } else {
        throw buildError('model.update.invalidreplaceop', '$replace in list should have exactly 2 items, first one as the index and the second one as the value');
      }
    } else {
      throw buildError('model.update.invalidreplaceop', util.format('%s datatypes does not support $replace', fieldType));
    }
  } else {
    updateClauses.push(util.format('"%s"=%s', fieldName, dbVal.query_segment));
    queryParams.push(dbVal.parameter);
  }
};

parser.get_update_value_expression = function f(instance, schema, updateValues, callback) {
  var updateClauses = [];
  var queryParams = [];

  if (schema.options && schema.options.timestamps) {
    if (!updateValues[schema.options.timestamps.updatedAt]) {
      updateValues[schema.options.timestamps.updatedAt] = { $db_function: 'toTimestamp(now())' };
    }
  }

  if (schema.options && schema.options.versions) {
    if (!updateValues[schema.options.versions.key]) {
      updateValues[schema.options.versions.key] = { $db_function: 'now()' };
    }
  }

  var errorHappened = Object.keys(updateValues).some(function (fieldName) {
    if (schema.fields[fieldName] === undefined || schema.fields[fieldName].virtual) return false;

    var fieldType = schemer.get_field_type(schema, fieldName);
    var fieldValue = updateValues[fieldName];

    if (fieldValue === undefined) {
      fieldValue = instance._get_default_value(fieldName);
      if (fieldValue === undefined) {
        return parser.unset_not_allowed('update', schema, fieldName, callback);
      } else if (!schema.fields[fieldName].rule || !schema.fields[fieldName].rule.ignore_default) {
        // did set a default value, ignore default is not set
        if (instance.validate(fieldName, fieldValue) !== true) {
          parser.callback_or_throw(buildError('model.update.invaliddefaultvalue', fieldValue, fieldName, fieldType), callback);
          return true;
        }
      }
    }

    if (fieldValue === null || fieldValue === cql.types.unset) {
      if (parser.unset_not_allowed('update', schema, fieldName, callback)) {
        return true;
      }
    }

    try {
      parser.get_inplace_update_expression(schema, fieldName, fieldValue, updateClauses, queryParams);
    } catch (e) {
      parser.callback_or_throw(e, callback);
      return true;
    }
    return false;
  });

  return { updateClauses, queryParams, errorHappened };
};

parser.get_save_value_expression = function fn(instance, schema, callback) {
  var identifiers = [];
  var values = [];
  var queryParams = [];

  if (schema.options && schema.options.timestamps) {
    if (instance[schema.options.timestamps.updatedAt]) {
      instance[schema.options.timestamps.updatedAt] = { $db_function: 'toTimestamp(now())' };
    }
  }

  if (schema.options && schema.options.versions) {
    if (instance[schema.options.versions.key]) {
      instance[schema.options.versions.key] = { $db_function: 'now()' };
    }
  }

  var errorHappened = Object.keys(schema.fields).some(function (fieldName) {
    if (schema.fields[fieldName].virtual) return false;

    // check field value
    var fieldType = schemer.get_field_type(schema, fieldName);
    var fieldValue = instance[fieldName];

    if (fieldValue === undefined) {
      fieldValue = instance._get_default_value(fieldName);
      if (fieldValue === undefined) {
        return parser.unset_not_allowed('save', schema, fieldName, callback);
      } else if (!schema.fields[fieldName].rule || !schema.fields[fieldName].rule.ignore_default) {
        // did set a default value, ignore default is not set
        if (instance.validate(fieldName, fieldValue) !== true) {
          parser.callback_or_throw(buildError('model.save.invaliddefaultvalue', fieldValue, fieldName, fieldType), callback);
          return true;
        }
      }
    }

    if (fieldValue === null || fieldValue === cql.types.unset) {
      if (parser.unset_not_allowed('save', schema, fieldName, callback)) {
        return true;
      }
    }

    identifiers.push(util.format('"%s"', fieldName));

    try {
      var dbVal = parser.get_db_value_expression(schema, fieldName, fieldValue);
      if (_.isPlainObject(dbVal) && dbVal.query_segment) {
        values.push(dbVal.query_segment);
        queryParams.push(dbVal.parameter);
      } else {
        values.push(dbVal);
      }
    } catch (e) {
      parser.callback_or_throw(e, callback);
      return true;
    }
    return false;
  });

  return {
    identifiers,
    values,
    queryParams,
    errorHappened
  };
};

parser.extract_query_relations = function f(fieldName, relationKey, relationValue, schema, validOperators) {
  var queryRelations = [];
  var queryParams = [];

  if (!_.has(validOperators, relationKey.toLowerCase())) {
    throw buildError('model.find.invalidop', relationKey);
  }

  relationKey = relationKey.toLowerCase();
  if (relationKey === '$in' && !_.isArray(relationValue)) {
    throw buildError('model.find.invalidinop');
  }
  if (relationKey === '$token' && !(relationValue instanceof Object)) {
    throw buildError('model.find.invalidtoken');
  }

  var operator = validOperators[relationKey];
  var whereTemplate = '"%s" %s %s';

  var buildQueryRelations = function buildQueryRelations(fieldNameLocal, relationValueLocal) {
    var dbVal = parser.get_db_value_expression(schema, fieldNameLocal, relationValueLocal);
    if (_.isPlainObject(dbVal) && dbVal.query_segment) {
      queryRelations.push(util.format(whereTemplate, fieldNameLocal, operator, dbVal.query_segment));
      queryParams.push(dbVal.parameter);
    } else {
      queryRelations.push(util.format(whereTemplate, fieldNameLocal, operator, dbVal));
    }
  };

  var buildTokenQueryRelations = function buildTokenQueryRelations(tokenRelationKey, tokenRelationValue) {
    tokenRelationKey = tokenRelationKey.toLowerCase();
    if (_.has(validOperators, tokenRelationKey) && tokenRelationKey !== '$token' && tokenRelationKey !== '$in') {
      operator = validOperators[tokenRelationKey];
    } else {
      throw buildError('model.find.invalidtokenop', tokenRelationKey);
    }

    if (_.isArray(tokenRelationValue)) {
      var tokenKeys = fieldName.split(',');
      for (var tokenIndex = 0; tokenIndex < tokenRelationValue.length; tokenIndex++) {
        tokenKeys[tokenIndex] = tokenKeys[tokenIndex].trim();
        var dbVal = parser.get_db_value_expression(schema, tokenKeys[tokenIndex], tokenRelationValue[tokenIndex]);
        if (_.isPlainObject(dbVal) && dbVal.query_segment) {
          tokenRelationValue[tokenIndex] = dbVal.query_segment;
          queryParams.push(dbVal.parameter);
        } else {
          tokenRelationValue[tokenIndex] = dbVal;
        }
      }
      queryRelations.push(util.format(whereTemplate, tokenKeys.join('","'), operator, tokenRelationValue.toString()));
    } else {
      buildQueryRelations(fieldName, tokenRelationValue);
    }
  };

  if (relationKey === '$token') {
    whereTemplate = 'token("%s") %s token(%s)';

    var tokenRelationKeys = Object.keys(relationValue);
    for (var tokenRK = 0; tokenRK < tokenRelationKeys.length; tokenRK++) {
      var tokenRelationKey = tokenRelationKeys[tokenRK];
      var tokenRelationValue = relationValue[tokenRelationKey];
      buildTokenQueryRelations(tokenRelationKey, tokenRelationValue);
    }
  } else if (relationKey === '$contains') {
    var fieldType1 = schemer.get_field_type(schema, fieldName);
    if (['map', 'list', 'set', 'frozen'].includes(fieldType1)) {
      if (fieldType1 === 'map' && _.isPlainObject(relationValue)) {
        Object.keys(relationValue).forEach(function (key) {
          queryRelations.push(util.format('"%s"[%s] %s %s', fieldName, '?', '=', '?'));
          queryParams.push(key);
          queryParams.push(relationValue[key]);
        });
      } else {
        queryRelations.push(util.format(whereTemplate, fieldName, operator, '?'));
        queryParams.push(relationValue);
      }
    } else {
      throw buildError('model.find.invalidcontainsop');
    }
  } else if (relationKey === '$contains_key') {
    var fieldType2 = schemer.get_field_type(schema, fieldName);
    if (fieldType2 !== 'map') {
      throw buildError('model.find.invalidcontainskeyop');
    }
    queryRelations.push(util.format(whereTemplate, fieldName, operator, '?'));
    queryParams.push(relationValue);
  } else {
    buildQueryRelations(fieldName, relationValue);
  }
  return { queryRelations, queryParams };
};

parser._parse_query_object = function f(schema, queryObject) {
  var queryRelations = [];
  var queryParams = [];

  Object.keys(queryObject).forEach(function (fieldName) {
    if (fieldName.startsWith('$')) {
      // search queries based on lucene index or solr
      // escape all single quotes for queries in cassandra
      if (fieldName === '$expr') {
        if (typeof queryObject[fieldName].index === 'string' && typeof queryObject[fieldName].query === 'string') {
          queryRelations.push(util.format("expr(%s,'%s')", queryObject[fieldName].index, queryObject[fieldName].query.replace(/'/g, "''")));
        } else {
          throw buildError('model.find.invalidexpr');
        }
      } else if (fieldName === '$solr_query') {
        if (typeof queryObject[fieldName] === 'string') {
          queryRelations.push(util.format("solr_query='%s'", queryObject[fieldName].replace(/'/g, "''")));
        } else {
          throw buildError('model.find.invalidsolrquery');
        }
      }
      return;
    }

    var whereObject = queryObject[fieldName];
    // Array of operators
    if (!_.isArray(whereObject)) whereObject = [whereObject];

    for (var fk = 0; fk < whereObject.length; fk++) {
      var fieldRelation = whereObject[fk];

      var cqlOperators = {
        $eq: '=',
        $ne: '!=',
        $gt: '>',
        $lt: '<',
        $gte: '>=',
        $lte: '<=',
        $in: 'IN',
        $like: 'LIKE',
        $token: 'token',
        $contains: 'CONTAINS',
        $contains_key: 'CONTAINS KEY'
      };

      if (_.isPlainObject(fieldRelation)) {
        var validKeys = Object.keys(cqlOperators);
        var fieldRelationKeys = Object.keys(fieldRelation);
        for (var i = 0; i < fieldRelationKeys.length; i++) {
          if (!validKeys.includes(fieldRelationKeys[i])) {
            // field relation key invalid, apply default $eq operator
            fieldRelation = { $eq: fieldRelation };
            break;
          }
        }
      } else {
        fieldRelation = { $eq: fieldRelation };
      }

      var relationKeys = Object.keys(fieldRelation);
      for (var rk = 0; rk < relationKeys.length; rk++) {
        var relationKey = relationKeys[rk];
        var relationValue = fieldRelation[relationKey];
        var extractedRelations = parser.extract_query_relations(fieldName, relationKey, relationValue, schema, cqlOperators);
        queryRelations = queryRelations.concat(extractedRelations.queryRelations);
        queryParams = queryParams.concat(extractedRelations.queryParams);
      }
    }
  });

  return { queryRelations, queryParams };
};

parser.get_where_clause = function f(schema, queryObject) {
  var parsedObject = parser._parse_query_object(schema, queryObject);
  var whereClause = {};
  if (parsedObject.queryRelations.length > 0) {
    whereClause.query = util.format('WHERE %s', parsedObject.queryRelations.join(' AND '));
  } else {
    whereClause.query = '';
  }
  whereClause.params = parsedObject.queryParams;
  return whereClause;
};

parser.get_if_clause = function f(schema, queryObject) {
  var parsedObject = parser._parse_query_object(schema, queryObject);
  var ifClause = {};
  if (parsedObject.queryRelations.length > 0) {
    ifClause.query = util.format('IF %s', parsedObject.queryRelations.join(' AND '));
  } else {
    ifClause.query = '';
  }
  ifClause.params = parsedObject.queryParams;
  return ifClause;
};

parser.get_orderby_clause = function f(queryObject) {
  var orderKeys = [];
  Object.keys(queryObject).forEach(function (k) {
    var queryItem = queryObject[k];
    if (k.toLowerCase() === '$orderby') {
      if (!(queryItem instanceof Object)) {
        throw buildError('model.find.invalidorder');
      }
      var orderItemKeys = Object.keys(queryItem);

      for (var i = 0; i < orderItemKeys.length; i++) {
        var cqlOrderDirection = { $asc: 'ASC', $desc: 'DESC' };
        if (orderItemKeys[i].toLowerCase() in cqlOrderDirection) {
          var orderFields = queryItem[orderItemKeys[i]];

          if (!_.isArray(orderFields)) {
            orderFields = [orderFields];
          }

          for (var j = 0; j < orderFields.length; j++) {
            orderKeys.push(util.format('"%s" %s', orderFields[j], cqlOrderDirection[orderItemKeys[i]]));
          }
        } else {
          throw buildError('model.find.invalidordertype', orderItemKeys[i]);
        }
      }
    }
  });
  return orderKeys.length ? util.format('ORDER BY %s', orderKeys.join(', ')) : ' ';
};

parser.get_limit_clause = function f(queryObject) {
  var limit = null;
  Object.keys(queryObject).forEach(function (k) {
    var queryItem = queryObject[k];
    if (k.toLowerCase() === '$limit') {
      if (typeof queryItem !== 'number') throw buildError('model.find.limittype');
      limit = queryItem;
    }
  });
  return limit ? util.format('LIMIT %s', limit) : ' ';
};

parser.get_select_clause = function f(options) {
  var selectClause = '*';
  if (options.select && _.isArray(options.select) && options.select.length > 0) {
    var selectArray = [];
    for (var i = 0; i < options.select.length; i++) {
      // separate the aggregate function and the column name if select is an aggregate function
      var selection = options.select[i].split(/[( )]/g).filter(function (e) {
        return e;
      });
      if (selection.length === 1) {
        selectArray.push(util.format('"%s"', selection[0]));
      } else if (selection.length === 2 || selection.length === 4) {
        var functionClause = util.format('%s("%s")', selection[0], selection[1]);
        if (selection[2]) functionClause += util.format(' %s', selection[2]);
        if (selection[3]) functionClause += util.format(' %s', selection[3]);

        selectArray.push(functionClause);
      } else if (selection.length === 3) {
        selectArray.push(util.format('"%s" %s %s', selection[0], selection[1], selection[2]));
      } else {
        selectArray.push('*');
      }
    }
    selectClause = selectArray.join(',');
  }
  return selectClause;
};

module.exports = parser;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9wYXJzZXIuanMiXSwibmFtZXMiOlsiUHJvbWlzZSIsInJlcXVpcmUiLCJfIiwidXRpbCIsImRzZURyaXZlciIsImUiLCJjcWwiLCJwcm9taXNpZnlBbGwiLCJidWlsZEVycm9yIiwiZGF0YXR5cGVzIiwic2NoZW1lciIsInBhcnNlciIsImNhbGxiYWNrX29yX3Rocm93IiwiZiIsImVyciIsImNhbGxiYWNrIiwiZXh0cmFjdF90eXBlIiwidmFsIiwiZGVjb21wb3NlZCIsInJlcGxhY2UiLCJzcGxpdCIsImQiLCJsZW5ndGgiLCJoYXMiLCJleHRyYWN0X3R5cGVEZWYiLCJzdWJzdHIiLCJpbmRleE9mIiwiZXh0cmFjdF9hbHRlcmVkX3R5cGUiLCJub3JtYWxpemVkTW9kZWxTY2hlbWEiLCJkaWZmIiwiZmllbGROYW1lIiwicGF0aCIsInR5cGUiLCJyaHMiLCJmaWVsZHMiLCJ0eXBlRGVmIiwiZ2V0X2RiX3ZhbHVlX2V4cHJlc3Npb24iLCJzY2hlbWEiLCJmaWVsZFZhbHVlIiwidHlwZXMiLCJ1bnNldCIsInF1ZXJ5X3NlZ21lbnQiLCJwYXJhbWV0ZXIiLCJpc1BsYWluT2JqZWN0IiwiJGRiX2Z1bmN0aW9uIiwiZmllbGRUeXBlIiwiZ2V0X2ZpZWxkX3R5cGUiLCJ2YWxpZGF0b3JzIiwiZ2V0X3ZhbGlkYXRvcnMiLCJpc0FycmF5IiwibWFwIiwidiIsImRiVmFsIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJnZXRfdmFsaWRhdGlvbl9tZXNzYWdlIiwiY291bnRlclF1ZXJ5U2VnbWVudCIsImZvcm1hdCIsIk1hdGgiLCJhYnMiLCJ1bnNldF9ub3RfYWxsb3dlZCIsIm9wZXJhdGlvbiIsImlzX3ByaW1hcnlfa2V5X2ZpZWxkIiwiaXNfcmVxdWlyZWRfZmllbGQiLCJnZXRfaW5wbGFjZV91cGRhdGVfZXhwcmVzc2lvbiIsInVwZGF0ZUNsYXVzZXMiLCJxdWVyeVBhcmFtcyIsIiRhZGQiLCIkYXBwZW5kIiwiJHByZXBlbmQiLCIkcmVwbGFjZSIsIiRyZW1vdmUiLCJwdXNoIiwiaW5jbHVkZXMiLCJPYmplY3QiLCJrZXlzIiwicmVwbGFjZUtleXMiLCJyZXBsYWNlVmFsdWVzIiwidmFsdWVzIiwiZ2V0X3VwZGF0ZV92YWx1ZV9leHByZXNzaW9uIiwiaW5zdGFuY2UiLCJ1cGRhdGVWYWx1ZXMiLCJvcHRpb25zIiwidGltZXN0YW1wcyIsInVwZGF0ZWRBdCIsInZlcnNpb25zIiwia2V5IiwiZXJyb3JIYXBwZW5lZCIsInNvbWUiLCJ1bmRlZmluZWQiLCJ2aXJ0dWFsIiwiX2dldF9kZWZhdWx0X3ZhbHVlIiwicnVsZSIsImlnbm9yZV9kZWZhdWx0IiwidmFsaWRhdGUiLCJnZXRfc2F2ZV92YWx1ZV9leHByZXNzaW9uIiwiZm4iLCJpZGVudGlmaWVycyIsImV4dHJhY3RfcXVlcnlfcmVsYXRpb25zIiwicmVsYXRpb25LZXkiLCJyZWxhdGlvblZhbHVlIiwidmFsaWRPcGVyYXRvcnMiLCJxdWVyeVJlbGF0aW9ucyIsInRvTG93ZXJDYXNlIiwib3BlcmF0b3IiLCJ3aGVyZVRlbXBsYXRlIiwiYnVpbGRRdWVyeVJlbGF0aW9ucyIsImZpZWxkTmFtZUxvY2FsIiwicmVsYXRpb25WYWx1ZUxvY2FsIiwiYnVpbGRUb2tlblF1ZXJ5UmVsYXRpb25zIiwidG9rZW5SZWxhdGlvbktleSIsInRva2VuUmVsYXRpb25WYWx1ZSIsInRva2VuS2V5cyIsInRva2VuSW5kZXgiLCJ0cmltIiwiam9pbiIsInRvU3RyaW5nIiwidG9rZW5SZWxhdGlvbktleXMiLCJ0b2tlblJLIiwiZmllbGRUeXBlMSIsImZvckVhY2giLCJmaWVsZFR5cGUyIiwiX3BhcnNlX3F1ZXJ5X29iamVjdCIsInF1ZXJ5T2JqZWN0Iiwic3RhcnRzV2l0aCIsImluZGV4IiwicXVlcnkiLCJ3aGVyZU9iamVjdCIsImZrIiwiZmllbGRSZWxhdGlvbiIsImNxbE9wZXJhdG9ycyIsIiRlcSIsIiRuZSIsIiRndCIsIiRsdCIsIiRndGUiLCIkbHRlIiwiJGluIiwiJGxpa2UiLCIkdG9rZW4iLCIkY29udGFpbnMiLCIkY29udGFpbnNfa2V5IiwidmFsaWRLZXlzIiwiZmllbGRSZWxhdGlvbktleXMiLCJpIiwicmVsYXRpb25LZXlzIiwicmsiLCJleHRyYWN0ZWRSZWxhdGlvbnMiLCJjb25jYXQiLCJnZXRfd2hlcmVfY2xhdXNlIiwicGFyc2VkT2JqZWN0Iiwid2hlcmVDbGF1c2UiLCJwYXJhbXMiLCJnZXRfaWZfY2xhdXNlIiwiaWZDbGF1c2UiLCJnZXRfb3JkZXJieV9jbGF1c2UiLCJvcmRlcktleXMiLCJrIiwicXVlcnlJdGVtIiwib3JkZXJJdGVtS2V5cyIsImNxbE9yZGVyRGlyZWN0aW9uIiwiJGFzYyIsIiRkZXNjIiwib3JkZXJGaWVsZHMiLCJqIiwiZ2V0X2xpbWl0X2NsYXVzZSIsImxpbWl0IiwiZ2V0X3NlbGVjdF9jbGF1c2UiLCJzZWxlY3RDbGF1c2UiLCJzZWxlY3QiLCJzZWxlY3RBcnJheSIsInNlbGVjdGlvbiIsImZpbHRlciIsImZ1bmN0aW9uQ2xhdXNlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxVQUFVQyxRQUFRLFVBQVIsQ0FBaEI7QUFDQSxJQUFNQyxJQUFJRCxRQUFRLFFBQVIsQ0FBVjtBQUNBLElBQU1FLE9BQU9GLFFBQVEsTUFBUixDQUFiOztBQUVBLElBQUlHLGtCQUFKO0FBQ0EsSUFBSTtBQUNGO0FBQ0FBLGNBQVlILFFBQVEsWUFBUixDQUFaO0FBQ0QsQ0FIRCxDQUdFLE9BQU9JLENBQVAsRUFBVTtBQUNWRCxjQUFZLElBQVo7QUFDRDs7QUFFRCxJQUFNRSxNQUFNTixRQUFRTyxZQUFSLENBQXFCSCxhQUFhSCxRQUFRLGtCQUFSLENBQWxDLENBQVo7O0FBRUEsSUFBTU8sYUFBYVAsUUFBUSx3QkFBUixDQUFuQjtBQUNBLElBQU1RLFlBQVlSLFFBQVEseUJBQVIsQ0FBbEI7QUFDQSxJQUFNUyxVQUFVVCxRQUFRLHNCQUFSLENBQWhCOztBQUVBLElBQU1VLFNBQVMsRUFBZjs7QUFFQUEsT0FBT0MsaUJBQVAsR0FBMkIsU0FBU0MsQ0FBVCxD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S0FBS3FELE1BQUwsQ0FBWSxZQUFaLEVBQTBCa0gsVUFBVSxDQUFWLENBQTFCLEVBQXdDQSxVQUFVLENBQVYsQ0FBeEMsRUFBc0RBLFVBQVUsQ0FBVixDQUF0RCxDQUFqQjtBQUNELE9BRk0sTUFFQTtBQUNMRCxvQkFBWWxHLElBQVosQ0FBaUIsR0FBakI7QUFDRDtBQUNGO0FBQ0RnRyxtQkFBZUUsWUFBWXZELElBQVosQ0FBaUIsR0FBakIsQ0FBZjtBQUNEO0FBQ0QsU0FBT3FELFlBQVA7QUFDRCxDQXhCRDs7QUEwQkFNLE9BQU9DLE9BQVAsR0FBaUJuSyxNQUFqQiIsImZpbGUiOiJwYXJzZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBQcm9taXNlID0gcmVxdWlyZSgnYmx1ZWJpcmQnKTtcbmNvbnN0IF8gPSByZXF1aXJlKCdsb2Rhc2gnKTtcbmNvbnN0IHV0aWwgPSByZXF1aXJlKCd1dGlsJyk7XG5cbmxldCBkc2VEcml2ZXI7XG50cnkge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgaW1wb3J0L25vLWV4dHJhbmVvdXMtZGVwZW5kZW5jaWVzLCBpbXBvcnQvbm8tdW5yZXNvbHZlZFxuICBkc2VEcml2ZXIgPSByZXF1aXJlKCdkc2UtZHJpdmVyJyk7XG59IGNhdGNoIChlKSB7XG4gIGRzZURyaXZlciA9IG51bGw7XG59XG5cbmNvbnN0IGNxbCA9IFByb21pc2UucHJvbWlzaWZ5QWxsKGRzZURyaXZlciB8fCByZXF1aXJlKCdjYXNzYW5kcmEtZHJpdmVyJykpO1xuXG5jb25zdCBidWlsZEVycm9yID0gcmVxdWlyZSgnLi4vb3JtL2Fwb2xsb19lcnJvci5qcycpO1xuY29uc3QgZGF0YXR5cGVzID0gcmVxdWlyZSgnLi4vdmFsaWRhdG9ycy9kYXRhdHlwZXMnKTtcbmNvbnN0IHNjaGVtZXIgPSByZXF1aXJlKCcuLi92YWxpZGF0b3JzL3NjaGVtYScpO1xuXG5jb25zdCBwYXJzZXIgPSB7fTtcblxucGFyc2VyLmNhbGxiYWNrX29yX3Rocm93ID0gZnVuY3Rpb24gZihlcnIsIGNhbGxiYWNrKSB7XG4gIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICBjYWxsYmFjayhlcnIpO1xuICAgIHJldHVybjtcbiAgfVxuICB0aHJvdyAoZXJyKTtcbn07XG5cbnBhcnNlci5leHRyYWN0X3R5cGUgPSBmdW5jdGlvbiBmKHZhbCkge1xuICAvLyBkZWNvbXBvc2UgY29tcG9zaXRlIHR5cGVzXG4gIGNvbnN0IGRlY29tcG9zZWQgPSB2YWwgPyB2YWwucmVwbGFjZSgvW1xcc10vZywgJycpLnNwbGl0KC9bPCw+XS9nKSA6IFsnJ107XG5cbiAgZm9yIChsZXQgZCA9IDA7IGQgPCBkZWNvbXBvc2VkLmxlbmd0aDsgZCsrKSB7XG4gICAgaWYgKF8uaGFzKGRhdGF0eXBlcywgZGVjb21wb3NlZFtkXSkpIHtcbiAgICAgIHJldHVybiBkZWNvbXBvc2VkW2RdO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB2YWw7XG59O1xuXG5wYXJzZXIuZXh0cmFjdF90eXBlRGVmID0gZnVuY3Rpb24gZih2YWwpIHtcbiAgLy8gZGVjb21wb3NlIGNvbXBvc2l0ZSB0eXBlc1xuICBsZXQgZGVjb21wb3NlZCA9IHZhbCA/IHZhbC5yZXBsYWNlKC9bXFxzXS9nLCAnJykgOiAnJztcbiAgZGVjb21wb3NlZCA9IGRlY29tcG9zZWQuc3Vic3RyKGRlY29tcG9zZWQuaW5kZXhPZignPCcpLCBkZWNvbXBvc2VkLmxlbmd0aCAtIGRlY29tcG9zZWQuaW5kZXhPZignPCcpKTtcblxuICByZXR1cm4gZGVjb21wb3NlZDtcbn07XG5cbnBhcnNlci5leHRyYWN0X2FsdGVyZWRfdHlwZSA9IGZ1bmN0aW9uIGYobm9ybWFsaXplZE1vZGVsU2NoZW1hLCBkaWZmKSB7XG4gIGNvbnN0IGZpZWxkTmFtZSA9IGRpZmYucGF0aFswXTtcbiAgbGV0IHR5cGUgPSAnJztcbiAgaWYgKGRpZmYucGF0aC5sZW5ndGggPiAxKSB7XG4gICAgaWYgKGRpZmYucGF0aFsxXSA9PT0gJ3R5cGUnKSB7XG4gICAgICB0eXBlID0gZGlmZi5yaHM7XG4gICAgICBpZiAobm9ybWFsaXplZE1vZGVsU2NoZW1hLmZpZWxkc1tmaWVsZE5hbWVdLnR5cGVEZWYpIHtcbiAgICAgICAgdHlwZSArPSBub3JtYWxpemVkTW9kZWxTY2hlbWEuZmllbGRzW2ZpZWxkTmFtZV0udHlwZURlZjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdHlwZSA9IG5vcm1hbGl6ZWRNb2RlbFNjaGVtYS5maWVsZHNbZmllbGROYW1lXS50eXBlO1xuICAgICAgdHlwZSArPSBkaWZmLnJocztcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdHlwZSA9IGRpZmYucmhzLnR5cGU7XG4gICAgaWYgKGRpZmYucmhzLnR5cGVEZWYpIHR5cGUgKz0gZGlmZi5yaHMudHlwZURlZjtcbiAgfVxuICByZXR1cm4gdHlwZTtcbn07XG5cbnBhcnNlci5nZXRfZGJfdmFsdWVfZXhwcmVzc2lvbiA9IGZ1bmN0aW9uIGYoc2NoZW1hLCBmaWVsZE5hbWUsIGZpZWxkVmFsdWUpIHtcbiAgaWYgKGZpZWxkVmFsdWUgPT0gbnVsbCB8fCBmaWVsZFZhbHVlID09PSBjcWwudHlwZXMudW5zZXQpIHtcbiAgICByZXR1cm4geyBxdWVyeV9zZWdtZW50OiAnPycsIHBhcmFtZXRlcjogZmllbGRWYWx1ZSB9O1xuICB9XG5cbiAgaWYgKF8uaXNQbGFpbk9iamVjdChmaWVsZFZhbHVlKSAmJiBmaWVsZFZhbHVlLiRkYl9mdW5jdGlvbikge1xuICAgIHJldHVybiBmaWVsZFZhbHVlLiRkYl9mdW5jdGlvbjtcbiAgfVxuXG4gIGNvbnN0IGZpZWxkVHlwZSA9IHNjaGVtZXIuZ2V0X2ZpZWxkX3R5cGUoc2NoZW1hLCBmaWVsZE5hbWUpO1xuICBjb25zdCB2YWxpZGF0b3JzID0gc2NoZW1lci5nZXRfdmFsaWRhdG9ycyhzY2hlbWEsIGZpZWxkTmFtZSk7XG5cbiAgaWYgKF8uaXNBcnJheShmaWVsZFZhbHVlKSAmJiBmaWVsZFR5cGUgIT09ICdsaXN0JyAmJiBmaWVsZFR5cGUgIT09ICdzZXQnICYmIGZpZWxkVHlwZSAhPT0gJ2Zyb3plbicpIHtcbiAgICBjb25zdCB2YWwgPSBmaWVsZFZhbHVlLm1hcCgodikgPT4ge1xuICAgICAgY29uc3QgZGJWYWwgPSBwYXJzZXIuZ2V0X2RiX3ZhbHVlX2V4cHJlc3Npb24oc2NoZW1hLCBmaWVsZE5hbWUsIHYpO1xuXG4gICAgICBpZiAoXy5pc1BsYWluT2JqZWN0KGRiVmFsKSAmJiBkYlZhbC5xdWVyeV9zZWdtZW50KSByZXR1cm4gZGJWYWwucGFyYW1ldGVyO1xuICAgICAgcmV0dXJuIGRiVmFsO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHsgcXVlcnlfc2VnbWVudDogJz8nLCBwYXJhbWV0ZXI6IHZhbCB9O1xuICB9XG5cbiAgY29uc3QgdmFsaWRhdGlvbk1lc3NhZ2UgPSBzY2hlbWVyLmdldF92YWxpZGF0aW9uX21lc3NhZ2UodmFsaWRhdG9ycywgZmllbGRWYWx1ZSk7XG4gIGlmICh0eXBlb2YgdmFsaWRhdGlvbk1lc3NhZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICB0aHJvdyAoYnVpbGRFcnJvcignbW9kZWwudmFsaWRhdG9yLmludmFsaWR2YWx1ZScsIHZhbGlkYXRpb25NZXNzYWdlKGZpZWxkVmFsdWUsIGZpZWxkTmFtZSwgZmllbGRUeXBlKSkpO1xuICB9XG5cbiAgaWYgKGZpZWxkVHlwZSA9PT0gJ2NvdW50ZXInKSB7XG4gICAgbGV0IGNvdW50ZXJRdWVyeVNlZ21lbnQgPSB1dGlsLmZvcm1hdCgnXCIlc1wiJywgZmllbGROYW1lKTtcbiAgICBpZiAoZmllbGRWYWx1ZSA+PSAwKSBjb3VudGVyUXVlcnlTZWdtZW50ICs9ICcgKyA/JztcbiAgICBlbHNlIGNvdW50ZXJRdWVyeVNlZ21lbnQgKz0gJyAtID8nO1xuICAgIGZpZWxkVmFsdWUgPSBNYXRoLmFicyhmaWVsZFZhbHVlKTtcbiAgICByZXR1cm4geyBxdWVyeV9zZWdtZW50OiBjb3VudGVyUXVlcnlTZWdtZW50LCBwYXJhbWV0ZXI6IGZpZWxkVmFsdWUgfTtcbiAgfVxuXG4gIHJldHVybiB7IHF1ZXJ5X3NlZ21lbnQ6ICc/JywgcGFyYW1ldGVyOiBmaWVsZFZhbHVlIH07XG59O1xuXG5wYXJzZXIudW5zZXRfbm90X2FsbG93ZWQgPSBmdW5jdGlvbiBmKG9wZXJhdGlvbiwgc2NoZW1hLCBmaWVsZE5hbWUsIGNhbGxiYWNrKSB7XG4gIGlmIChzY2hlbWVyLmlzX3ByaW1hcnlfa2V5X2ZpZWxkKHNjaGVtYSwgZmllbGROYW1lKSkge1xuICAgIHBhcnNlci5jYWxsYmFja19vcl90aHJvdyhidWlsZEVycm9yKGBtb2RlbC4ke29wZXJhdGlvbn0udW5zZXRrZXlgLCBmaWVsZE5hbWUpLCBjYWxsYmFjayk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKHNjaGVtZXIuaXNfcmVxdWlyZWRfZmllbGQoc2NoZW1hLCBmaWVsZE5hbWUpKSB7XG4gICAgcGFyc2VyLmNhbGxiYWNrX29yX3Rocm93KGJ1aWxkRXJyb3IoYG1vZGVsLiR7b3BlcmF0aW9ufS51bnNldHJlcXVpcmVkYCwgZmllbGROYW1lKSwgY2FsbGJhY2spO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbnBhcnNlci5nZXRfaW5wbGFjZV91cGRhdGVfZXhwcmVzc2lvbiA9IGZ1bmN0aW9uIGYoc2NoZW1hLCBmaWVsZE5hbWUsIGZpZWxkVmFsdWUsIHVwZGF0ZUNsYXVzZXMsIHF1ZXJ5UGFyYW1zKSB7XG4gIGNvbnN0ICRhZGQgPSAoXy5pc1BsYWluT2JqZWN0KGZpZWxkVmFsdWUpICYmIGZpZWxkVmFsdWUuJGFkZCkgfHwgZmFsc2U7XG4gIGNvbnN0ICRhcHBlbmQgPSAoXy5pc1BsYWluT2JqZWN0KGZpZWxkVmFsdWUpICYmIGZpZWxkVmFsdWUuJGFwcGVuZCkgfHwgZmFsc2U7XG4gIGNvbnN0ICRwcmVwZW5kID0gKF8uaXNQbGFpbk9iamVjdChmaWVsZFZhbHVlKSAmJiBmaWVsZFZhbHVlLiRwcmVwZW5kKSB8fCBmYWxzZTtcbiAgY29uc3QgJHJlcGxhY2UgPSAoXy5pc1BsYWluT2JqZWN0KGZpZWxkVmFsdWUpICYmIGZpZWxkVmFsdWUuJHJlcGxhY2UpIHx8IGZhbHNlO1xuICBjb25zdCAkcmVtb3ZlID0gKF8uaXNQbGFpbk9iamVjdChmaWVsZFZhbHVlKSAmJiBmaWVsZFZhbHVlLiRyZW1vdmUpIHx8IGZhbHNlO1xuXG4gIGZpZWxkVmFsdWUgPSAkYWRkIHx8ICRhcHBlbmQgfHwgJHByZXBlbmQgfHwgJHJlcGxhY2UgfHwgJHJlbW92ZSB8fCBmaWVsZFZhbHVlO1xuXG4gIGNvbnN0IGRiVmFsID0gcGFyc2VyLmdldF9kYl92YWx1ZV9leHByZXNzaW9uKHNjaGVtYSwgZmllbGROYW1lLCBmaWVsZFZhbHVlKTtcblxuICBpZiAoIV8uaXNQbGFpbk9iamVjdChkYlZhbCkgfHwgIWRiVmFsLnF1ZXJ5X3NlZ21lbnQpIHtcbiAgICB1cGRhdGVDbGF1c2VzLnB1c2godXRpbC5mb3JtYXQoJ1wiJXNcIj0lcycsIGZpZWxkTmFtZSwgZGJWYWwpKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBmaWVsZFR5cGUgPSBzY2hlbWVyLmdldF9maWVsZF90eXBlKHNjaGVtYSwgZmllbGROYW1lKTtcblxuICBpZiAoWydtYXAnLCAnbGlzdCcsICdzZXQnXS5pbmNsdWRlcyhmaWVsZFR5cGUpKSB7XG4gICAgaWYgKCRhZGQgfHwgJGFwcGVuZCkge1xuICAgICAgZGJWYWwucXVlcnlfc2VnbWVudCA9IHV0aWwuZm9ybWF0KCdcIiVzXCIgKyAlcycsIGZpZWxkTmFtZSwgZGJWYWwucXVlcnlfc2VnbWVudCk7XG4gICAgfSBlbHNlIGlmICgkcHJlcGVuZCkge1xuICAgICAgaWYgKGZpZWxkVHlwZSA9PT0gJ2xpc3QnKSB7XG4gICAgICAgIGRiVmFsLnF1ZXJ5X3NlZ21lbnQgPSB1dGlsLmZvcm1hdCgnJXMgKyBcIiVzXCInLCBkYlZhbC5xdWVyeV9zZWdtZW50LCBmaWVsZE5hbWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgKGJ1aWxkRXJyb3IoXG4gICAgICAgICAgJ21vZGVsLnVwZGF0ZS5pbnZhbGlkcHJlcGVuZG9wJyxcbiAgICAgICAgICB1dGlsLmZvcm1hdCgnJXMgZGF0YXR5cGVzIGRvZXMgbm90IHN1cHBvcnQgJHByZXBlbmQsIHVzZSAkYWRkIGluc3RlYWQnLCBmaWVsZFR5cGUpLFxuICAgICAgICApKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCRyZW1vdmUpIHtcbiAgICAgIGRiVmFsLnF1ZXJ5X3NlZ21lbnQgPSB1dGlsLmZvcm1hdCgnXCIlc1wiIC0gJXMnLCBmaWVsZE5hbWUsIGRiVmFsLnF1ZXJ5X3NlZ21lbnQpO1xuICAgICAgaWYgKGZpZWxkVHlwZSA9PT0gJ21hcCcpIGRiVmFsLnBhcmFtZXRlciA9IE9iamVjdC5rZXlzKGRiVmFsLnBhcmFtZXRlcik7XG4gICAgfVxuICB9XG5cbiAgaWYgKCRyZXBsYWNlKSB7XG4gICAgaWYgKGZpZWxkVHlwZSA9PT0gJ21hcCcpIHtcbiAgICAgIHVwZGF0ZUNsYXVzZXMucHVzaCh1dGlsLmZvcm1hdCgnXCIlc1wiWz9dPSVzJywgZmllbGROYW1lLCBkYlZhbC5xdWVyeV9zZWdtZW50KSk7XG4gICAgICBjb25zdCByZXBsYWNlS2V5cyA9IE9iamVjdC5rZXlzKGRiVmFsLnBhcmFtZXRlcik7XG4gICAgICBjb25zdCByZXBsYWNlVmFsdWVzID0gXy52YWx1ZXMoZGJWYWwucGFyYW1ldGVyKTtcbiAgICAgIGlmIChyZXBsYWNlS2V5cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgcXVlcnlQYXJhbXMucHVzaChyZXBsYWNlS2V5c1swXSk7XG4gICAgICAgIHF1ZXJ5UGFyYW1zLnB1c2gocmVwbGFjZVZhbHVlc1swXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyAoXG4gICAgICAgICAgYnVpbGRFcnJvcignbW9kZWwudXBkYXRlLmludmFsaWRyZXBsYWNlb3AnLCAnJHJlcGxhY2UgaW4gbWFwIGRvZXMgbm90IHN1cHBvcnQgbW9yZSB0aGFuIG9uZSBpdGVtJylcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGZpZWxkVHlwZSA9PT0gJ2xpc3QnKSB7XG4gICAgICB1cGRhdGVDbGF1c2VzLnB1c2godXRpbC5mb3JtYXQoJ1wiJXNcIls/XT0lcycsIGZpZWxkTmFtZSwgZGJWYWwucXVlcnlfc2VnbWVudCkpO1xuICAgICAgaWYgKGRiVmFsLnBhcmFtZXRlci5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgcXVlcnlQYXJhbXMucHVzaChkYlZhbC5wYXJhbWV0ZXJbMF0pO1xuICAgICAgICBxdWVyeVBhcmFtcy5wdXNoKGRiVmFsLnBhcmFtZXRlclsxXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyAoYnVpbGRFcnJvcihcbiAgICAgICAgICAnbW9kZWwudXBkYXRlLmludmFsaWRyZXBsYWNlb3AnLFxuICAgICAgICAgICckcmVwbGFjZSBpbiBsaXN0IHNob3VsZCBoYXZlIGV4YWN0bHkgMiBpdGVtcywgZmlyc3Qgb25lIGFzIHRoZSBpbmRleCBhbmQgdGhlIHNlY29uZCBvbmUgYXMgdGhlIHZhbHVlJyxcbiAgICAgICAgKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IChidWlsZEVycm9yKFxuICAgICAgICAnbW9kZWwudXBkYXRlLmludmFsaWRyZXBsYWNlb3AnLFxuICAgICAgICB1dGlsLmZvcm1hdCgnJXMgZGF0YXR5cGVzIGRvZXMgbm90IHN1cHBvcnQgJHJlcGxhY2UnLCBmaWVsZFR5cGUpLFxuICAgICAgKSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHVwZGF0ZUNsYXVzZXMucHVzaCh1dGlsLmZvcm1hdCgnXCIlc1wiPSVzJywgZmllbGROYW1lLCBkYlZhbC5xdWVyeV9zZWdtZW50KSk7XG4gICAgcXVlcnlQYXJhbXMucHVzaChkYlZhbC5wYXJhbWV0ZXIpO1xuICB9XG59O1xuXG5wYXJzZXIuZ2V0X3VwZGF0ZV92YWx1ZV9leHByZXNzaW9uID0gZnVuY3Rpb24gZihpbnN0YW5jZSwgc2NoZW1hLCB1cGRhdGVWYWx1ZXMsIGNhbGxiYWNrKSB7XG4gIGNvbnN0IHVwZGF0ZUNsYXVzZXMgPSBbXTtcbiAgY29uc3QgcXVlcnlQYXJhbXMgPSBbXTtcblxuICBpZiAoc2NoZW1hLm9wdGlvbnMgJiYgc2NoZW1hLm9wdGlvbnMudGltZXN0YW1wcykge1xuICAgIGlmICghdXBkYXRlVmFsdWVzW3NjaGVtYS5vcHRpb25zLnRpbWVzdGFtcHMudXBkYXRlZEF0XSkge1xuICAgICAgdXBkYXRlVmFsdWVzW3NjaGVtYS5vcHRpb25zLnRpbWVzdGFtcHMudXBkYXRlZEF0XSA9IHsgJGRiX2Z1bmN0aW9uOiAndG9UaW1lc3RhbXAobm93KCkpJyB9O1xuICAgIH1cbiAgfVxuXG4gIGlmIChzY2hlbWEub3B0aW9ucyAmJiBzY2hlbWEub3B0aW9ucy52ZXJzaW9ucykge1xuICAgIGlmICghdXBkYXRlVmFsdWVzW3NjaGVtYS5vcHRpb25zLnZlcnNpb25zLmtleV0pIHtcbiAgICAgIHVwZGF0ZVZhbHVlc1tzY2hlbWEub3B0aW9ucy52ZXJzaW9ucy5rZXldID0geyAkZGJfZnVuY3Rpb246ICdub3coKScgfTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBlcnJvckhhcHBlbmVkID0gT2JqZWN0LmtleXModXBkYXRlVmFsdWVzKS5zb21lKChmaWVsZE5hbWUpID0+IHtcbiAgICBpZiAoc2NoZW1hLmZpZWxkc1tmaWVsZE5hbWVdID09PSB1bmRlZmluZWQgfHwgc2NoZW1hLmZpZWxkc1tmaWVsZE5hbWVdLnZpcnR1YWwpIHJldHVybiBmYWxzZTtcblxuICAgIGNvbnN0IGZpZWxkVHlwZSA9IHNjaGVtZXIuZ2V0X2ZpZWxkX3R5cGUoc2NoZW1hLCBmaWVsZE5hbWUpO1xuICAgIGxldCBmaWVsZFZhbHVlID0gdXBkYXRlVmFsdWVzW2ZpZWxkTmFtZV07XG5cbiAgICBpZiAoZmllbGRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBmaWVsZFZhbHVlID0gaW5zdGFuY2UuX2dldF9kZWZhdWx0X3ZhbHVlKGZpZWxkTmFtZSk7XG4gICAgICBpZiAoZmllbGRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiBwYXJzZXIudW5zZXRfbm90X2FsbG93ZWQoJ3VwZGF0ZScsIHNjaGVtYSwgZmllbGROYW1lLCBjYWxsYmFjayk7XG4gICAgICB9IGVsc2UgaWYgKCFzY2hlbWEuZmllbGRzW2ZpZWxkTmFtZV0ucnVsZSB8fCAhc2NoZW1hLmZpZWxkc1tmaWVsZE5hbWVdLnJ1bGUuaWdub3JlX2RlZmF1bHQpIHtcbiAgICAgICAgLy8gZGlkIHNldCBhIGRlZmF1bHQgdmFsdWUsIGlnbm9yZSBkZWZhdWx0IGlzIG5vdCBzZXRcbiAgICAgICAgaWYgKGluc3RhbmNlLnZhbGlkYXRlKGZpZWxkTmFtZSwgZmllbGRWYWx1ZSkgIT09IHRydWUpIHtcbiAgICAgICAgICBwYXJzZXIuY2FsbGJhY2tfb3JfdGhyb3coYnVpbGRFcnJvcignbW9kZWwudXBkYXRlLmludmFsaWRkZWZhdWx0dmFsdWUnLCBmaWVsZFZhbHVlLCBmaWVsZE5hbWUsIGZpZWxkVHlwZSksIGNhbGxiYWNrKTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChmaWVsZFZhbHVlID09PSBudWxsIHx8IGZpZWxkVmFsdWUgPT09IGNxbC50eXBlcy51bnNldCkge1xuICAgICAgaWYgKHBhcnNlci51bnNldF9ub3RfYWxsb3dlZCgndXBkYXRlJywgc2NoZW1hLCBmaWVsZE5hbWUsIGNhbGxiYWNrKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgcGFyc2VyLmdldF9pbnBsYWNlX3VwZGF0ZV9leHByZXNzaW9uKHNjaGVtYSwgZmllbGROYW1lLCBmaWVsZFZhbHVlLCB1cGRhdGVDbGF1c2VzLCBxdWVyeVBhcmFtcyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcGFyc2VyLmNhbGxiYWNrX29yX3Rocm93KGUsIGNhbGxiYWNrKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0pO1xuXG4gIHJldHVybiB7IHVwZGF0ZUNsYXVzZXMsIHF1ZXJ5UGFyYW1zLCBlcnJvckhhcHBlbmVkIH07XG59O1xuXG5wYXJzZXIuZ2V0X3NhdmVfdmFsdWVfZXhwcmVzc2lvbiA9IGZ1bmN0aW9uIGZuKGluc3RhbmNlLCBzY2hlbWEsIGNhbGxiYWNrKSB7XG4gIGNvbnN0IGlkZW50aWZpZXJzID0gW107XG4gIGNvbnN0IHZhbHVlcyA9IFtdO1xuICBjb25zdCBxdWVyeVBhcmFtcyA9IFtdO1xuXG4gIGlmIChzY2hlbWEub3B0aW9ucyAmJiBzY2hlbWEub3B0aW9ucy50aW1lc3RhbXBzKSB7XG4gICAgaWYgKGluc3RhbmNlW3NjaGVtYS5vcHRpb25zLnRpbWVzdGFtcHMudXBkYXRlZEF0XSkge1xuICAgICAgaW5zdGFuY2Vbc2NoZW1hLm9wdGlvbnMudGltZXN0YW1wcy51cGRhdGVkQXRdID0geyAkZGJfZnVuY3Rpb246ICd0b1RpbWVzdGFtcChub3coKSknIH07XG4gICAgfVxuICB9XG5cbiAgaWYgKHNjaGVtYS5vcHRpb25zICYmIHNjaGVtYS5vcHRpb25zLnZlcnNpb25zKSB7XG4gICAgaWYgKGluc3RhbmNlW3NjaGVtYS5vcHRpb25zLnZlcnNpb25zLmtleV0pIHtcbiAgICAgIGluc3RhbmNlW3NjaGVtYS5vcHRpb25zLnZlcnNpb25zLmtleV0gPSB7ICRkYl9mdW5jdGlvbjogJ25vdygpJyB9O1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGVycm9ySGFwcGVuZWQgPSBPYmplY3Qua2V5cyhzY2hlbWEuZmllbGRzKS5zb21lKChmaWVsZE5hbWUpID0+IHtcbiAgICBpZiAoc2NoZW1hLmZpZWxkc1tmaWVsZE5hbWVdLnZpcnR1YWwpIHJldHVybiBmYWxzZTtcblxuICAgIC8vIGNoZWNrIGZpZWxkIHZhbHVlXG4gICAgY29uc3QgZmllbGRUeXBlID0gc2NoZW1lci5nZXRfZmllbGRfdHlwZShzY2hlbWEsIGZpZWxkTmFtZSk7XG4gICAgbGV0IGZpZWxkVmFsdWUgPSBpbnN0YW5jZVtmaWVsZE5hbWVdO1xuXG4gICAgaWYgKGZpZWxkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgZmllbGRWYWx1ZSA9IGluc3RhbmNlLl9nZXRfZGVmYXVsdF92YWx1ZShmaWVsZE5hbWUpO1xuICAgICAgaWYgKGZpZWxkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gcGFyc2VyLnVuc2V0X25vdF9hbGxvd2VkKCdzYXZlJywgc2NoZW1hLCBmaWVsZE5hbWUsIGNhbGxiYWNrKTtcbiAgICAgIH0gZWxzZSBpZiAoIXNjaGVtYS5maWVsZHNbZmllbGROYW1lXS5ydWxlIHx8ICFzY2hlbWEuZmllbGRzW2ZpZWxkTmFtZV0ucnVsZS5pZ25vcmVfZGVmYXVsdCkge1xuICAgICAgICAvLyBkaWQgc2V0IGEgZGVmYXVsdCB2YWx1ZSwgaWdub3JlIGRlZmF1bHQgaXMgbm90IHNldFxuICAgICAgICBpZiAoaW5zdGFuY2UudmFsaWRhdGUoZmllbGROYW1lLCBmaWVsZFZhbHVlKSAhPT0gdHJ1ZSkge1xuICAgICAgICAgIHBhcnNlci5jYWxsYmFja19vcl90aHJvdyhidWlsZEVycm9yKCdtb2RlbC5zYXZlLmludmFsaWRkZWZhdWx0dmFsdWUnLCBmaWVsZFZhbHVlLCBmaWVsZE5hbWUsIGZpZWxkVHlwZSksIGNhbGxiYWNrKTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChmaWVsZFZhbHVlID09PSBudWxsIHx8IGZpZWxkVmFsdWUgPT09IGNxbC50eXBlcy51bnNldCkge1xuICAgICAgaWYgKHBhcnNlci51bnNldF9ub3RfYWxsb3dlZCgnc2F2ZScsIHNjaGVtYSwgZmllbGROYW1lLCBjYWxsYmFjaykpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWRlbnRpZmllcnMucHVzaCh1dGlsLmZvcm1hdCgnXCIlc1wiJywgZmllbGROYW1lKSk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgZGJWYWwgPSBwYXJzZXIuZ2V0X2RiX3ZhbHVlX2V4cHJlc3Npb24oc2NoZW1hLCBmaWVsZE5hbWUsIGZpZWxkVmFsdWUpO1xuICAgICAgaWYgKF8uaXNQbGFpbk9iamVjdChkYlZhbCkgJiYgZGJWYWwucXVlcnlfc2VnbWVudCkge1xuICAgICAgICB2YWx1ZXMucHVzaChkYlZhbC5xdWVyeV9zZWdtZW50KTtcbiAgICAgICAgcXVlcnlQYXJhbXMucHVzaChkYlZhbC5wYXJhbWV0ZXIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWVzLnB1c2goZGJWYWwpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHBhcnNlci5jYWxsYmFja19vcl90aHJvdyhlLCBjYWxsYmFjayk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9KTtcblxuICByZXR1cm4ge1xuICAgIGlkZW50aWZpZXJzLFxuICAgIHZhbHVlcyxcbiAgICBxdWVyeVBhcmFtcyxcbiAgICBlcnJvckhhcHBlbmVkLFxuICB9O1xufTtcblxucGFyc2VyLmV4dHJhY3RfcXVlcnlfcmVsYXRpb25zID0gZnVuY3Rpb24gZihmaWVsZE5hbWUsIHJlbGF0aW9uS2V5LCByZWxhdGlvblZhbHVlLCBzY2hlbWEsIHZhbGlkT3BlcmF0b3JzKSB7XG4gIGNvbnN0IHF1ZXJ5UmVsYXRpb25zID0gW107XG4gIGNvbnN0IHF1ZXJ5UGFyYW1zID0gW107XG5cbiAgaWYgKCFfLmhhcyh2YWxpZE9wZXJhdG9ycywgcmVsYXRpb25LZXkudG9Mb3dlckNhc2UoKSkpIHtcbiAgICB0aHJvdyAoYnVpbGRFcnJvcignbW9kZWwuZmluZC5pbnZhbGlkb3AnLCByZWxhdGlvbktleSkpO1xuICB9XG5cbiAgcmVsYXRpb25LZXkgPSByZWxhdGlvbktleS50b0xvd2VyQ2FzZSgpO1xuICBpZiAocmVsYXRpb25LZXkgPT09ICckaW4nICYmICFfLmlzQXJyYXkocmVsYXRpb25WYWx1ZSkpIHtcbiAgICB0aHJvdyAoYnVpbGRFcnJvcignbW9kZWwuZmluZC5pbnZhbGlkaW5vcCcpKTtcbiAgfVxuICBpZiAocmVsYXRpb25LZXkgPT09ICckdG9rZW4nICYmICEocmVsYXRpb25WYWx1ZSBpbnN0YW5jZW9mIE9iamVjdCkpIHtcbiAgICB0aHJvdyAoYnVpbGRFcnJvcignbW9kZWwuZmluZC5pbnZhbGlkdG9rZW4nKSk7XG4gIH1cblxuICBsZXQgb3BlcmF0b3IgPSB2YWxpZE9wZXJhdG9yc1tyZWxhdGlvbktleV07XG4gIGxldCB3aGVyZVRlbXBsYXRlID0gJ1wiJXNcIiAlcyAlcyc7XG5cbiAgY29uc3QgYnVpbGRRdWVyeVJlbGF0aW9ucyA9IChmaWVsZE5hbWVMb2NhbCwgcmVsYXRpb25WYWx1ZUxvY2FsKSA9PiB7XG4gICAgY29uc3QgZGJWYWwgPSBwYXJzZXIuZ2V0X2RiX3ZhbHVlX2V4cHJlc3Npb24oc2NoZW1hLCBmaWVsZE5hbWVMb2NhbCwgcmVsYXRpb25WYWx1ZUxvY2FsKTtcbiAgICBpZiAoXy5pc1BsYWluT2JqZWN0KGRiVmFsKSAmJiBkYlZhbC5xdWVyeV9zZWdtZW50KSB7XG4gICAgICBxdWVyeVJlbGF0aW9ucy5wdXNoKHV0aWwuZm9ybWF0KFxuICAgICAgICB3aGVyZVRlbXBsYXRlLFxuICAgICAgICBmaWVsZE5hbWVMb2NhbCwgb3BlcmF0b3IsIGRiVmFsLnF1ZXJ5X3NlZ21lbnQsXG4gICAgICApKTtcbiAgICAgIHF1ZXJ5UGFyYW1zLnB1c2goZGJWYWwucGFyYW1ldGVyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcXVlcnlSZWxhdGlvbnMucHVzaCh1dGlsLmZvcm1hdChcbiAgICAgICAgd2hlcmVUZW1wbGF0ZSxcbiAgICAgICAgZmllbGROYW1lTG9jYWwsIG9wZXJhdG9yLCBkYlZhbCxcbiAgICAgICkpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBidWlsZFRva2VuUXVlcnlSZWxhdGlvbnMgPSAodG9rZW5SZWxhdGlvbktleSwgdG9rZW5SZWxhdGlvblZhbHVlKSA9PiB7XG4gICAgdG9rZW5SZWxhdGlvbktleSA9IHRva2VuUmVsYXRpb25LZXkudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoXy5oYXModmFsaWRPcGVyYXRvcnMsIHRva2VuUmVsYXRpb25LZXkpICYmIHRva2VuUmVsYXRpb25LZXkgIT09ICckdG9rZW4nICYmIHRva2VuUmVsYXRpb25LZXkgIT09ICckaW4nKSB7XG4gICAgICBvcGVyYXRvciA9IHZhbGlkT3BlcmF0b3JzW3Rva2VuUmVsYXRpb25LZXldO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyAoYnVpbGRFcnJvcignbW9kZWwuZmluZC5pbnZhbGlkdG9rZW5vcCcsIHRva2VuUmVsYXRpb25LZXkpKTtcbiAgICB9XG5cbiAgICBpZiAoXy5pc0FycmF5KHRva2VuUmVsYXRpb25WYWx1ZSkpIHtcbiAgICAgIGNvbnN0IHRva2VuS2V5cyA9IGZpZWxkTmFtZS5zcGxpdCgnLCcpO1xuICAgICAgZm9yIChsZXQgdG9rZW5JbmRleCA9IDA7IHRva2VuSW5kZXggPCB0b2tlblJlbGF0aW9uVmFsdWUubGVuZ3RoOyB0b2tlbkluZGV4KyspIHtcbiAgICAgICAgdG9rZW5LZXlzW3Rva2VuSW5kZXhdID0gdG9rZW5LZXlzW3Rva2VuSW5kZXhdLnRyaW0oKTtcbiAgICAgICAgY29uc3QgZGJWYWwgPSBwYXJzZXIuZ2V0X2RiX3ZhbHVlX2V4cHJlc3Npb24oc2NoZW1hLCB0b2tlbktleXNbdG9rZW5JbmRleF0sIHRva2VuUmVsYXRpb25WYWx1ZVt0b2tlbkluZGV4XSk7XG4gICAgICAgIGlmIChfLmlzUGxhaW5PYmplY3QoZGJWYWwpICYmIGRiVmFsLnF1ZXJ5X3NlZ21lbnQpIHtcbiAgICAgICAgICB0b2tlblJlbGF0aW9uVmFsdWVbdG9rZW5JbmRleF0gPSBkYlZhbC5xdWVyeV9zZWdtZW50O1xuICAgICAgICAgIHF1ZXJ5UGFyYW1zLnB1c2goZGJWYWwucGFyYW1ldGVyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0b2tlblJlbGF0aW9uVmFsdWVbdG9rZW5JbmRleF0gPSBkYlZhbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcXVlcnlSZWxhdGlvbnMucHVzaCh1dGlsLmZvcm1hdChcbiAgICAgICAgd2hlcmVUZW1wbGF0ZSxcbiAgICAgICAgdG9rZW5LZXlzLmpvaW4oJ1wiLFwiJyksIG9wZXJhdG9yLCB0b2tlblJlbGF0aW9uVmFsdWUudG9TdHJpbmcoKSxcbiAgICAgICkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBidWlsZFF1ZXJ5UmVsYXRpb25zKGZpZWxkTmFtZSwgdG9rZW5SZWxhdGlvblZhbHVlKTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHJlbGF0aW9uS2V5ID09PSAnJHRva2VuJykge1xuICAgIHdoZXJlVGVtcGxhdGUgPSAndG9rZW4oXCIlc1wiKSAlcyB0b2tlbiglcyknO1xuXG4gICAgY29uc3QgdG9rZW5SZWxhdGlvbktleXMgPSBPYmplY3Qua2V5cyhyZWxhdGlvblZhbHVlKTtcbiAgICBmb3IgKGxldCB0b2tlblJLID0gMDsgdG9rZW5SSyA8IHRva2VuUmVsYXRpb25LZXlzLmxlbmd0aDsgdG9rZW5SSysrKSB7XG4gICAgICBjb25zdCB0b2tlblJlbGF0aW9uS2V5ID0gdG9rZW5SZWxhdGlvbktleXNbdG9rZW5SS107XG4gICAgICBjb25zdCB0b2tlblJlbGF0aW9uVmFsdWUgPSByZWxhdGlvblZhbHVlW3Rva2VuUmVsYXRpb25LZXldO1xuICAgICAgYnVpbGRUb2tlblF1ZXJ5UmVsYXRpb25zKHRva2VuUmVsYXRpb25LZXksIHRva2VuUmVsYXRpb25WYWx1ZSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKHJlbGF0aW9uS2V5ID09PSAnJGNvbnRhaW5zJykge1xuICAgIGNvbnN0IGZpZWxkVHlwZTEgPSBzY2hlbWVyLmdldF9maWVsZF90eXBlKHNjaGVtYSwgZmllbGROYW1lKTtcbiAgICBpZiAoWydtYXAnLCAnbGlzdCcsICdzZXQnLCAnZnJvemVuJ10uaW5jbHVkZXMoZmllbGRUeXBlMSkpIHtcbiAgICAgIGlmIChmaWVsZFR5cGUxID09PSAnbWFwJyAmJiBfLmlzUGxhaW5PYmplY3QocmVsYXRpb25WYWx1ZSkpIHtcbiAgICAgICAgT2JqZWN0LmtleXMocmVsYXRpb25WYWx1ZSkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgcXVlcnlSZWxhdGlvbnMucHVzaCh1dGlsLmZvcm1hdChcbiAgICAgICAgICAgICdcIiVzXCJbJXNdICVzICVzJyxcbiAgICAgICAgICAgIGZpZWxkTmFtZSwgJz8nLCAnPScsICc/JyxcbiAgICAgICAgICApKTtcbiAgICAgICAgICBxdWVyeVBhcmFtcy5wdXNoKGtleSk7XG4gICAgICAgICAgcXVlcnlQYXJhbXMucHVzaChyZWxhdGlvblZhbHVlW2tleV0pO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHF1ZXJ5UmVsYXRpb25zLnB1c2godXRpbC5mb3JtYXQoXG4gICAgICAgICAgd2hlcmVUZW1wbGF0ZSxcbiAgICAgICAgICBmaWVsZE5hbWUsIG9wZXJhdG9yLCAnPycsXG4gICAgICAgICkpO1xuICAgICAgICBxdWVyeVBhcmFtcy5wdXNoKHJlbGF0aW9uVmFsdWUpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyAoYnVpbGRFcnJvcignbW9kZWwuZmluZC5pbnZhbGlkY29udGFpbnNvcCcpKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAocmVsYXRpb25LZXkgPT09ICckY29udGFpbnNfa2V5Jykge1xuICAgIGNvbnN0IGZpZWxkVHlwZTIgPSBzY2hlbWVyLmdldF9maWVsZF90eXBlKHNjaGVtYSwgZmllbGROYW1lKTtcbiAgICBpZiAoZmllbGRUeXBlMiAhPT0gJ21hcCcpIHtcbiAgICAgIHRocm93IChidWlsZEVycm9yKCdtb2RlbC5maW5kLmludmFsaWRjb250YWluc2tleW9wJykpO1xuICAgIH1cbiAgICBxdWVyeVJlbGF0aW9ucy5wdXNoKHV0aWwuZm9ybWF0KFxuICAgICAgd2hlcmVUZW1wbGF0ZSxcbiAgICAgIGZpZWxkTmFtZSwgb3BlcmF0b3IsICc/JyxcbiAgICApKTtcbiAgICBxdWVyeVBhcmFtcy5wdXNoKHJlbGF0aW9uVmFsdWUpO1xuICB9IGVsc2Uge1xuICAgIGJ1aWxkUXVlcnlSZWxhdGlvbnMoZmllbGROYW1lLCByZWxhdGlvblZhbHVlKTtcbiAgfVxuICByZXR1cm4geyBxdWVyeVJlbGF0aW9ucywgcXVlcnlQYXJhbXMgfTtcbn07XG5cbnBhcnNlci5fcGFyc2VfcXVlcnlfb2JqZWN0ID0gZnVuY3Rpb24gZihzY2hlbWEsIHF1ZXJ5T2JqZWN0KSB7XG4gIGxldCBxdWVyeVJlbGF0aW9ucyA9IFtdO1xuICBsZXQgcXVlcnlQYXJhbXMgPSBbXTtcblxuICBPYmplY3Qua2V5cyhxdWVyeU9iamVjdCkuZm9yRWFjaCgoZmllbGROYW1lKSA9PiB7XG4gICAgaWYgKGZpZWxkTmFtZS5zdGFydHNXaXRoKCckJykpIHtcbiAgICAgIC8vIHNlYXJjaCBxdWVyaWVzIGJhc2VkIG9uIGx1Y2VuZSBpbmRleCBvciBzb2xyXG4gICAgICAvLyBlc2NhcGUgYWxsIHNpbmdsZSBxdW90ZXMgZm9yIHF1ZXJpZXMgaW4gY2Fzc2FuZHJhXG4gICAgICBpZiAoZmllbGROYW1lID09PSAnJGV4cHInKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcXVlcnlPYmplY3RbZmllbGROYW1lXS5pbmRleCA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIHF1ZXJ5T2JqZWN0W2ZpZWxkTmFtZV0ucXVlcnkgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgcXVlcnlSZWxhdGlvbnMucHVzaCh1dGlsLmZvcm1hdChcbiAgICAgICAgICAgIFwiZXhwciglcywnJXMnKVwiLFxuICAgICAgICAgICAgcXVlcnlPYmplY3RbZmllbGROYW1lXS5pbmRleCwgcXVlcnlPYmplY3RbZmllbGROYW1lXS5xdWVyeS5yZXBsYWNlKC8nL2csIFwiJydcIiksXG4gICAgICAgICAgKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLmZpbmQuaW52YWxpZGV4cHInKSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoZmllbGROYW1lID09PSAnJHNvbHJfcXVlcnknKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcXVlcnlPYmplY3RbZmllbGROYW1lXSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICBxdWVyeVJlbGF0aW9ucy5wdXNoKHV0aWwuZm9ybWF0KFxuICAgICAgICAgICAgXCJzb2xyX3F1ZXJ5PSclcydcIixcbiAgICAgICAgICAgIHF1ZXJ5T2JqZWN0W2ZpZWxkTmFtZV0ucmVwbGFjZSgvJy9nLCBcIicnXCIpLFxuICAgICAgICAgICkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IChidWlsZEVycm9yKCdtb2RlbC5maW5kLmludmFsaWRzb2xycXVlcnknKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgd2hlcmVPYmplY3QgPSBxdWVyeU9iamVjdFtmaWVsZE5hbWVdO1xuICAgIC8vIEFycmF5IG9mIG9wZXJhdG9yc1xuICAgIGlmICghXy5pc0FycmF5KHdoZXJlT2JqZWN0KSkgd2hlcmVPYmplY3QgPSBbd2hlcmVPYmplY3RdO1xuXG4gICAgZm9yIChsZXQgZmsgPSAwOyBmayA8IHdoZXJlT2JqZWN0Lmxlbmd0aDsgZmsrKykge1xuICAgICAgbGV0IGZpZWxkUmVsYXRpb24gPSB3aGVyZU9iamVjdFtma107XG5cbiAgICAgIGNvbnN0IGNxbE9wZXJhdG9ycyA9IHtcbiAgICAgICAgJGVxOiAnPScsXG4gICAgICAgICRuZTogJyE9JyxcbiAgICAgICAgJGd0OiAnPicsXG4gICAgICAgICRsdDogJzwnLFxuICAgICAgICAkZ3RlOiAnPj0nLFxuICAgICAgICAkbHRlOiAnPD0nLFxuICAgICAgICAkaW46ICdJTicsXG4gICAgICAgICRsaWtlOiAnTElLRScsXG4gICAgICAgICR0b2tlbjogJ3Rva2VuJyxcbiAgICAgICAgJGNvbnRhaW5zOiAnQ09OVEFJTlMnLFxuICAgICAgICAkY29udGFpbnNfa2V5OiAnQ09OVEFJTlMgS0VZJyxcbiAgICAgIH07XG5cbiAgICAgIGlmIChfLmlzUGxhaW5PYmplY3QoZmllbGRSZWxhdGlvbikpIHtcbiAgICAgICAgY29uc3QgdmFsaWRLZXlzID0gT2JqZWN0LmtleXMoY3FsT3BlcmF0b3JzKTtcbiAgICAgICAgY29uc3QgZmllbGRSZWxhdGlvbktleXMgPSBPYmplY3Qua2V5cyhmaWVsZFJlbGF0aW9uKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWVsZFJlbGF0aW9uS2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmICghdmFsaWRLZXlzLmluY2x1ZGVzKGZpZWxkUmVsYXRpb25LZXlzW2ldKSkge1xuICAgICAgICAgICAgLy8gZmllbGQgcmVsYXRpb24ga2V5IGludmFsaWQsIGFwcGx5IGRlZmF1bHQgJGVxIG9wZXJhdG9yXG4gICAgICAgICAgICBmaWVsZFJlbGF0aW9uID0geyAkZXE6IGZpZWxkUmVsYXRpb24gfTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmllbGRSZWxhdGlvbiA9IHsgJGVxOiBmaWVsZFJlbGF0aW9uIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlbGF0aW9uS2V5cyA9IE9iamVjdC5rZXlzKGZpZWxkUmVsYXRpb24pO1xuICAgICAgZm9yIChsZXQgcmsgPSAwOyByayA8IHJlbGF0aW9uS2V5cy5sZW5ndGg7IHJrKyspIHtcbiAgICAgICAgY29uc3QgcmVsYXRpb25LZXkgPSByZWxhdGlvbktleXNbcmtdO1xuICAgICAgICBjb25zdCByZWxhdGlvblZhbHVlID0gZmllbGRSZWxhdGlvbltyZWxhdGlvbktleV07XG4gICAgICAgIGNvbnN0IGV4dHJhY3RlZFJlbGF0aW9ucyA9IHBhcnNlci5leHRyYWN0X3F1ZXJ5X3JlbGF0aW9ucyhcbiAgICAgICAgICBmaWVsZE5hbWUsXG4gICAgICAgICAgcmVsYXRpb25LZXksXG4gICAgICAgICAgcmVsYXRpb25WYWx1ZSxcbiAgICAgICAgICBzY2hlbWEsXG4gICAgICAgICAgY3FsT3BlcmF0b3JzLFxuICAgICAgICApO1xuICAgICAgICBxdWVyeVJlbGF0aW9ucyA9IHF1ZXJ5UmVsYXRpb25zLmNvbmNhdChleHRyYWN0ZWRSZWxhdGlvbnMucXVlcnlSZWxhdGlvbnMpO1xuICAgICAgICBxdWVyeVBhcmFtcyA9IHF1ZXJ5UGFyYW1zLmNvbmNhdChleHRyYWN0ZWRSZWxhdGlvbnMucXVlcnlQYXJhbXMpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHsgcXVlcnlSZWxhdGlvbnMsIHF1ZXJ5UGFyYW1zIH07XG59O1xuXG5wYXJzZXIuZ2V0X3doZXJlX2NsYXVzZSA9IGZ1bmN0aW9uIGYoc2NoZW1hLCBxdWVyeU9iamVjdCkge1xuICBjb25zdCBwYXJzZWRPYmplY3QgPSBwYXJzZXIuX3BhcnNlX3F1ZXJ5X29iamVjdChzY2hlbWEsIHF1ZXJ5T2JqZWN0KTtcbiAgY29uc3Qgd2hlcmVDbGF1c2UgPSB7fTtcbiAgaWYgKHBhcnNlZE9iamVjdC5xdWVyeVJlbGF0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgd2hlcmVDbGF1c2UucXVlcnkgPSB1dGlsLmZvcm1hdCgnV0hFUkUgJXMnLCBwYXJzZWRPYmplY3QucXVlcnlSZWxhdGlvbnMuam9pbignIEFORCAnKSk7XG4gIH0gZWxzZSB7XG4gICAgd2hlcmVDbGF1c2UucXVlcnkgPSAnJztcbiAgfVxuICB3aGVyZUNsYXVzZS5wYXJhbXMgPSBwYXJzZWRPYmplY3QucXVlcnlQYXJhbXM7XG4gIHJldHVybiB3aGVyZUNsYXVzZTtcbn07XG5cbnBhcnNlci5nZXRfaWZfY2xhdXNlID0gZnVuY3Rpb24gZihzY2hlbWEsIHF1ZXJ5T2JqZWN0KSB7XG4gIGNvbnN0IHBhcnNlZE9iamVjdCA9IHBhcnNlci5fcGFyc2VfcXVlcnlfb2JqZWN0KHNjaGVtYSwgcXVlcnlPYmplY3QpO1xuICBjb25zdCBpZkNsYXVzZSA9IHt9O1xuICBpZiAocGFyc2VkT2JqZWN0LnF1ZXJ5UmVsYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICBpZkNsYXVzZS5xdWVyeSA9IHV0aWwuZm9ybWF0KCdJRiAlcycsIHBhcnNlZE9iamVjdC5xdWVyeVJlbGF0aW9ucy5qb2luKCcgQU5EICcpKTtcbiAgfSBlbHNlIHtcbiAgICBpZkNsYXVzZS5xdWVyeSA9ICcnO1xuICB9XG4gIGlmQ2xhdXNlLnBhcmFtcyA9IHBhcnNlZE9iamVjdC5xdWVyeVBhcmFtcztcbiAgcmV0dXJuIGlmQ2xhdXNlO1xufTtcblxucGFyc2VyLmdldF9vcmRlcmJ5X2NsYXVzZSA9IGZ1bmN0aW9uIGYocXVlcnlPYmplY3QpIHtcbiAgY29uc3Qgb3JkZXJLZXlzID0gW107XG4gIE9iamVjdC5rZXlzKHF1ZXJ5T2JqZWN0KS5mb3JFYWNoKChrKSA9PiB7XG4gICAgY29uc3QgcXVlcnlJdGVtID0gcXVlcnlPYmplY3Rba107XG4gICAgaWYgKGsudG9Mb3dlckNhc2UoKSA9PT0gJyRvcmRlcmJ5Jykge1xuICAgICAgaWYgKCEocXVlcnlJdGVtIGluc3RhbmNlb2YgT2JqZWN0KSkge1xuICAgICAgICB0aHJvdyAoYnVpbGRFcnJvcignbW9kZWwuZmluZC5pbnZhbGlkb3JkZXInKSk7XG4gICAgICB9XG4gICAgICBjb25zdCBvcmRlckl0ZW1LZXlzID0gT2JqZWN0LmtleXMocXVlcnlJdGVtKTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcmRlckl0ZW1LZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGNxbE9yZGVyRGlyZWN0aW9uID0geyAkYXNjOiAnQVNDJywgJGRlc2M6ICdERVNDJyB9O1xuICAgICAgICBpZiAob3JkZXJJdGVtS2V5c1tpXS50b0xvd2VyQ2FzZSgpIGluIGNxbE9yZGVyRGlyZWN0aW9uKSB7XG4gICAgICAgICAgbGV0IG9yZGVyRmllbGRzID0gcXVlcnlJdGVtW29yZGVySXRlbUtleXNbaV1dO1xuXG4gICAgICAgICAgaWYgKCFfLmlzQXJyYXkob3JkZXJGaWVsZHMpKSB7XG4gICAgICAgICAgICBvcmRlckZpZWxkcyA9IFtvcmRlckZpZWxkc107XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBvcmRlckZpZWxkcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgb3JkZXJLZXlzLnB1c2godXRpbC5mb3JtYXQoXG4gICAgICAgICAgICAgICdcIiVzXCIgJXMnLFxuICAgICAgICAgICAgICBvcmRlckZpZWxkc1tqXSwgY3FsT3JkZXJEaXJlY3Rpb25bb3JkZXJJdGVtS2V5c1tpXV0sXG4gICAgICAgICAgICApKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLmZpbmQuaW52YWxpZG9yZGVydHlwZScsIG9yZGVySXRlbUtleXNbaV0pKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIHJldHVybiBvcmRlcktleXMubGVuZ3RoID8gdXRpbC5mb3JtYXQoJ09SREVSIEJZICVzJywgb3JkZXJLZXlzLmpvaW4oJywgJykpIDogJyAnO1xufTtcblxucGFyc2VyLmdldF9saW1pdF9jbGF1c2UgPSBmdW5jdGlvbiBmKHF1ZXJ5T2JqZWN0KSB7XG4gIGxldCBsaW1pdCA9IG51bGw7XG4gIE9iamVjdC5rZXlzKHF1ZXJ5T2JqZWN0KS5mb3JFYWNoKChrKSA9PiB7XG4gICAgY29uc3QgcXVlcnlJdGVtID0gcXVlcnlPYmplY3Rba107XG4gICAgaWYgKGsudG9Mb3dlckNhc2UoKSA9PT0gJyRsaW1pdCcpIHtcbiAgICAgIGlmICh0eXBlb2YgcXVlcnlJdGVtICE9PSAnbnVtYmVyJykgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLmZpbmQubGltaXR0eXBlJykpO1xuICAgICAgbGltaXQgPSBxdWVyeUl0ZW07XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGxpbWl0ID8gdXRpbC5mb3JtYXQoJ0xJTUlUICVzJywgbGltaXQpIDogJyAnO1xufTtcblxucGFyc2VyLmdldF9zZWxlY3RfY2xhdXNlID0gZnVuY3Rpb24gZihvcHRpb25zKSB7XG4gIGxldCBzZWxlY3RDbGF1c2UgPSAnKic7XG4gIGlmIChvcHRpb25zLnNlbGVjdCAmJiBfLmlzQXJyYXkob3B0aW9ucy5zZWxlY3QpICYmIG9wdGlvbnMuc2VsZWN0Lmxlbmd0aCA+IDApIHtcbiAgICBjb25zdCBzZWxlY3RBcnJheSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5zZWxlY3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIC8vIHNlcGFyYXRlIHRoZSBhZ2dyZWdhdGUgZnVuY3Rpb24gYW5kIHRoZSBjb2x1bW4gbmFtZSBpZiBzZWxlY3QgaXMgYW4gYWdncmVnYXRlIGZ1bmN0aW9uXG4gICAgICBjb25zdCBzZWxlY3Rpb24gPSBvcHRpb25zLnNlbGVjdFtpXS5zcGxpdCgvWyggKV0vZykuZmlsdGVyKChlKSA9PiAoZSkpO1xuICAgICAgaWYgKHNlbGVjdGlvbi5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgc2VsZWN0QXJyYXkucHVzaCh1dGlsLmZvcm1hdCgnXCIlc1wiJywgc2VsZWN0aW9uWzBdKSk7XG4gICAgICB9IGVsc2UgaWYgKHNlbGVjdGlvbi5sZW5ndGggPT09IDIgfHwgc2VsZWN0aW9uLmxlbmd0aCA9PT0gNCkge1xuICAgICAgICBsZXQgZnVuY3Rpb25DbGF1c2UgPSB1dGlsLmZvcm1hdCgnJXMoXCIlc1wiKScsIHNlbGVjdGlvblswXSwgc2VsZWN0aW9uWzFdKTtcbiAgICAgICAgaWYgKHNlbGVjdGlvblsyXSkgZnVuY3Rpb25DbGF1c2UgKz0gdXRpbC5mb3JtYXQoJyAlcycsIHNlbGVjdGlvblsyXSk7XG4gICAgICAgIGlmIChzZWxlY3Rpb25bM10pIGZ1bmN0aW9uQ2xhdXNlICs9IHV0aWwuZm9ybWF0KCcgJXMnLCBzZWxlY3Rpb25bM10pO1xuXG4gICAgICAgIHNlbGVjdEFycmF5LnB1c2goZnVuY3Rpb25DbGF1c2UpO1xuICAgICAgfSBlbHNlIGlmIChzZWxlY3Rpb24ubGVuZ3RoID09PSAzKSB7XG4gICAgICAgIHNlbGVjdEFycmF5LnB1c2godXRpbC5mb3JtYXQoJ1wiJXNcIiAlcyAlcycsIHNlbGVjdGlvblswXSwgc2VsZWN0aW9uWzFdLCBzZWxlY3Rpb25bMl0pKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGVjdEFycmF5LnB1c2goJyonKTtcbiAgICAgIH1cbiAgICB9XG4gICAgc2VsZWN0Q2xhdXNlID0gc2VsZWN0QXJyYXkuam9pbignLCcpO1xuICB9XG4gIHJldHVybiBzZWxlY3RDbGF1c2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHBhcnNlcjtcbiJdfQ==