'use strict';

var semver = require('semver');

if (!semver.satisfies(process.version, '>=6.0.0')) {
  require('babel-polyfill');
}

var Promise = require('bluebird');
var _ = require('lodash');
var path = require('path');

var dseDriver = void 0;
try {
  // eslint-disable-next-line import/no-extraneous-dependencies, import/no-unresolved
  dseDriver = require('dse-driver');
} catch (e) {
  dseDriver = null;
}

var cql = Promise.promisifyAll(dseDriver || require('cassandra-driver'));

var ORM = Promise.promisifyAll(require('./orm/apollo'));
var readdirpAsync = Promise.promisify(require('readdirp'));
var debug = require('debug')('express-cassandra');

var exporter = require('./utils/exporter');
var importer = require('./utils/importer');

var CassandraClient = function f(options) {
  this.modelInstance = {};
  this.orm = new ORM(options.clientOptions, options.ormOptions);
  this.orm = Promise.promisifyAll(this.orm);
};

CassandraClient.createClient = function (options) {
  return new CassandraClient(options);
};

CassandraClient.setDirectory = function (directory) {
  CassandraClient.directory = directory;
  return CassandraClient;
};

CassandraClient.syncModelFileToDB = function (file, callback) {
  if (!file.name.includes('Model')) {
    callback();
    return;
  }

  var modelName = CassandraClient._translateFileNameToModelName(file.name);

  if (modelName) {
    var fileLocation = path.join(CassandraClient.directory, file.path);
    // eslint-disable-next-line import/no-dynamic-require
    var modelSchema = require(fileLocation);
    CassandraClient.modelInstance[modelName] = CassandraClient.orm.addModel(modelName.toLowerCase(), modelSchema);
    CassandraClient.modelInstance[modelName].syncDB(callback);
    CassandraClient.modelInstance[modelName] = Promise.promisifyAll(CassandraClient.modelInstance[modelName]);
    return;
  }

  callback();
};

CassandraClient.bind = function (options, cb) {
  CassandraClient.modelInstance = {};
  CassandraClient.orm = new ORM(options.clientOptions, options.ormOptions);
  CassandraClient.orm = Promise.promisifyAll(CassandraClient.orm);
  CassandraClient.orm.initAsync().then(function () {
    return readdirpAsync({
      root: CassandraClient.directory,
      fileFilter: ['*.js', '*.javascript', '*.jsx', '*.coffee', '*.coffeescript', '*.iced', '*.script', '*.ts', '*.tsx', '*.typescript', '*.cjsx', '*.co', '*.json', '*.json5', '*.litcoffee', '*.liticed', '*.ls', '*.node', '*.toml', '*.wisp']
    });
  }).then(function (fileList) {
    var syncModelTasks = [];
    var syncModelFileToDBAsync = Promise.promisify(CassandraClient.syncModelFileToDB);
    fileList = fileList.files;
    fileList.forEach(function (file) {
      syncModelTasks.push(syncModelFileToDBAsync(file));
    });
    return Promise.all(syncModelTasks);
  }).then(function () {
    if (cb) cb();
  }).catch(function (err) {
    if (cb && _.isArray(err) && err.length > 0) cb(err[0]);else if (cb) cb(err);
  });
};

CassandraClient.bindAsync = Promise.promisify(CassandraClient.bind);

CassandraClient.prototype.init = function f(callback) {
  this.orm.init(callback);
};

CassandraClient.prototype.initAsync = Promise.promisify(CassandraClient.prototype.init);

CassandraClient.getTableList = function f(callback) {
  var systemClient = this.orm.get_system_client();
  var keyspace = this.orm.get_keyspace_name();
  var tables = [];

  systemClient.connect().then(function () {
    var systemQuery = 'SELECT table_name FROM system_schema.tables WHERE keyspace_name = ?';
    debug(`Finding tables in keyspace: ${keyspace}`);
    return systemClient.execute(systemQuery, [keyspace]);
  }).then(function (result) {
    for (var i = 0; i < result.rows.length; i++) {
      tables.push(result.rows[i].table_name);
    }
  }).then(function () {
    return systemClient.shutdown();
  }).then(function () {
    callback(null, tables);
  }).catch(function (err) {
    callback(err);
  });
};

CassandraClient.getTableListAsync = Promise.promisify(CassandraClient.getTableList);

CassandraClient.export = function f(fixtureDirectory, callback) {
  var _this = this;

  var systemClient = this.orm.get_system_client();
  var keyspace = this.orm.get_keyspace_name();

  systemClient.connect().then(function () {
    return _this.getTableListAsync();
  }).then(function (tables) {
    return Promise.each(tables, function (table) {
      return exporter.processTableExport(systemClient, fixtureDirectory, keyspace, table);
    });
  }).then(function () {
    return systemClient.shutdown();
  }).then(function () {
    debug('==================================================');
    debug(`Completed exporting all tables from keyspace: ${keyspace}`);
    callback();
  }).catch(function (err) {
    debug(err);
    callback(err);
  });
};

CassandraClient.exportAsync = Promise.promisify(CassandraClient.export);

CassandraClient.import = function f(fixtureDirectory, options, callback) {
  var _this2 = this;

  if (arguments.length === 2) {
    callback = options;
    options = {};
  }

  var defaults = {
    batchSize: 1
  };

  options = _.defaultsDeep(options, defaults);

  var systemClient = this.orm.get_system_client();
  var keyspace = this.orm.get_keyspace_name();

  systemClient.connect().then(function () {
    return _this2.getTableListAsync();
  }).then(function (tables) {
    return Promise.each(tables, function (table) {
      return importer.processTableImport(systemClient, fixtureDirectory, keyspace, table, options.batchSize);
    });
  }).then(function () {
    return systemClient.shutdown();
  }).then(function () {
    debug('==================================================');
    debug(`Completed importing to keyspace: ${keyspace}`);
    callback();
  }).catch(function (err) {
    debug(err);
    callback(err);
  });
};

CassandraClient.importAsync = Promise.promisify(CassandraClient.import);

CassandraClient.prototype.loadSchema = function f(modelName, modelSchema) {
  this.modelInstance[modelName] = this.orm.addModel(modelName, modelSchema);
  this.modelInstance[modelName] = Promise.promisifyAll(this.modelInstance[modelName]);
  return this.modelInstance[modelName];
};

CassandraClient.uuid = function () {
  return cql.types.Uuid.random();
};

CassandraClient.uuidFromString = function (str) {
  return cql.types.Uuid.fromString(str);
};

CassandraClient.uuidFromBuffer = function (buf) {
  return new cql.types.Uuid(buf);
};

CassandraClient.timeuuid = function () {
  return cql.types.TimeUuid.now();
};

CassandraClient.timeuuidFromDate = function (date) {
  return cql.types.TimeUuid.fromDate(date);
};

CassandraClient.timeuuidFromString = function (str) {
  return cql.types.TimeUuid.fromString(str);
};

CassandraClient.timeuuidFromBuffer = function (buf) {
  return new cql.types.TimeUuid(buf);
};

CassandraClient.maxTimeuuid = function (date) {
  return cql.types.TimeUuid.max(date);
};

CassandraClient.minTimeuuid = function (date) {
  return cql.types.TimeUuid.min(date);
};

CassandraClient.prototype.doBatch = function f(queries, options, callback) {
  if (arguments.length === 2) {
    callback = options;
    options = {};
  }

  var defaults = {
    prepare: true
  };

  options = _.defaultsDeep(options, defaults);

  var randomModel = this.modelInstance[Object.keys(this.modelInstance)[0]];
  var beforeHooks = [];

  var batchResult = void 0;
  Promise.all(beforeHooks).then(function () {
    if (queries.length > 1) {
      return randomModel.execute_batchAsync(queries, options);
    }
    if (queries.length > 0) {
      debug('single query provided for batch request, applying as non batch query');
      return randomModel.execute_queryAsync(queries[0].query, queries[0].params, options);
    }
    debug('no queries provided for batch request, empty array found, doing nothing');
    return {};
  }).then(function (response) {
    batchResult = response;
    for (var i = 0; i < queries.length; i++) {
      var afterHookResponse = queries[i].after_hook();
      if (afterHookResponse !== true) {
        callback(afterHookResponse);
        return;
      }
    }
    callback(null, batchResult);
  }).catch(function (err) {
    callback(err);
  });
};

CassandraClient.prototype.doBatchAsync = Promise.promisify(CassandraClient.prototype.doBatch);

CassandraClient.doBatch = function f(queries, options, callback) {
  if (arguments.length === 2) {
    callback = options;
    options = {};
  }

  var defaults = {
    prepare: true
  };

  options = _.defaultsDeep(options, defaults);

  CassandraClient.prototype.doBatch.call(CassandraClient, queries, options, callback);
};

CassandraClient.doBatchAsync = Promise.promisify(CassandraClient.doBatch);

CassandraClient._translateFileNameToModelName = function (fileName) {
  return fileName.slice(0, fileName.lastIndexOf('.')).replace('Model', '');
};

Object.defineProperties(CassandraClient, {
  consistencies: {
    get() {
      return cql.types.consistencies;
    }
  },
  datatypes: {
    get() {
      return cql.types;
    }
  },
  driver: {
    get() {
      return cql;
    }
  },
  instance: {
    get() {
      return CassandraClient.modelInstance;
    }
  },
  close: {
    get() {
      return CassandraClient.orm.close;
    }
  },
  closeAsync: {
    get() {
      return Promise.promisify(CassandraClient.orm.close);
    }
  }
});

Object.defineProperties(CassandraClient.prototype, {
  consistencies: {
    get() {
      return cql.types.consistencies;
    }
  },
  datatypes: {
    get() {
      return cql.types;
    }
  },
  driver: {
    get() {
      return cql;
    }
  },
  instance: {
    get() {
      return this.modelInstance;
    }
  },
  close: {
    get() {
      return this.orm.close;
    }
  },
  closeAsync: {
    get() {
      return Promise.promisify(this.orm.close);
    }
  }
});

CassandraClient.prototype.uuid = CassandraClient.uuid;
CassandraClient.prototype.uuidFromString = CassandraClient.uuidFromString;
CassandraClient.prototype.uuidFromBuffer = CassandraClient.uuidFromBuffer;
CassandraClient.prototype.timeuuid = CassandraClient.timeuuid;
CassandraClient.prototype.timeuuidFromDate = CassandraClient.timeuuidFromDate;
CassandraClient.prototype.timeuuidFromString = CassandraClient.timeuuidFromString;
CassandraClient.prototype.timeuuidFromBuffer = CassandraClient.timeuuidFromBuffer;
CassandraClient.prototype.maxTimeuuid = CassandraClient.maxTimeuuid;
CassandraClient.prototype.minTimeuuid = CassandraClient.minTimeuuid;

CassandraClient.prototype._translateFileNameToModelName = CassandraClient._translateFileNameToModelName;

module.exports = CassandraClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9leHByZXNzQ2Fzc2FuZHJhLmpzIl0sIm5hbWVzIjpbInNlbXZlciIsInJlcXVpcmUiLCJzYXRpc2ZpZXMiLCJwcm9jZXNzIiwidmVyc2lvbiIsIlByb21pc2UiLCJfIiwicGF0aCIsImRzZURyaXZlciIsImUiLCJjcWwiLCJwcm9taXNpZnlBbGwiLCJPUk0iLCJyZWFkZGlycEFzeW5jIiwicHJvbWlzaWZ5IiwiZGVidWciLCJleHBvcnRlciIsImltcG9ydGVyIiwiQ2Fzc2FuZHJhQ2xpZW50IiwiZiIsIm9wdGlvbnMiLCJtb2RlbEluc3RhbmNlIiwib3JtIiwiY2xpZW50T3B0aW9ucyIsIm9ybU9wdGlvbnMiLCJjcmVhdGVDbGllbnQiLCJzZXREaXJlY3RvcnkiLCJkaXJlY3RvcnkiLCJzeW5jTW9kZWxGaWxlVG9EQiIsImZpbGUiLCJjYWxsYmFjayIsIm5hbWUiLCJpbmNsdWRlcyIsIm1vZGVsTmFtZSIsIl90cmFuc2xhdGVGaWxlTmFtZVRvTW9kZWxOYW1lIiwiZmlsZUxvY2F0aW9uIiwiam9pbiIsIm1vZGVsU2NoZW1hIiwiYWRkTW9kZWwiLCJ0b0xvd2VyQ2FzZSIsInN5bmNEQiIsImJpbmQiLCJjYiIsImluaXRBc3luYyIsInRoZW4iLCJyb290IiwiZmlsZUZpbHRlciIsImZpbGVMaXN0Iiwic3luY01vZGVsVGFza3MiLCJzeW5jTW9kZWxGaWxlVG9EQkFzeW5jIiwiZmlsZXMiLCJmb3JFYWNoIiwicHVzaCIsImFsbCIsImNhdGNoIiwiZXJyIiwiaXNBcnJheSIsImxlbmd0aCIsImJpbmRBc3luYyIsInByb3RvdHlwZSIsImluaXQiLCJnZXRUYWJsZUxpc3QiLCJzeXN0ZW1DbGllbnQiLCJnZXRfc3lzdGVtX2NsaWVudCIsImtleXNwYWNlIiwiZ2V0X2tleXNwYWNlX25hbWUiLCJ0YWJsZXMiLCJjb25uZWN0Iiwic3lzdGVtUXVlcnkiLCJleGVjdXRlIiwicmVzdWx0IiwiaSIsInJvd3MiLCJ0YWJsZV9uYW1lIiwic2h1dGRvd24iLCJnZXRUYWJsZUxpc3RBc3luYyIsImV4cG9ydCIsImZpeHR1cmVEaXJlY3RvcnkiLCJlYWNoIiwidGFibGUiLCJwcm9jZXNzVGFibGVFeHBvcnQiLCJleHBvcnRBc3luYyIsImltcG9ydCIsImFyZ3VtZW50cyIsImRlZmF1bHRzIiwiYmF0Y2hTaXplIiwiZGVmYXVsdHNEZWVwIiwicHJvY2Vzc1RhYmxlSW1wb3J0IiwiaW1wb3J0QXN5bmMiLCJsb2FkU2NoZW1hIiwidXVpZCIsInR5cGVzIiwiVXVpZCIsInJhbmRvbSIsInV1aWRGcm9tU3RyaW5nIiwic3RyIiwiZnJvbVN0cmluZyIsInV1aWRGcm9tQnVmZmVyIiwiYnVmIiwidGltZXV1aWQiLCJUaW1lVXVpZCIsIm5vdyIsInRpbWV1dWlkRnJvbURhdGUiLCJkYXRlIiwiZnJvbURhdGUiLCJ0aW1ldXVpZEZyb21TdHJpbmciLCJ0aW1ldXVpZEZyb21CdWZmZXIiLCJtYXhUaW1ldXVpZCIsIm1heCIsIm1pblRpbWV1dWlkIiwibWluIiwiZG9CYXRjaCIsInF1ZXJpZXMiLCJwcmVwYXJlIiwicmFuZG9tTW9kZWwiLCJPYmplY3QiLCJrZXlzIiwiYmVmb3JlSG9va3MiLCJiYXRjaFJlc3VsdCIsImV4ZWN1dGVfYmF0Y2hBc3luYyIsImV4ZWN1dGVfcXVlcnlBc3luYyIsInF1ZXJ5IiwicGFyYW1zIiwicmVzcG9uc2UiLCJhZnRlckhvb2tSZXNwb25zZSIsImFmdGVyX2hvb2siLCJkb0JhdGNoQXN5bmMiLCJjYWxsIiwiZmlsZU5hbWUiLCJzbGljZSIsImxhc3RJbmRleE9mIiwicmVwbGFjZSIsImRlZmluZVByb3BlcnRpZXMiLCJjb25zaXN0ZW5jaWVzIiwiZ2V0IiwiZGF0YXR5cGVzIiwiZHJpdmVyIiwiaW5zdGFuY2UiLCJjbG9zZSIsImNsb3NlQXN5bmMiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQU1BLFNBQVNDLFFBQVEsUUFBUixDQUFmOztBQUVBLElBQUksQ0FBQ0QsT0FBT0UsU0FBUCxDQUFpQkMsUUFBUUMsT0FB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UUFBMUIsR0FBcUNqRixnQkFBZ0JpRixRQUFyRDtBQUNBakYsZ0JBQWdCeUMsU0FBaEIsQ0FBMEIyQyxnQkFBMUIsR0FBNkNwRixnQkFBZ0JvRixnQkFBN0Q7QUFDQXBGLGdCQUFnQnlDLFNBQWhCLENBQTBCOEMsa0JBQTFCLEdBQStDdkYsZ0JBQWdCdUYsa0JBQS9EO0FBQ0F2RixnQkFBZ0J5QyxTQUFoQixDQUEwQitDLGtCQUExQixHQUErQ3hGLGdCQUFnQndGLGtCQUEvRDtBQUNBeEYsZ0JBQWdCeUMsU0FBaEIsQ0FBMEJnRCxXQUExQixHQUF3Q3pGLGdCQUFnQnlGLFdBQXhEO0FBQ0F6RixnQkFBZ0J5QyxTQUFoQixDQUEwQmtELFdBQTFCLEdBQXdDM0YsZ0JBQWdCMkYsV0FBeEQ7O0FBRUEzRixnQkFBZ0J5QyxTQUFoQixDQUEwQnpCLDZCQUExQixHQUEwRGhCLGdCQUFnQmdCLDZCQUExRTs7QUFFQTBHLE9BQU9DLE9BQVAsR0FBaUIzSCxlQUFqQiIsImZpbGUiOiJleHByZXNzQ2Fzc2FuZHJhLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc2VtdmVyID0gcmVxdWlyZSgnc2VtdmVyJyk7XG5cbmlmICghc2VtdmVyLnNhdGlzZmllcyhwcm9jZXNzLnZlcnNpb24sICc+PTYuMC4wJykpIHtcbiAgcmVxdWlyZSgnYmFiZWwtcG9seWZpbGwnKTtcbn1cblxuY29uc3QgUHJvbWlzZSA9IHJlcXVpcmUoJ2JsdWViaXJkJyk7XG5jb25zdCBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuXG5sZXQgZHNlRHJpdmVyO1xudHJ5IHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGltcG9ydC9uby1leHRyYW5lb3VzLWRlcGVuZGVuY2llcywgaW1wb3J0L25vLXVucmVzb2x2ZWRcbiAgZHNlRHJpdmVyID0gcmVxdWlyZSgnZHNlLWRyaXZlcicpO1xufSBjYXRjaCAoZSkge1xuICBkc2VEcml2ZXIgPSBudWxsO1xufVxuXG5jb25zdCBjcWwgPSBQcm9taXNlLnByb21pc2lmeUFsbChkc2VEcml2ZXIgfHwgcmVxdWlyZSgnY2Fzc2FuZHJhLWRyaXZlcicpKTtcblxuY29uc3QgT1JNID0gUHJvbWlzZS5wcm9taXNpZnlBbGwocmVxdWlyZSgnLi9vcm0vYXBvbGxvJykpO1xuY29uc3QgcmVhZGRpcnBBc3luYyA9IFByb21pc2UucHJvbWlzaWZ5KHJlcXVpcmUoJ3JlYWRkaXJwJykpO1xuY29uc3QgZGVidWcgPSByZXF1aXJlKCdkZWJ1ZycpKCdleHByZXNzLWNhc3NhbmRyYScpO1xuXG5jb25zdCBleHBvcnRlciA9IHJlcXVpcmUoJy4vdXRpbHMvZXhwb3J0ZXInKTtcbmNvbnN0IGltcG9ydGVyID0gcmVxdWlyZSgnLi91dGlscy9pbXBvcnRlcicpO1xuXG5jb25zdCBDYXNzYW5kcmFDbGllbnQgPSBmdW5jdGlvbiBmKG9wdGlvbnMpIHtcbiAgdGhpcy5tb2RlbEluc3RhbmNlID0ge307XG4gIHRoaXMub3JtID0gbmV3IE9STShvcHRpb25zLmNsaWVudE9wdGlvbnMsIG9wdGlvbnMub3JtT3B0aW9ucyk7XG4gIHRoaXMub3JtID0gUHJvbWlzZS5wcm9taXNpZnlBbGwodGhpcy5vcm0pO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LmNyZWF0ZUNsaWVudCA9IChvcHRpb25zKSA9PiAobmV3IENhc3NhbmRyYUNsaWVudChvcHRpb25zKSk7XG5cbkNhc3NhbmRyYUNsaWVudC5zZXREaXJlY3RvcnkgPSAoZGlyZWN0b3J5KSA9PiB7XG4gIENhc3NhbmRyYUNsaWVudC5kaXJlY3RvcnkgPSBkaXJlY3Rvcnk7XG4gIHJldHVybiBDYXNzYW5kcmFDbGllbnQ7XG59O1xuXG5DYXNzYW5kcmFDbGllbnQuc3luY01vZGVsRmlsZVRvREIgPSAoZmlsZSwgY2FsbGJhY2spID0+IHtcbiAgaWYgKCFmaWxlLm5hbWUuaW5jbHVkZXMoJ01vZGVsJykpIHtcbiAgICBjYWxsYmFjaygpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGVsTmFtZSA9IENhc3NhbmRyYUNsaWVudC5fdHJhbnNsYXRlRmlsZU5hbWVUb01vZGVsTmFtZShmaWxlLm5hbWUpO1xuXG4gIGlmIChtb2RlbE5hbWUpIHtcbiAgICBjb25zdCBmaWxlTG9jYXRpb24gPSBwYXRoLmpvaW4oQ2Fzc2FuZHJhQ2xpZW50LmRpcmVjdG9yeSwgZmlsZS5wYXRoKTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgaW1wb3J0L25vLWR5bmFtaWMtcmVxdWlyZVxuICAgIGNvbnN0IG1vZGVsU2NoZW1hID0gcmVxdWlyZShmaWxlTG9jYXRpb24pO1xuICAgIENhc3NhbmRyYUNsaWVudC5tb2RlbEluc3RhbmNlW21vZGVsTmFtZV0gPSBDYXNzYW5kcmFDbGllbnQub3JtLmFkZE1vZGVsKG1vZGVsTmFtZS50b0xvd2VyQ2FzZSgpLCBtb2RlbFNjaGVtYSk7XG4gICAgQ2Fzc2FuZHJhQ2xpZW50Lm1vZGVsSW5zdGFuY2VbbW9kZWxOYW1lXS5zeW5jREIoY2FsbGJhY2spO1xuICAgIENhc3NhbmRyYUNsaWVudC5tb2RlbEluc3RhbmNlW21vZGVsTmFtZV0gPSBQcm9taXNlLnByb21pc2lmeUFsbChDYXNzYW5kcmFDbGllbnQubW9kZWxJbnN0YW5jZVttb2RlbE5hbWVdKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjYWxsYmFjaygpO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LmJpbmQgPSAob3B0aW9ucywgY2IpID0+IHtcbiAgQ2Fzc2FuZHJhQ2xpZW50Lm1vZGVsSW5zdGFuY2UgPSB7fTtcbiAgQ2Fzc2FuZHJhQ2xpZW50Lm9ybSA9IG5ldyBPUk0ob3B0aW9ucy5jbGllbnRPcHRpb25zLCBvcHRpb25zLm9ybU9wdGlvbnMpO1xuICBDYXNzYW5kcmFDbGllbnQub3JtID0gUHJvbWlzZS5wcm9taXNpZnlBbGwoQ2Fzc2FuZHJhQ2xpZW50Lm9ybSk7XG4gIENhc3NhbmRyYUNsaWVudC5vcm0uaW5pdEFzeW5jKClcbiAgICAudGhlbigoKSA9PiByZWFkZGlycEFzeW5jKHtcbiAgICAgIHJvb3Q6IENhc3NhbmRyYUNsaWVudC5kaXJlY3RvcnksXG4gICAgICBmaWxlRmlsdGVyOiBbXG4gICAgICAgICcqLmpzJywgJyouamF2YXNjcmlwdCcsICcqLmpzeCcsICcqLmNvZmZlZScsICcqLmNvZmZlZXNjcmlwdCcsICcqLmljZWQnLFxuICAgICAgICAnKi5zY3JpcHQnLCAnKi50cycsICcqLnRzeCcsICcqLnR5cGVzY3JpcHQnLCAnKi5janN4JywgJyouY28nLCAnKi5qc29uJyxcbiAgICAgICAgJyouanNvbjUnLCAnKi5saXRjb2ZmZWUnLCAnKi5saXRpY2VkJywgJyoubHMnLCAnKi5ub2RlJywgJyoudG9tbCcsICcqLndpc3AnLFxuICAgICAgXSxcbiAgICB9KSlcbiAgICAudGhlbigoZmlsZUxpc3QpID0+IHtcbiAgICAgIGNvbnN0IHN5bmNNb2RlbFRhc2tzID0gW107XG4gICAgICBjb25zdCBzeW5jTW9kZWxGaWxlVG9EQkFzeW5jID0gUHJvbWlzZS5wcm9taXNpZnkoQ2Fzc2FuZHJhQ2xpZW50LnN5bmNNb2RlbEZpbGVUb0RCKTtcbiAgICAgIGZpbGVMaXN0ID0gZmlsZUxpc3QuZmlsZXM7XG4gICAgICBmaWxlTGlzdC5mb3JFYWNoKChmaWxlKSA9PiB7XG4gICAgICAgIHN5bmNNb2RlbFRhc2tzLnB1c2goc3luY01vZGVsRmlsZVRvREJBc3luYyhmaWxlKSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChzeW5jTW9kZWxUYXNrcyk7XG4gICAgfSlcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBpZiAoY2IpIGNiKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgaWYgKGNiICYmIF8uaXNBcnJheShlcnIpICYmIGVyci5sZW5ndGggPiAwKSBjYihlcnJbMF0pO1xuICAgICAgZWxzZSBpZiAoY2IpIGNiKGVycik7XG4gICAgfSk7XG59O1xuXG5DYXNzYW5kcmFDbGllbnQuYmluZEFzeW5jID0gUHJvbWlzZS5wcm9taXNpZnkoQ2Fzc2FuZHJhQ2xpZW50LmJpbmQpO1xuXG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBmKGNhbGxiYWNrKSB7XG4gIHRoaXMub3JtLmluaXQoY2FsbGJhY2spO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS5pbml0QXN5bmMgPSBQcm9taXNlLnByb21pc2lmeShDYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLmluaXQpO1xuXG5DYXNzYW5kcmFDbGllbnQuZ2V0VGFibGVMaXN0ID0gZnVuY3Rpb24gZihjYWxsYmFjaykge1xuICBjb25zdCBzeXN0ZW1DbGllbnQgPSB0aGlzLm9ybS5nZXRfc3lzdGVtX2NsaWVudCgpO1xuICBjb25zdCBrZXlzcGFjZSA9IHRoaXMub3JtLmdldF9rZXlzcGFjZV9uYW1lKCk7XG4gIGNvbnN0IHRhYmxlcyA9IFtdO1xuXG4gIHN5c3RlbUNsaWVudC5jb25uZWN0KClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBjb25zdCBzeXN0ZW1RdWVyeSA9ICdTRUxFQ1QgdGFibGVfbmFtZSBGUk9NIHN5c3RlbV9zY2hlbWEudGFibGVzIFdIRVJFIGtleXNwYWNlX25hbWUgPSA/JztcbiAgICAgIGRlYnVnKGBGaW5kaW5nIHRhYmxlcyBpbiBrZXlzcGFjZTogJHtrZXlzcGFjZX1gKTtcbiAgICAgIHJldHVybiBzeXN0ZW1DbGllbnQuZXhlY3V0ZShzeXN0ZW1RdWVyeSwgW2tleXNwYWNlXSk7XG4gICAgfSlcbiAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3VsdC5yb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRhYmxlcy5wdXNoKHJlc3VsdC5yb3dzW2ldLnRhYmxlX25hbWUpO1xuICAgICAgfVxuICAgIH0pXG4gICAgLnRoZW4oKCkgPT4gc3lzdGVtQ2xpZW50LnNodXRkb3duKCkpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgY2FsbGJhY2sobnVsbCwgdGFibGVzKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjYWxsYmFjayhlcnIpO1xuICAgIH0pO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LmdldFRhYmxlTGlzdEFzeW5jID0gUHJvbWlzZS5wcm9taXNpZnkoQ2Fzc2FuZHJhQ2xpZW50LmdldFRhYmxlTGlzdCk7XG5cbkNhc3NhbmRyYUNsaWVudC5leHBvcnQgPSBmdW5jdGlvbiBmKGZpeHR1cmVEaXJlY3RvcnksIGNhbGxiYWNrKSB7XG4gIGNvbnN0IHN5c3RlbUNsaWVudCA9IHRoaXMub3JtLmdldF9zeXN0ZW1fY2xpZW50KCk7XG4gIGNvbnN0IGtleXNwYWNlID0gdGhpcy5vcm0uZ2V0X2tleXNwYWNlX25hbWUoKTtcblxuICBzeXN0ZW1DbGllbnQuY29ubmVjdCgpXG4gICAgLnRoZW4oKCkgPT4gdGhpcy5nZXRUYWJsZUxpc3RBc3luYygpKVxuICAgIC50aGVuKCh0YWJsZXMpID0+XG4gICAgICBQcm9taXNlLmVhY2godGFibGVzLCAodGFibGUpID0+XG4gICAgICAgIGV4cG9ydGVyLnByb2Nlc3NUYWJsZUV4cG9ydChzeXN0ZW1DbGllbnQsIGZpeHR1cmVEaXJlY3RvcnksIGtleXNwYWNlLCB0YWJsZSkpKVxuICAgIC50aGVuKCgpID0+IHN5c3RlbUNsaWVudC5zaHV0ZG93bigpKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGRlYnVnKCc9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScpO1xuICAgICAgZGVidWcoYENvbXBsZXRlZCBleHBvcnRpbmcgYWxsIHRhYmxlcyBmcm9tIGtleXNwYWNlOiAke2tleXNwYWNlfWApO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBkZWJ1ZyhlcnIpO1xuICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICB9KTtcbn07XG5cbkNhc3NhbmRyYUNsaWVudC5leHBvcnRBc3luYyA9IFByb21pc2UucHJvbWlzaWZ5KENhc3NhbmRyYUNsaWVudC5leHBvcnQpO1xuXG5DYXNzYW5kcmFDbGllbnQuaW1wb3J0ID0gZnVuY3Rpb24gZihmaXh0dXJlRGlyZWN0b3J5LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xuICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICBvcHRpb25zID0ge307XG4gIH1cblxuICBjb25zdCBkZWZhdWx0cyA9IHtcbiAgICBiYXRjaFNpemU6IDEsXG4gIH07XG5cbiAgb3B0aW9ucyA9IF8uZGVmYXVsdHNEZWVwKG9wdGlvbnMsIGRlZmF1bHRzKTtcblxuICBjb25zdCBzeXN0ZW1DbGllbnQgPSB0aGlzLm9ybS5nZXRfc3lzdGVtX2NsaWVudCgpO1xuICBjb25zdCBrZXlzcGFjZSA9IHRoaXMub3JtLmdldF9rZXlzcGFjZV9uYW1lKCk7XG5cbiAgc3lzdGVtQ2xpZW50LmNvbm5lY3QoKVxuICAgIC50aGVuKCgpID0+IHRoaXMuZ2V0VGFibGVMaXN0QXN5bmMoKSlcbiAgICAudGhlbigodGFibGVzKSA9PlxuICAgICAgUHJvbWlzZS5lYWNoKHRhYmxlcywgKHRhYmxlKSA9PlxuICAgICAgICBpbXBvcnRlci5wcm9jZXNzVGFibGVJbXBvcnQoc3lzdGVtQ2xpZW50LCBmaXh0dXJlRGlyZWN0b3J5LCBrZXlzcGFjZSwgdGFibGUsIG9wdGlvbnMuYmF0Y2hTaXplKSkpXG4gICAgLnRoZW4oKCkgPT4gc3lzdGVtQ2xpZW50LnNodXRkb3duKCkpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgZGVidWcoJz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Jyk7XG4gICAgICBkZWJ1ZyhgQ29tcGxldGVkIGltcG9ydGluZyB0byBrZXlzcGFjZTogJHtrZXlzcGFjZX1gKTtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgZGVidWcoZXJyKTtcbiAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgfSk7XG59O1xuXG5DYXNzYW5kcmFDbGllbnQuaW1wb3J0QXN5bmMgPSBQcm9taXNlLnByb21pc2lmeShDYXNzYW5kcmFDbGllbnQuaW1wb3J0KTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS5sb2FkU2NoZW1hID0gZnVuY3Rpb24gZihtb2RlbE5hbWUsIG1vZGVsU2NoZW1hKSB7XG4gIHRoaXMubW9kZWxJbnN0YW5jZVttb2RlbE5hbWVdID0gdGhpcy5vcm0uYWRkTW9kZWwobW9kZWxOYW1lLCBtb2RlbFNjaGVtYSk7XG4gIHRoaXMubW9kZWxJbnN0YW5jZVttb2RlbE5hbWVdID0gUHJvbWlzZS5wcm9taXNpZnlBbGwodGhpcy5tb2RlbEluc3RhbmNlW21vZGVsTmFtZV0pO1xuICByZXR1cm4gdGhpcy5tb2RlbEluc3RhbmNlW21vZGVsTmFtZV07XG59O1xuXG5DYXNzYW5kcmFDbGllbnQudXVpZCA9ICgpID0+IChjcWwudHlwZXMuVXVpZC5yYW5kb20oKSk7XG5cbkNhc3NhbmRyYUNsaWVudC51dWlkRnJvbVN0cmluZyA9IChzdHIpID0+IChjcWwudHlwZXMuVXVpZC5mcm9tU3RyaW5nKHN0cikpO1xuXG5DYXNzYW5kcmFDbGllbnQudXVpZEZyb21CdWZmZXIgPSAoYnVmKSA9PiAobmV3IGNxbC50eXBlcy5VdWlkKGJ1ZikpO1xuXG5DYXNzYW5kcmFDbGllbnQudGltZXV1aWQgPSAoKSA9PiAoY3FsLnR5cGVzLlRpbWVVdWlkLm5vdygpKTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnRpbWV1dWlkRnJvbURhdGUgPSAoZGF0ZSkgPT4gKGNxbC50eXBlcy5UaW1lVXVpZC5mcm9tRGF0ZShkYXRlKSk7XG5cbkNhc3NhbmRyYUNsaWVudC50aW1ldXVpZEZyb21TdHJpbmcgPSAoc3RyKSA9PiAoY3FsLnR5cGVzLlRpbWVVdWlkLmZyb21TdHJpbmcoc3RyKSk7XG5cbkNhc3NhbmRyYUNsaWVudC50aW1ldXVpZEZyb21CdWZmZXIgPSAoYnVmKSA9PiAobmV3IGNxbC50eXBlcy5UaW1lVXVpZChidWYpKTtcblxuQ2Fzc2FuZHJhQ2xpZW50Lm1heFRpbWV1dWlkID0gKGRhdGUpID0+IChjcWwudHlwZXMuVGltZVV1aWQubWF4KGRhdGUpKTtcblxuQ2Fzc2FuZHJhQ2xpZW50Lm1pblRpbWV1dWlkID0gKGRhdGUpID0+IChjcWwudHlwZXMuVGltZVV1aWQubWluKGRhdGUpKTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS5kb0JhdGNoID0gZnVuY3Rpb24gZihxdWVyaWVzLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xuICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICBvcHRpb25zID0ge307XG4gIH1cblxuICBjb25zdCBkZWZhdWx0cyA9IHtcbiAgICBwcmVwYXJlOiB0cnVlLFxuICB9O1xuXG4gIG9wdGlvbnMgPSBfLmRlZmF1bHRzRGVlcChvcHRpb25zLCBkZWZhdWx0cyk7XG5cbiAgY29uc3QgcmFuZG9tTW9kZWwgPSB0aGlzLm1vZGVsSW5zdGFuY2VbT2JqZWN0LmtleXModGhpcy5tb2RlbEluc3RhbmNlKVswXV07XG4gIGNvbnN0IGJlZm9yZUhvb2tzID0gW107XG5cbiAgbGV0IGJhdGNoUmVzdWx0O1xuICBQcm9taXNlLmFsbChiZWZvcmVIb29rcylcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBpZiAocXVlcmllcy5sZW5ndGggPiAxKSB7XG4gICAgICAgIHJldHVybiByYW5kb21Nb2RlbC5leGVjdXRlX2JhdGNoQXN5bmMocXVlcmllcywgb3B0aW9ucyk7XG4gICAgICB9XG4gICAgICBpZiAocXVlcmllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGRlYnVnKCdzaW5nbGUgcXVlcnkgcHJvdmlkZWQgZm9yIGJhdGNoIHJlcXVlc3QsIGFwcGx5aW5nIGFzIG5vbiBiYXRjaCBxdWVyeScpO1xuICAgICAgICByZXR1cm4gcmFuZG9tTW9kZWwuZXhlY3V0ZV9xdWVyeUFzeW5jKHF1ZXJpZXNbMF0ucXVlcnksIHF1ZXJpZXNbMF0ucGFyYW1zLCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICAgIGRlYnVnKCdubyBxdWVyaWVzIHByb3ZpZGVkIGZvciBiYXRjaCByZXF1ZXN0LCBlbXB0eSBhcnJheSBmb3VuZCwgZG9pbmcgbm90aGluZycpO1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH0pXG4gICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICBiYXRjaFJlc3VsdCA9IHJlc3BvbnNlO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBxdWVyaWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGFmdGVySG9va1Jlc3BvbnNlID0gcXVlcmllc1tpXS5hZnRlcl9ob29rKCk7XG4gICAgICAgIGlmIChhZnRlckhvb2tSZXNwb25zZSAhPT0gdHJ1ZSkge1xuICAgICAgICAgIGNhbGxiYWNrKGFmdGVySG9va1Jlc3BvbnNlKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrKG51bGwsIGJhdGNoUmVzdWx0KTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjYWxsYmFjayhlcnIpO1xuICAgIH0pO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS5kb0JhdGNoQXN5bmMgPSBQcm9taXNlLnByb21pc2lmeShDYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLmRvQmF0Y2gpO1xuXG5DYXNzYW5kcmFDbGllbnQuZG9CYXRjaCA9IGZ1bmN0aW9uIGYocXVlcmllcywgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcbiAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgb3B0aW9ucyA9IHt9O1xuICB9XG5cbiAgY29uc3QgZGVmYXVsdHMgPSB7XG4gICAgcHJlcGFyZTogdHJ1ZSxcbiAgfTtcblxuICBvcHRpb25zID0gXy5kZWZhdWx0c0RlZXAob3B0aW9ucywgZGVmYXVsdHMpO1xuXG4gIENhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUuZG9CYXRjaC5jYWxsKENhc3NhbmRyYUNsaWVudCwgcXVlcmllcywgb3B0aW9ucywgY2FsbGJhY2spO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LmRvQmF0Y2hBc3luYyA9IFByb21pc2UucHJvbWlzaWZ5KENhc3NhbmRyYUNsaWVudC5kb0JhdGNoKTtcblxuQ2Fzc2FuZHJhQ2xpZW50Ll90cmFuc2xhdGVGaWxlTmFtZVRvTW9kZWxOYW1lID0gKGZpbGVOYW1lKSA9PiAoXG4gIGZpbGVOYW1lLnNsaWNlKDAsIGZpbGVOYW1lLmxhc3RJbmRleE9mKCcuJykpLnJlcGxhY2UoJ01vZGVsJywgJycpXG4pO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyhDYXNzYW5kcmFDbGllbnQsIHtcbiAgY29uc2lzdGVuY2llczoge1xuICAgIGdldCgpIHtcbiAgICAgIHJldHVybiBjcWwudHlwZXMuY29uc2lzdGVuY2llcztcbiAgICB9LFxuICB9LFxuICBkYXRhdHlwZXM6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gY3FsLnR5cGVzO1xuICAgIH0sXG4gIH0sXG4gIGRyaXZlcjoge1xuICAgIGdldCgpIHtcbiAgICAgIHJldHVybiBjcWw7XG4gICAgfSxcbiAgfSxcbiAgaW5zdGFuY2U6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gQ2Fzc2FuZHJhQ2xpZW50Lm1vZGVsSW5zdGFuY2U7XG4gICAgfSxcbiAgfSxcbiAgY2xvc2U6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gQ2Fzc2FuZHJhQ2xpZW50Lm9ybS5jbG9zZTtcbiAgICB9LFxuICB9LFxuICBjbG9zZUFzeW5jOiB7XG4gICAgZ2V0KCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucHJvbWlzaWZ5KENhc3NhbmRyYUNsaWVudC5vcm0uY2xvc2UpO1xuICAgIH0sXG4gIH0sXG59KTtcblxuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyhDYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLCB7XG4gIGNvbnNpc3RlbmNpZXM6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gY3FsLnR5cGVzLmNvbnNpc3RlbmNpZXM7XG4gICAgfSxcbiAgfSxcbiAgZGF0YXR5cGVzOiB7XG4gICAgZ2V0KCkge1xuICAgICAgcmV0dXJuIGNxbC50eXBlcztcbiAgICB9LFxuICB9LFxuICBkcml2ZXI6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gY3FsO1xuICAgIH0sXG4gIH0sXG4gIGluc3RhbmNlOiB7XG4gICAgZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMubW9kZWxJbnN0YW5jZTtcbiAgICB9LFxuICB9LFxuICBjbG9zZToge1xuICAgIGdldCgpIHtcbiAgICAgIHJldHVybiB0aGlzLm9ybS5jbG9zZTtcbiAgICB9LFxuICB9LFxuICBjbG9zZUFzeW5jOiB7XG4gICAgZ2V0KCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucHJvbWlzaWZ5KHRoaXMub3JtLmNsb3NlKTtcbiAgICB9LFxuICB9LFxufSk7XG5cbkNhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUudXVpZCA9IENhc3NhbmRyYUNsaWVudC51dWlkO1xuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS51dWlkRnJvbVN0cmluZyA9IENhc3NhbmRyYUNsaWVudC51dWlkRnJvbVN0cmluZztcbkNhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUudXVpZEZyb21CdWZmZXIgPSBDYXNzYW5kcmFDbGllbnQudXVpZEZyb21CdWZmZXI7XG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLnRpbWV1dWlkID0gQ2Fzc2FuZHJhQ2xpZW50LnRpbWV1dWlkO1xuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS50aW1ldXVpZEZyb21EYXRlID0gQ2Fzc2FuZHJhQ2xpZW50LnRpbWV1dWlkRnJvbURhdGU7XG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLnRpbWV1dWlkRnJvbVN0cmluZyA9IENhc3NhbmRyYUNsaWVudC50aW1ldXVpZEZyb21TdHJpbmc7XG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLnRpbWV1dWlkRnJvbUJ1ZmZlciA9IENhc3NhbmRyYUNsaWVudC50aW1ldXVpZEZyb21CdWZmZXI7XG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLm1heFRpbWV1dWlkID0gQ2Fzc2FuZHJhQ2xpZW50Lm1heFRpbWV1dWlkO1xuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS5taW5UaW1ldXVpZCA9IENhc3NhbmRyYUNsaWVudC5taW5UaW1ldXVpZDtcblxuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS5fdHJhbnNsYXRlRmlsZU5hbWVUb01vZGVsTmFtZSA9IENhc3NhbmRyYUNsaWVudC5fdHJhbnNsYXRlRmlsZU5hbWVUb01vZGVsTmFtZTtcblxubW9kdWxlLmV4cG9ydHMgPSBDYXNzYW5kcmFDbGllbnQ7XG4iXX0=