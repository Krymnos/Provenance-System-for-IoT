'use strict';

var _ = require('lodash');
var async = require('async');
var util = require('util');
var objectHash = require('object-hash');
var readlineSync = require('readline-sync');
var deepDiff = require('deep-diff').diff;

var buildError = require('../orm/apollo_error.js');
var schemer = require('../validators/schema');
var parser = require('../utils/parser');
var normalizer = require('../utils/normalizer');

var ElassandraBuilder = require('./elassandra');

var TableBuilder = function f(driver, properties) {
  this._driver = driver;
  this._properties = properties;
  if (this._properties.esclient) {
    this._es_builder = new ElassandraBuilder(this._properties.esclient);
  }
};

TableBuilder.prototype = {
  _confirm_migration(message) {
    var permission = 'y';
    if (message && !this._properties.disableTTYConfirmation) {
      permission = readlineSync.question(util.format('Migration: %s (y/n): ', message));
    }
    return permission.toLowerCase();
  },
  get_table(callback) {
    var properties = this._properties;
    var keyspaceName = properties.keyspace;
    var tableName = properties.table_name;
    var dbSchema = { fields: {}, typeMaps: {}, staticMaps: {} };
    var query = 'SELECT * FROM system_schema.columns WHERE table_name = ? AND keyspace_name = ?;';

    this._driver.execute_query(query, [tableName, keyspaceName], function (err, resultColumns) {
      if (err) {
        callback(buildError('model.tablecreation.dbschemaquery', err));
        return;
      }

      if (!resultColumns.rows || resultColumns.rows.length === 0) {
        callback();
        return;
      }

      for (var r = 0; r < resultColumns.rows.length; r++) {
        var row = resultColumns.rows[r];

        dbSchema.fields[row.column_name] = parser.extract_type(row.type);

        var typeMapDef = parser.extract_typeDef(row.type);
        if (typeMapDef.length > 0) {
          dbSchema.typeMaps[row.column_name] = typeMapDef;
        }

        if (row.kind === 'partition_key') {
          if (!dbSchema.key) dbSchema.key = [[]];
          dbSchema.key[0][row.position] = row.column_name;
        } else if (row.kind === 'clustering') {
          if (!dbSchema.key) dbSchema.key = [[]];
          if (!dbSchema.clustering_order) dbSchema.clustering_order = {};

          dbSchema.key[row.position + 1] = row.column_name;
          if (row.clustering_order && row.clustering_order.toLowerCase() === 'desc') {
            dbSchema.clustering_order[row.column_name] = 'DESC';
          } else {
            dbSchema.clustering_order[row.column_name] = 'ASC';
          }
        } else if (row.kind === 'static') {
          dbSchema.staticMaps[row.column_name] = true;
        }
      }

      callback(null, dbSchema);
    });
  },

  get_table_schema(callback) {
    var _this = this;

    this.get_table(function (err, dbSchema) {
      if (err) {
        callback(err);
        return;
      }
      if (!dbSchema) {
        callback();
        return;
      }
      _this.get_indexes(function (err1, indexSchema) {
        if (err1) {
          callback(err1);
          return;
        }
        _this.get_mviews(function (err2, viewSchema) {
          if (err2) {
            callback(err2);
            return;
          }
          Object.assign(dbSchema, indexSchema, viewSchema);
          callback(null, dbSchema);
        });
      });
    });
  },

  create_table(schema, callback) {
    var properties = this._properties;
    var tableName = properties.table_name;
    var rows = [];
    var fieldType = void 0;
    Object.keys(schema.fields).forEach(function (k) {
      if (schema.fields[k].virtual) {
        return;
      }
      var segment = '';
      fieldType = schemer.get_field_type(schema, k);
      if (schema.fields[k].typeDef) {
        segment = util.format('"%s" %s%s', k, fieldType, schema.fields[k].typeDef);
      } else {
        segment = util.format('"%s" %s', k, fieldType);
      }

      if (schema.fields[k].static) {
        segment += ' STATIC';
      }

      rows.push(segment);
    });

    var partitionKey = schema.key[0];
    var clusteringKey = schema.key.slice(1, schema.key.length);
    var clusteringOrder = [];

    for (var field = 0; field < clusteringKey.length; field++) {
      if (schema.clustering_order && schema.clustering_order[clusteringKey[field]] && schema.clustering_order[clusteringKey[field]].toLowerCase() === 'desc') {
        clusteringOrder.push(util.format('"%s" DESC', clusteringKey[field]));
      } else {
        clusteringOrder.push(util.format('"%s" ASC', clusteringKey[field]));
      }
    }

    var clusteringOrderQuery = '';
    if (clusteringOrder.length > 0) {
      clusteringOrderQuery = util.format(' WITH CLUSTERING ORDER BY (%s)', clusteringOrder.toString());
    }

    if (_.isArray(partitionKey)) {
      partitionKey = partitionKey.map(function (v) {
        return util.format('"%s"', v);
      }).join(',');
    } else {
      partitionKey = util.format('"%s"', partitionKey);
    }

    if (clusteringKey.length) {
      clusteringKey = clusteringKey.map(function (v) {
        return util.format('"%s"', v);
      }).join(',');
      clusteringKey = util.format(',%s', clusteringKey);
    } else {
      clusteringKey = '';
    }

    var query = util.format('CREATE TABLE IF NOT EXISTS "%s" (%s , PRIMARY KEY((%s)%s))%s;', tableName, rows.join(' , '), partitionKey, clusteringKey, clusteringOrderQuery);

    this._driver.execute_definition_query(query, [], function (err, result) {
      if (err) {
        callback(buildError('model.tablecreation.dbcreate', err));
        return;
      }
      callback(null, result);
    });
  },

  alter_table(operation, fieldname, type, callback) {
    var properties = this._properties;
    var tableName = properties.table_name;
    if (operation === 'ALTER') type = util.format('TYPE %s', type);else if (operation === 'DROP') type = '';

    var query = util.format('ALTER TABLE "%s" %s "%s" %s;', tableName, operation, fieldname, type);
    this._driver.execute_definition_query(query, [], callback);
  },

  _drop_table(tableName, callback) {
    var query = util.format('DROP TABLE IF EXISTS "%s";', tableName);
    this._driver.execute_definition_query(query, [], function (err) {
      if (err) {
        callback(buildError('model.tablecreation.dbdrop', err));
        return;
      }
      callback();
    });
  },

  drop_table(materializedViews, callback) {
    var _this2 = this;

    var properties = this._properties;
    var tableName = properties.table_name;
    var message = util.format('Schema for table "%s" has changed in a way where alter migration is not possible, all data in the table will be lost, are you sure you want to drop the table?', tableName);
    var permission = this._confirm_migration(message);
    if (permission !== 'y') {
      callback(buildError('model.tablecreation.schemamismatch', tableName, 'migration suspended, please apply the change manually'));
      return;
    }
    if (!materializedViews) {
      this._drop_table(tableName, callback);
      return;
    }

    var mviews = Object.keys(materializedViews);
    this.drop_mviews(mviews, function (err) {
      if (err) {
        callback(err);
        return;
      }

      _this2._drop_table(tableName, callback);
    });
  },

  drop_recreate_table(modelSchema, materializedViews, callback) {
    var _this3 = this;

    if (this._es_builder) {
      this._es_builder.delete_index(this._properties.keyspace, function () {
        _this3.drop_table(materializedViews, function (err1) {
          if (err1) {
            callback(err1);
            return;
          }
          _this3.create_table(modelSchema, callback);
        });
      });
      return;
    }
    this.drop_table(materializedViews, function (err1) {
      if (err1) {
        callback(err1);
        return;
      }
      _this3.create_table(modelSchema, callback);
    });
  },

  get_indexes(callback) {
    var properties = this._properties;
    var keyspaceName = properties.keyspace;
    var tableName = properties.table_name;
    var dbSchema = {};
    var query = 'SELECT * FROM system_schema.indexes WHERE table_name = ? AND keyspace_name = ?;';

    this._driver.execute_query(query, [tableName, keyspaceName], function (err, resultIndexes) {
      if (err) {
        callback(buildError('model.tablecreation.dbschemaquery', err));
        return;
      }

      for (var r = 0; r < resultIndexes.rows.length; r++) {
        var row = resultIndexes.rows[r];

        if (row.index_name && row.options.target) {
          var indexOptions = row.options;
          var target = indexOptions.target;
          target = target.replace(/["\s]/g, '');
          delete indexOptions.target;

          // keeping track of index names to drop index when needed
          if (!dbSchema.index_names) dbSchema.index_names = {};

          if (row.kind === 'CUSTOM') {
            var using = indexOptions.class_name;
            delete indexOptions.class_name;

            if (!dbSchema.custom_indexes) dbSchema.custom_indexes = [];
            var customIndexObject = {
              on: target,
              using,
              options: indexOptions
            };
            dbSchema.custom_indexes.push(customIndexObject);
            dbSchema.index_names[objectHash(customIndexObject)] = row.index_name;
          } else {
            if (!dbSchema.indexes) dbSchema.indexes = [];
            dbSchema.indexes.push(target);
            dbSchema.index_names[target] = row.index_name;
          }
        }
      }

      callback(null, dbSchema);
    });
  },

  _create_index_query(tableName, indexName) {
    var query = void 0;
    var indexExpression = indexName.replace(/["\s]/g, '').split(/[()]/g);
    if (indexExpression.length > 1) {
      indexExpression[0] = indexExpression[0].toLowerCase();
      query = util.format('CREATE INDEX IF NOT EXISTS ON "%s" (%s("%s"));', tableName, indexExpression[0], indexExpression[1]);
    } else {
      query = util.format('CREATE INDEX IF NOT EXISTS ON "%s" ("%s");', tableName, indexExpression[0]);
    }
    return query;
  },

  create_indexes(indexes, callback) {
    var _this4 = this;

    var properties = this._properties;
    var tableName = properties.table_name;
    async.eachSeries(indexes, function (idx, next) {
      _this4._driver.execute_definition_query(_this4._create_index_query(tableName, idx), [], function (err, result) {
        if (err) next(buildError('model.tablecreation.dbindexcreate', err));else next(null, result);
      });
    }, callback);
  },

  _create_custom_index_query(tableName, customIndex) {
    var query = util.format('CREATE CUSTOM INDEX IF NOT EXISTS ON "%s" ("%s") USING \'%s\'', tableName, customIndex.on, customIndex.using);

    if (Object.keys(customIndex.options).length > 0) {
      query += ' WITH OPTIONS = {';
      Object.keys(customIndex.options).forEach(function (key) {
        query += util.format("'%s': '%s', ", key, customIndex.options[key]);
      });
      query = query.slice(0, -2);
      query += '}';
    }

    query += ';';

    return query;
  },

  create_custom_indexes(customIndexes, callback) {
    var _this5 = this;

    var properties = this._properties;
    var tableName = properties.table_name;
    async.eachSeries(customIndexes, function (idx, next) {
      _this5._driver.execute_definition_query(_this5._create_custom_index_query(tableName, idx), [], function (err, result) {
        if (err) next(buildError('model.tablecreation.dbindexcreate', err));else next(null, result);
      });
    }, callback);
  },

  drop_indexes(indexes, callback) {
    var _this6 = this;

    async.each(indexes, function (idx, next) {
      var query = util.format('DROP INDEX IF EXISTS "%s";', idx);
      _this6._driver.execute_definition_query(query, [], next);
    }, function (err) {
      if (err) callback(buildError('model.tablecreation.dbindexdrop', err));else callback();
    });
  },

  get_mviews(callback) {
    var _this7 = this;

    var properties = this._properties;
    var keyspaceName = properties.keyspace;
    var tableName = properties.table_name;
    var dbSchema = {};
    var query = 'SELECT view_name,base_table_name FROM system_schema.views WHERE keyspace_name=? AND base_table_name=? ALLOW FILTERING;';

    this._driver.execute_query(query, [keyspaceName, tableName], function (err, resultViews) {
      if (err) {
        callback(buildError('model.tablecreation.dbschemaquery', err));
        return;
      }

      for (var r = 0; r < resultViews.rows.length; r++) {
        var row = resultViews.rows[r];

        if (row.view_name) {
          if (!dbSchema.materialized_views) dbSchema.materialized_views = {};
          dbSchema.materialized_views[row.view_name] = {};
        }
      }

      if (!dbSchema.materialized_views) {
        callback(null, dbSchema);
        return;
      }

      query = 'SELECT * FROM system_schema.columns WHERE keyspace_name=? and table_name IN ?;';

      var viewNames = Object.keys(dbSchema.materialized_views);
      _this7._driver.execute_query(query, [keyspaceName, viewNames], function (err1, resultMatViews) {
        if (err1) {
          callback(buildError('model.tablecreation.dbschemaquery', err1));
          return;
        }

        for (var _r = 0; _r < resultMatViews.rows.length; _r++) {
          var _row = resultMatViews.rows[_r];

          if (!dbSchema.materialized_views[_row.table_name].select) {
            dbSchema.materialized_views[_row.table_name].select = [];
          }

          dbSchema.materialized_views[_row.table_name].select.push(_row.column_name);

          if (_row.kind === 'partition_key') {
            if (!dbSchema.materialized_views[_row.table_name].key) {
              dbSchema.materialized_views[_row.table_name].key = [[]];
            }

            dbSchema.materialized_views[_row.table_name].key[0][_row.position] = _row.column_name;
          } else if (_row.kind === 'clustering') {
            if (!dbSchema.materialized_views[_row.table_name].key) {
              dbSchema.materialized_views[_row.table_name].key = [[]];
            }
            if (!dbSchema.materialized_views[_row.table_name].clustering_order) {
              dbSchema.materialized_views[_row.table_name].clustering_order = {};
            }

            dbSchema.materialized_views[_row.table_name].key[_row.position + 1] = _row.column_name;
            if (_row.clustering_order && _row.clustering_order.toLowerCase() === 'desc') {
              dbSchema.materialized_views[_row.table_name].clustering_order[_row.column_name] = 'DESC';
            } else {
              dbSchema.materialized_views[_row.table_name].clustering_order[_row.column_name] = 'ASC';
            }
          }
        }

        callback(null, dbSchema);
      });
    });
  },

  _create_materialized_view_query(tableName, viewName, viewSchema) {
    var rows = [];

    for (var k = 0; k < viewSchema.select.length; k++) {
      if (viewSchema.select[k] === '*') rows.push(util.format('%s', viewSchema.select[k]));else rows.push(util.format('"%s"', viewSchema.select[k]));
    }

    var partitionKey = viewSchema.key[0];
    var clusteringKey = viewSchema.key.slice(1, viewSchema.key.length);
    var clusteringOrder = [];

    for (var field = 0; field < clusteringKey.length; field++) {
      if (viewSchema.clustering_order && viewSchema.clustering_order[clusteringKey[field]] && viewSchema.clustering_order[clusteringKey[field]].toLowerCase() === 'desc') {
        clusteringOrder.push(util.format('"%s" DESC', clusteringKey[field]));
      } else {
        clusteringOrder.push(util.format('"%s" ASC', clusteringKey[field]));
      }
    }

    var clusteringOrderQuery = '';
    if (clusteringOrder.length > 0) {
      clusteringOrderQuery = util.format(' WITH CLUSTERING ORDER BY (%s)', clusteringOrder.toString());
    }

    if (_.isArray(partitionKey)) {
      partitionKey = partitionKey.map(function (v) {
        return util.format('"%s"', v);
      }).join(',');
    } else {
      partitionKey = util.format('"%s"', partitionKey);
    }

    if (clusteringKey.length) {
      clusteringKey = clusteringKey.map(function (v) {
        return util.format('"%s"', v);
      }).join(',');
      clusteringKey = util.format(',%s', clusteringKey);
    } else {
      clusteringKey = '';
    }

    var whereClause = partitionKey.split(',').join(' IS NOT NULL AND ');
    if (clusteringKey) whereClause += clusteringKey.split(',').join(' IS NOT NULL AND ');
    whereClause += ' IS NOT NULL';

    var query = util.format('CREATE MATERIALIZED VIEW IF NOT EXISTS "%s" AS SELECT %s FROM "%s" WHERE %s PRIMARY KEY((%s)%s)%s;', viewName, rows.join(' , '), tableName, whereClause, partitionKey, clusteringKey, clusteringOrderQuery);

    return query;
  },

  create_mviews(materializedViews, callback) {
    var _this8 = this;

    var properties = this._properties;
    var tableName = properties.table_name;
    async.eachSeries(Object.keys(materializedViews), function (viewName, next) {
      var matViewQuery = _this8._create_materialized_view_query(tableName, viewName, materializedViews[viewName]);
      _this8._driver.execute_definition_query(matViewQuery, [], function (err, result) {
        if (err) next(buildError('model.tablecreation.matviewcreate', err));else next(null, result);
      });
    }, callback);
  },

  drop_mviews(mviews, callback) {
    var _this9 = this;

    async.each(mviews, function (view, next) {
      var query = util.format('DROP MATERIALIZED VIEW IF EXISTS "%s";', view);
      _this9._driver.execute_definition_query(query, [], next);
    }, function (err) {
      if (err) callback(buildError('model.tablecreation.matviewdrop', err));else callback();
    });
  },

  _apply_alter_operations(alterOperations, dbSchema, normalizedModelSchema, normalizedDBSchema, callback) {
    var _this10 = this;

    // it should create/drop indexes/custom_indexes/materialized_views that are added/removed in model schema
    // remove common indexes/custom_indexes/materialized_views from normalizedModelSchema and normalizedDBSchema
    // then drop all remaining indexes/custom_indexes/materialized_views from normalizedDBSchema
    // and add all remaining indexes/custom_indexes/materialized_views from normalizedModelSchema
    var properties = this._properties;
    var tableName = properties.table_name;
    var addedIndexes = _.difference(normalizedModelSchema.indexes, normalizedDBSchema.indexes);
    var removedIndexes = _.difference(normalizedDBSchema.indexes, normalizedModelSchema.indexes);
    var removedIndexNames = [];
    removedIndexes.forEach(function (removedIndex) {
      removedIndexNames.push(dbSchema.index_names[removedIndex]);
    });

    var addedCustomIndexes = _.filter(normalizedModelSchema.custom_indexes, function (obj) {
      return !_.find(normalizedDBSchema.custom_indexes, obj);
    });
    var removedCustomIndexes = _.filter(normalizedDBSchema.custom_indexes, function (obj) {
      return !_.find(normalizedModelSchema.custom_indexes, obj);
    });
    removedCustomIndexes.forEach(function (removedIndex) {
      removedIndexNames.push(dbSchema.index_names[objectHash(removedIndex)]);
    });

    var addedMaterializedViewsNames = _.filter(Object.keys(normalizedModelSchema.materialized_views), function (viewName) {
      return !_.isEqual(normalizedDBSchema.materialized_views[viewName], normalizedModelSchema.materialized_views[viewName]);
    });

    var removedMaterializedViewNames = _.filter(Object.keys(normalizedDBSchema.materialized_views), function (viewName) {
      return !_.isEqual(normalizedDBSchema.materialized_views[viewName], normalizedModelSchema.materialized_views[viewName]);
    });

    var addedMaterializedViews = {};
    addedMaterializedViewsNames.forEach(function (viewName) {
      addedMaterializedViews[viewName] = normalizedModelSchema.materialized_views[viewName];
    });

    // remove altered materialized views
    if (removedMaterializedViewNames.length > 0) {
      var message = util.format('Schema for table "%s" has removed materialized_views: %j, are you sure you want to drop them?', tableName, removedMaterializedViewNames);
      var permission = this._confirm_migration(message);
      if (permission !== 'y') {
        callback(buildError('model.tablecreation.schemamismatch', tableName, 'migration suspended, please apply the change manually'));
        return;
      }
    }

    this.drop_mviews(removedMaterializedViewNames, function (err2) {
      if (err2) {
        callback(err2);
        return;
      }

      if (removedIndexNames.length > 0) {
        var _message = util.format('Schema for table "%s" has removed indexes: %j, are you sure you want to drop them?', tableName, removedIndexNames);
        var _permission = _this10._confirm_migration(_message);
        if (_permission !== 'y') {
          callback(buildError('model.tablecreation.schemamismatch', tableName, 'migration suspended, please apply the change manually'));
          return;
        }
      }

      // remove altered indexes by index name
      _this10.drop_indexes(removedIndexNames, function (err3) {
        if (err3) {
          callback(err3);
          return;
        }

        // now apply alterOperations here
        async.eachSeries(alterOperations, function (alterOperation, next) {
          var permission = _this10._confirm_migration(alterOperation.message);
          if (permission !== 'y') {
            callback(buildError('model.tablecreation.schemamismatch', tableName, 'migration suspended, please apply the change manually'));
            return;
          }
          _this10.alter_table(alterOperation.operation, alterOperation.fieldName, alterOperation.type, next);
        }, function (err4) {
          if (err4) {
            callback(err4);
            return;
          }

          // add altered indexes
          // eslint-disable-next-line max-nested-callbacks
          _this10.create_indexes(addedIndexes, function (err5) {
            if (err5) {
              callback(err5);
              return;
            }

            // add altered custom indexes
            // eslint-disable-next-line max-nested-callbacks
            _this10.create_custom_indexes(addedCustomIndexes, function (err6) {
              if (err6) {
                callback(err6);
                return;
              }

              // add altered materialized_views
              _this10.create_mviews(addedMaterializedViews, callback);
            });
          });
        });
      });
    });
  },

  init_alter_operations(modelSchema, dbSchema, normalizedModelSchema, normalizedDBSchema, callback) {
    var _this11 = this;

    var properties = this._properties;
    var tableName = properties.table_name;
    var alterOperations = [];
    var differences = deepDiff(normalizedDBSchema.fields, normalizedModelSchema.fields);
    var droppedFields = false;
    async.eachSeries(differences, function (diff, next) {
      var fieldName = diff.path[0];
      if (diff.kind === 'N') {
        var message = util.format('Schema for table "%s" has added field "%s", are you sure you want to alter to add the field?', tableName, fieldName);
        alterOperations.push({
          fieldName,
          message,
          operation: 'ADD',
          type: parser.extract_altered_type(normalizedModelSchema, diff)
        });
        next();
        return;
      }
      if (diff.kind === 'D') {
        var _message2 = util.format('Schema for table "%s" has removed field "%s", all data in the field will lost, are you sure you want to alter to drop the field?', tableName, fieldName);
        alterOperations.push({
          fieldName,
          message: _message2,
          operation: 'DROP'
        });
        droppedFields = true;
        normalizer.remove_dependent_views_from_normalized_schema(normalizedDBSchema, dbSchema, fieldName);
        next();
        return;
      }
      if (diff.kind === 'E') {
        // check if the alter field type is possible, otherwise try D and then N
        if (diff.path[1] === 'type') {
          // check if field part of primary key
          if (normalizedDBSchema.key[0].includes(fieldName) || normalizedDBSchema.key.indexOf(fieldName) > 0) {
            // alter field type impossible
            next(new Error('alter_impossible'));
          } else if (['text', 'ascii', 'bigint', 'boolean', 'decimal', 'double', 'float', 'inet', 'int', 'timestamp', 'timeuuid', 'uuid', 'varchar', 'varint'].includes(diff.lhs) && diff.rhs === 'blob') {
            // alter field type possible
            var _message3 = util.format('Schema for table "%s" has new type for field "%s", are you sure you want to alter to update the field type?', tableName, fieldName);
            alterOperations.push({
              fieldName,
              message: _message3,
              operation: 'ALTER',
              type: diff.rhs
            });
            next();
          } else if (diff.lhs === 'int' && diff.rhs === 'varint') {
            // alter field type possible
            var _message4 = util.format('Schema for table "%s" has new type for field "%s", are you sure you want to alter to update the field type?', tableName, fieldName);
            alterOperations.push({
              fieldName,
              message: _message4,
              operation: 'ALTER',
              type: diff.rhs
            });
            next();
          } else if (diff.lhs === 'timeuuid' && diff.rhs === 'uuid') {
            // alter field type possible
            var _message5 = util.format('Schema for table "%s" has new type for field "%s", are you sure you want to alter to update the field type?', tableName, fieldName);
            alterOperations.push({
              fieldName,
              message: _message5,
              operation: 'ALTER',
              type: diff.rhs
            });
            next();
          } else {
            // alter type impossible
            var _message6 = util.format('Schema for table "%s" has new type for field "%s", all data in the field will be lost, are you sure you want to drop the field & recreate it?', tableName, fieldName);
            alterOperations.push({
              fieldName,
              message: _message6,
              operation: 'DROP'
            });
            alterOperations.push({
              fieldName,
              operation: 'ADD',
              type: parser.extract_altered_type(normalizedModelSchema, diff)
            });
            droppedFields = true;
            normalizer.remove_dependent_views_from_normalized_schema(normalizedDBSchema, dbSchema, fieldName);
            next();
          }
        } else {
          // alter type impossible
          var _message7 = util.format('Schema for table "%s" has new type for field "%s", all data in the field will be lost, are you sure you want to drop the field & recreate it?', tableName, fieldName);
          alterOperations.push({
            fieldName,
            message: _message7,
            operation: 'DROP'
          });
          alterOperations.push({
            fieldName,
            operation: 'ADD',
            type: parser.extract_altered_type(normalizedModelSchema, diff)
          });
          droppedFields = true;
          normalizer.remove_dependent_views_from_normalized_schema(normalizedDBSchema, dbSchema, fieldName);
          next();
        }
        return;
      }

      next();
    }, function (err) {
      if (err) {
        callback(err);
        return;
      }
      if (droppedFields && _this11._es_builder) {
        _this11._es_builder.delete_index(properties.keyspace, function () {
          _this11._apply_alter_operations(alterOperations, dbSchema, normalizedModelSchema, normalizedDBSchema, callback);
        });
        return;
      }
      _this11._apply_alter_operations(alterOperations, dbSchema, normalizedModelSchema, normalizedDBSchema, callback);
    });
  }
};

module.exports = TableBuilder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9idWlsZGVycy90YWJsZS5qcyJdLCJuYW1lcyI6WyJfIiwicmVxdWlyZSIsImFzeW5jIiwidXRpbCIsIm9iamVjdEhhc2giLCJyZWFkbGluZVN5bmMiLCJkZWVwRGlmZiIsImRpZmYiLCJidWlsZEVycm9yIiwic2NoZW1lciIsInBhcnNlciIsIm5vcm1hbGl6ZXIiLCJFbGFzc2FuZHJhQnVpbGRlciIsIlRhYmxlQnVpbGRlciIsImYiLCJkcml2ZXIiLCJwcm9wZXJ0aWVzIiwiX2RyaXZlciIsIl9wcm9wZXJ0aWVzIiwiZXNjbGllbnQiLCJfZXNfYnVpbGRlciIsInByb3RvdHlwZSIsIl9jb25maXJtX21pZ3JhdGlvbiIsIm1lc3NhZ2UiLCJwZXJtaXNzaW9uIiwiZGlzYWJsZVRUWUNvbmZpcm1hdGlvbiIsInF1ZXN0aW9uIiwiZm9ybWF0IiwidG9Mb3dlckNhc2UiLCJnZXRfdGFibGUiLCJjYWxsYmFjayIsImtleXNwYWNlTmFtZSIsImtleXNwYWNlIiwidGFibGVOYW1lIiwidGFibGVfbmFtZSIsImRiU2NoZW1hIiwiZmllbGRzIiwidHlwZU1hcHMiLCJzdGF0aWNNYXBzIiwicXVlcnkiLCJleGVjdXRlX3F1ZXJ5IiwiZXJyIiwicmVzdWx0Q29sdW1ucyIsInJvd3MiLCJsZW5ndGgiLCJyIiwicm93IiwiY29sdW1uX25hbWUiLCJleHRyYWN0X3R5cGUiLCJ0eXBlIiwidHlwZU1hcERlZiIsImV4dHJhY3RfdHlwZURlZiIsImtpbmQiLCJrZXkiLCJwb3NpdGlvbiIsImNsdXN0ZXJpbmdfb3JkZXIiLCJnZXRfdGFibGVfc2NoZW1hIiwiZ2V0X2luZGV4ZXMiLCJlcnIxIiwiaW5kZXhTY2hlbWEiLCJnZXRfbXZpZXdzIiwiZXJyMiIsInZpZXdTY2hlbWEiLCJPYmplY3QiLCJhc3NpZ24iLCJjcmVhdGVfdGFibGUiLCJzY2hlbWEiLCJmaWVsZFR5cGUiLCJrZXlzIiwiZm9yRWFjaCIsImsiLCJ2aXJ0dWFsIiwic2VnbWVudCIsImdldF9maWVsZF90eXBlIiwidHlwZURlZiIsInN0YXRpYyIsInB1c2giLCJwYXJ0aXRpb25LZXkiLCJjbHVzdGVyaW5nS2V5Iiwic2xpY2UiLCJjbHVzdGVyaW5nT3JkZXIiLCJmaWVsZCIsImNsdXN0ZXJpbmdPcmRlclF1ZXJ5IiwidG9TdHJpbmciLCJpc0FycmF5IiwibWFwIiwidiIsImpvaW4iLCJleGVjdXRlX2RlZmluaXRpb25fcXVlcnkiLCJyZXN1bHQiLCJhbHRlcl90YWJsZSIsIm9wZXJhdGlvbiIsImZpZWxkbmFtZSIsIl9kcm9wX3RhYmxlIiwiZHJvcF90YWJsZSIsIm1hdGVyaWFsaXplZFZpZXdzIiwibXZpZXdzIiwiZHJvcF9tdmlld3MiLCJkcm9wX3JlY3JlYXRlX3RhYmxlIiwibW9kZWxTY2hlbWEiLCJkZWxldGVfaW5kZXgiLCJyZXN1bHRJbmRleGVzIiwiaW5kZXhfbmFtZSIsIm9wdGlvbnMiLCJ0YXJnZXQiLCJpbmRleE9wdGlvbnMiLCJyZXBsYWNlIiwiaW5kZXhfbmFtZXMiLCJ1c2luZyIsImNsYXNzX25hbWUiLCJjdXN0b21faW5kZXhlcyIsImN1c3RvbUluZGV4T2JqZWN0Iiwib24iLCJpbmRleGVzIiwiX2NyZWF0ZV9pbmRleF9xdWVyeSIsImluZGV4TmFtZSIsImluZGV4RXhwcmVzc2lvbiIsInNwbGl0IiwiY3JlYXRlX2luZGV4ZXMiLCJlYWNoU2VyaWVzIiwiaWR4IiwibmV4dCIsIl9jcmVhdGVfY3VzdG9tX2luZGV4X3F1ZXJ5IiwiY3VzdG9tSW5kZXgiLCJjcmVhdGVfY3VzdG9tX2luZGV4ZXMiLCJjdXN0b21JbmRleGVzIiwiZHJvcF9pbmRleGVzIiwiZWFjaCIsInJlc3VsdFZpZXdzIiwidmlld19uYW1lIiwibWF0ZXJpYWxpemVkX3ZpZXdzIiwidmlld05hbWVzIiwicmVzdWx0TWF0Vmlld3MiLCJzZWxlY3QiLCJfY3JlYXRlX21hdGVyaWFsaXplZF92aWV3X3F1ZXJ5Iiwidmlld05hbWUiLCJ3aGVyZUNsYXVzZSIsImNyZWF0ZV9tdmlld3MiLCJtYXRWaWV3UXVlcnkiLCJ2aWV3IiwiX2FwcGx5X2FsdGVyX29wZXJhdGlvbnMiLCJhbHRlck9wZXJhdGlvbnMiLCJub3JtYWxpemVkTW9kZWxTY2hlbWEiLCJub3JtYWxpemVkREJTY2hlbWEiLCJhZGRlZEluZGV4ZXMiLCJkaWZmZXJlbmNlIiwicmVtb3ZlZEluZGV4ZXMiLCJyZW1vdmVkSW5kZXhOYW1lcyIsInJlbW92ZWRJbmRleCIsImFkZGVkQ3VzdG9tSW5kZXhlcyIsImZpbHRlciIsIm9iaiIsImZpbmQiLCJyZW1vdmVkQ3VzdG9tSW5kZXhlcyIsImFkZGVkTWF0ZXJpYWxpemVkVmlld3NOYW1lcyIsImlzRXF1YWwiLCJyZW1vdmVkTWF0ZXJpYWxpemVkVmlld05hbWVzIiwiYWRkZWRNYXRlcmlhbGl6ZWRWaWV3cyIsImVycjMiLCJhbHRlck9wZXJhdGlvbiIsImZpZWxkTmFtZSIsImVycjQiLCJlcnI1IiwiZXJyNiIsImluaXRfYWx0ZXJfb3BlcmF0aW9ucyIsImRpZmZlcmVuY2VzIiwiZHJvcHBlZEZpZWxkcyIsInBhdGgiLCJleHRyYWN0X2FsdGVyZWRfdHlwZSIsInJlbW92ZV9kZXBlbmRlbnRfdmlld3NfZnJvbV9ub3JtYWxpemVkX3NjaGVtYSIsImluY2x1ZGVzIiwiaW5kZXhPZiIsIkVycm9yIiwibGhzIiwicmhzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxJQUFJQyxRQUFRLFFBQVIsQ0FBVjtBQUNBLElBQU1DLFFBQVFELFFBQVEsT0FBUixDQUFkO0FBQ0EsSUFBTUUsT0FBT0YsUUFBUSxNQUFSLENBQWI7QUFDQSxJQUFNRyxhQUFhSCxRQUFRLGFBQVIsQ0FBbkI7QUFDQSxJQUFNSSxlQUFlSixRQUFRLGVBQVIsQ0FBckI7QUFDQSxJQUFNSyxXQUFXTCxRQUFRLFdBQVIsRUFBcUJNLElBQXRDOztBQUVBLElBQU1DLGFBQWFQLFFBQVEsd0JBQVIsQ0FBbkI7QUFDQSxJQUFNUSxVQUFVUixRQUFRLHNCQUFSLENBQWhCO0FBQ0EsSUFBTVMsU0FBU1QsUUFBUSxpQkFBUixD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LCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG5jb25zdCBhc3luYyA9IHJlcXVpcmUoJ2FzeW5jJyk7XG5jb25zdCB1dGlsID0gcmVxdWlyZSgndXRpbCcpO1xuY29uc3Qgb2JqZWN0SGFzaCA9IHJlcXVpcmUoJ29iamVjdC1oYXNoJyk7XG5jb25zdCByZWFkbGluZVN5bmMgPSByZXF1aXJlKCdyZWFkbGluZS1zeW5jJyk7XG5jb25zdCBkZWVwRGlmZiA9IHJlcXVpcmUoJ2RlZXAtZGlmZicpLmRpZmY7XG5cbmNvbnN0IGJ1aWxkRXJyb3IgPSByZXF1aXJlKCcuLi9vcm0vYXBvbGxvX2Vycm9yLmpzJyk7XG5jb25zdCBzY2hlbWVyID0gcmVxdWlyZSgnLi4vdmFsaWRhdG9ycy9zY2hlbWEnKTtcbmNvbnN0IHBhcnNlciA9IHJlcXVpcmUoJy4uL3V0aWxzL3BhcnNlcicpO1xuY29uc3Qgbm9ybWFsaXplciA9IHJlcXVpcmUoJy4uL3V0aWxzL25vcm1hbGl6ZXInKTtcblxuY29uc3QgRWxhc3NhbmRyYUJ1aWxkZXIgPSByZXF1aXJlKCcuL2VsYXNzYW5kcmEnKTtcblxuY29uc3QgVGFibGVCdWlsZGVyID0gZnVuY3Rpb24gZihkcml2ZXIsIHByb3BlcnRpZXMpIHtcbiAgdGhpcy5fZHJpdmVyID0gZHJpdmVyO1xuICB0aGlzLl9wcm9wZXJ0aWVzID0gcHJvcGVydGllcztcbiAgaWYgKHRoaXMuX3Byb3BlcnRpZXMuZXNjbGllbnQpIHtcbiAgICB0aGlzLl9lc19idWlsZGVyID0gbmV3IEVsYXNzYW5kcmFCdWlsZGVyKHRoaXMuX3Byb3BlcnRpZXMuZXNjbGllbnQpO1xuICB9XG59O1xuXG5UYWJsZUJ1aWxkZXIucHJvdG90eXBlID0ge1xuICBfY29uZmlybV9taWdyYXRpb24obWVzc2FnZSkge1xuICAgIGxldCBwZXJtaXNzaW9uID0gJ3knO1xuICAgIGlmIChtZXNzYWdlICYmICF0aGlzLl9wcm9wZXJ0aWVzLmRpc2FibGVUVFlDb25maXJtYXRpb24pIHtcbiAgICAgIHBlcm1pc3Npb24gPSByZWFkbGluZVN5bmMucXVlc3Rpb24odXRpbC5mb3JtYXQoJ01pZ3JhdGlvbjogJXMgKHkvbik6ICcsIG1lc3NhZ2UpKTtcbiAgICB9XG4gICAgcmV0dXJuIHBlcm1pc3Npb24udG9Mb3dlckNhc2UoKTtcbiAgfSxcbiAgZ2V0X3RhYmxlKGNhbGxiYWNrKSB7XG4gICAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXM7XG4gICAgY29uc3Qga2V5c3BhY2VOYW1lID0gcHJvcGVydGllcy5rZXlzcGFjZTtcbiAgICBjb25zdCB0YWJsZU5hbWUgPSBwcm9wZXJ0aWVzLnRhYmxlX25hbWU7XG4gICAgY29uc3QgZGJTY2hlbWEgPSB7IGZpZWxkczoge30sIHR5cGVNYXBzOiB7fSwgc3RhdGljTWFwczoge30gfTtcbiAgICBjb25zdCBxdWVyeSA9ICdTRUxFQ1QgKiBGUk9NIHN5c3RlbV9zY2hlbWEuY29sdW1ucyBXSEVSRSB0YWJsZV9uYW1lID0gPyBBTkQga2V5c3BhY2VfbmFtZSA9ID87JztcblxuICAgIHRoaXMuX2RyaXZlci5leGVjdXRlX3F1ZXJ5KHF1ZXJ5LCBbdGFibGVOYW1lLCBrZXlzcGFjZU5hbWVdLCAoZXJyLCByZXN1bHRDb2x1bW5zKSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLnRhYmxlY3JlYXRpb24uZGJzY2hlbWFxdWVyeScsIGVycikpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICghcmVzdWx0Q29sdW1ucy5yb3dzIHx8IHJlc3VsdENvbHVtbnMucm93cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGxldCByID0gMDsgciA8IHJlc3VsdENvbHVtbnMucm93cy5sZW5ndGg7IHIrKykge1xuICAgICAgICBjb25zdCByb3cgPSByZXN1bHRDb2x1bW5zLnJvd3Nbcl07XG5cbiAgICAgICAgZGJTY2hlbWEuZmllbGRzW3Jvdy5jb2x1bW5fbmFtZV0gPSBwYXJzZXIuZXh0cmFjdF90eXBlKHJvdy50eXBlKTtcblxuICAgICAgICBjb25zdCB0eXBlTWFwRGVmID0gcGFyc2VyLmV4dHJhY3RfdHlwZURlZihyb3cudHlwZSk7XG4gICAgICAgIGlmICh0eXBlTWFwRGVmLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBkYlNjaGVtYS50eXBlTWFwc1tyb3cuY29sdW1uX25hbWVdID0gdHlwZU1hcERlZjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyb3cua2luZCA9PT0gJ3BhcnRpdGlvbl9rZXknKSB7XG4gICAgICAgICAgaWYgKCFkYlNjaGVtYS5rZXkpIGRiU2NoZW1hLmtleSA9IFtbXV07XG4gICAgICAgICAgZGJTY2hlbWEua2V5WzBdW3Jvdy5wb3NpdGlvbl0gPSByb3cuY29sdW1uX25hbWU7XG4gICAgICAgIH0gZWxzZSBpZiAocm93LmtpbmQgPT09ICdjbHVzdGVyaW5nJykge1xuICAgICAgICAgIGlmICghZGJTY2hlbWEua2V5KSBkYlNjaGVtYS5rZXkgPSBbW11dO1xuICAgICAgICAgIGlmICghZGJTY2hlbWEuY2x1c3RlcmluZ19vcmRlcikgZGJTY2hlbWEuY2x1c3RlcmluZ19vcmRlciA9IHt9O1xuXG4gICAgICAgICAgZGJTY2hlbWEua2V5W3Jvdy5wb3NpdGlvbiArIDFdID0gcm93LmNvbHVtbl9uYW1lO1xuICAgICAgICAgIGlmIChyb3cuY2x1c3RlcmluZ19vcmRlciAmJiByb3cuY2x1c3RlcmluZ19vcmRlci50b0xvd2VyQ2FzZSgpID09PSAnZGVzYycpIHtcbiAgICAgICAgICAgIGRiU2NoZW1hLmNsdXN0ZXJpbmdfb3JkZXJbcm93LmNvbHVtbl9uYW1lXSA9ICdERVNDJztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGJTY2hlbWEuY2x1c3RlcmluZ19vcmRlcltyb3cuY29sdW1uX25hbWVdID0gJ0FTQyc7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHJvdy5raW5kID09PSAnc3RhdGljJykge1xuICAgICAgICAgIGRiU2NoZW1hLnN0YXRpY01hcHNbcm93LmNvbHVtbl9uYW1lXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY2FsbGJhY2sobnVsbCwgZGJTY2hlbWEpO1xuICAgIH0pO1xuICB9LFxuXG4gIGdldF90YWJsZV9zY2hlbWEoY2FsbGJhY2spIHtcbiAgICB0aGlzLmdldF90YWJsZSgoZXJyLCBkYlNjaGVtYSkgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoIWRiU2NoZW1hKSB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuZ2V0X2luZGV4ZXMoKGVycjEsIGluZGV4U2NoZW1hKSA9PiB7XG4gICAgICAgIGlmIChlcnIxKSB7XG4gICAgICAgICAgY2FsbGJhY2soZXJyMSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ2V0X212aWV3cygoZXJyMiwgdmlld1NjaGVtYSkgPT4ge1xuICAgICAgICAgIGlmIChlcnIyKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhlcnIyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbihkYlNjaGVtYSwgaW5kZXhTY2hlbWEsIHZpZXdTY2hlbWEpO1xuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGRiU2NoZW1hKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSxcblxuICBjcmVhdGVfdGFibGUoc2NoZW1hLCBjYWxsYmFjaykge1xuICAgIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLl9wcm9wZXJ0aWVzO1xuICAgIGNvbnN0IHRhYmxlTmFtZSA9IHByb3BlcnRpZXMudGFibGVfbmFtZTtcbiAgICBjb25zdCByb3dzID0gW107XG4gICAgbGV0IGZpZWxkVHlwZTtcbiAgICBPYmplY3Qua2V5cyhzY2hlbWEuZmllbGRzKS5mb3JFYWNoKChrKSA9PiB7XG4gICAgICBpZiAoc2NoZW1hLmZpZWxkc1trXS52aXJ0dWFsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGxldCBzZWdtZW50ID0gJyc7XG4gICAgICBmaWVsZFR5cGUgPSBzY2hlbWVyLmdldF9maWVsZF90eXBlKHNjaGVtYSwgayk7XG4gICAgICBpZiAoc2NoZW1hLmZpZWxkc1trXS50eXBlRGVmKSB7XG4gICAgICAgIHNlZ21lbnQgPSB1dGlsLmZvcm1hdCgnXCIlc1wiICVzJXMnLCBrLCBmaWVsZFR5cGUsIHNjaGVtYS5maWVsZHNba10udHlwZURlZik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWdtZW50ID0gdXRpbC5mb3JtYXQoJ1wiJXNcIiAlcycsIGssIGZpZWxkVHlwZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzY2hlbWEuZmllbGRzW2tdLnN0YXRpYykge1xuICAgICAgICBzZWdtZW50ICs9ICcgU1RBVElDJztcbiAgICAgIH1cblxuICAgICAgcm93cy5wdXNoKHNlZ21lbnQpO1xuICAgIH0pO1xuXG4gICAgbGV0IHBhcnRpdGlvbktleSA9IHNjaGVtYS5rZXlbMF07XG4gICAgbGV0IGNsdXN0ZXJpbmdLZXkgPSBzY2hlbWEua2V5LnNsaWNlKDEsIHNjaGVtYS5rZXkubGVuZ3RoKTtcbiAgICBjb25zdCBjbHVzdGVyaW5nT3JkZXIgPSBbXTtcblxuICAgIGZvciAobGV0IGZpZWxkID0gMDsgZmllbGQgPCBjbHVzdGVyaW5nS2V5Lmxlbmd0aDsgZmllbGQrKykge1xuICAgICAgaWYgKHNjaGVtYS5jbHVzdGVyaW5nX29yZGVyXG4gICAgICAgICAgJiYgc2NoZW1hLmNsdXN0ZXJpbmdfb3JkZXJbY2x1c3RlcmluZ0tleVtmaWVsZF1dXG4gICAgICAgICAgJiYgc2NoZW1hLmNsdXN0ZXJpbmdfb3JkZXJbY2x1c3RlcmluZ0tleVtmaWVsZF1dLnRvTG93ZXJDYXNlKCkgPT09ICdkZXNjJykge1xuICAgICAgICBjbHVzdGVyaW5nT3JkZXIucHVzaCh1dGlsLmZvcm1hdCgnXCIlc1wiIERFU0MnLCBjbHVzdGVyaW5nS2V5W2ZpZWxkXSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2x1c3RlcmluZ09yZGVyLnB1c2godXRpbC5mb3JtYXQoJ1wiJXNcIiBBU0MnLCBjbHVzdGVyaW5nS2V5W2ZpZWxkXSkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBjbHVzdGVyaW5nT3JkZXJRdWVyeSA9ICcnO1xuICAgIGlmIChjbHVzdGVyaW5nT3JkZXIubGVuZ3RoID4gMCkge1xuICAgICAgY2x1c3RlcmluZ09yZGVyUXVlcnkgPSB1dGlsLmZvcm1hdCgnIFdJVEggQ0xVU1RFUklORyBPUkRFUiBCWSAoJXMpJywgY2x1c3RlcmluZ09yZGVyLnRvU3RyaW5nKCkpO1xuICAgIH1cblxuICAgIGlmIChfLmlzQXJyYXkocGFydGl0aW9uS2V5KSkge1xuICAgICAgcGFydGl0aW9uS2V5ID0gcGFydGl0aW9uS2V5Lm1hcCgodikgPT4gKHV0aWwuZm9ybWF0KCdcIiVzXCInLCB2KSkpLmpvaW4oJywnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGFydGl0aW9uS2V5ID0gdXRpbC5mb3JtYXQoJ1wiJXNcIicsIHBhcnRpdGlvbktleSk7XG4gICAgfVxuXG4gICAgaWYgKGNsdXN0ZXJpbmdLZXkubGVuZ3RoKSB7XG4gICAgICBjbHVzdGVyaW5nS2V5ID0gY2x1c3RlcmluZ0tleS5tYXAoKHYpID0+ICh1dGlsLmZvcm1hdCgnXCIlc1wiJywgdikpKS5qb2luKCcsJyk7XG4gICAgICBjbHVzdGVyaW5nS2V5ID0gdXRpbC5mb3JtYXQoJywlcycsIGNsdXN0ZXJpbmdLZXkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjbHVzdGVyaW5nS2V5ID0gJyc7XG4gICAgfVxuXG4gICAgY29uc3QgcXVlcnkgPSB1dGlsLmZvcm1hdChcbiAgICAgICdDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBcIiVzXCIgKCVzICwgUFJJTUFSWSBLRVkoKCVzKSVzKSklczsnLFxuICAgICAgdGFibGVOYW1lLFxuICAgICAgcm93cy5qb2luKCcgLCAnKSxcbiAgICAgIHBhcnRpdGlvbktleSxcbiAgICAgIGNsdXN0ZXJpbmdLZXksXG4gICAgICBjbHVzdGVyaW5nT3JkZXJRdWVyeSxcbiAgICApO1xuXG4gICAgdGhpcy5fZHJpdmVyLmV4ZWN1dGVfZGVmaW5pdGlvbl9xdWVyeShxdWVyeSwgW10sIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjYWxsYmFjayhidWlsZEVycm9yKCdtb2RlbC50YWJsZWNyZWF0aW9uLmRiY3JlYXRlJywgZXJyKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gICAgfSk7XG4gIH0sXG5cbiAgYWx0ZXJfdGFibGUob3BlcmF0aW9uLCBmaWVsZG5hbWUsIHR5cGUsIGNhbGxiYWNrKSB7XG4gICAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXM7XG4gICAgY29uc3QgdGFibGVOYW1lID0gcHJvcGVydGllcy50YWJsZV9uYW1lO1xuICAgIGlmIChvcGVyYXRpb24gPT09ICdBTFRFUicpIHR5cGUgPSB1dGlsLmZvcm1hdCgnVFlQRSAlcycsIHR5cGUpO1xuICAgIGVsc2UgaWYgKG9wZXJhdGlvbiA9PT0gJ0RST1AnKSB0eXBlID0gJyc7XG5cbiAgICBjb25zdCBxdWVyeSA9IHV0aWwuZm9ybWF0KCdBTFRFUiBUQUJMRSBcIiVzXCIgJXMgXCIlc1wiICVzOycsIHRhYmxlTmFtZSwgb3BlcmF0aW9uLCBmaWVsZG5hbWUsIHR5cGUpO1xuICAgIHRoaXMuX2RyaXZlci5leGVjdXRlX2RlZmluaXRpb25fcXVlcnkocXVlcnksIFtdLCBjYWxsYmFjayk7XG4gIH0sXG5cbiAgX2Ryb3BfdGFibGUodGFibGVOYW1lLCBjYWxsYmFjaykge1xuICAgIGNvbnN0IHF1ZXJ5ID0gdXRpbC5mb3JtYXQoJ0RST1AgVEFCTEUgSUYgRVhJU1RTIFwiJXNcIjsnLCB0YWJsZU5hbWUpO1xuICAgIHRoaXMuX2RyaXZlci5leGVjdXRlX2RlZmluaXRpb25fcXVlcnkocXVlcnksIFtdLCAoZXJyKSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLnRhYmxlY3JlYXRpb24uZGJkcm9wJywgZXJyKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfSk7XG4gIH0sXG5cbiAgZHJvcF90YWJsZShtYXRlcmlhbGl6ZWRWaWV3cywgY2FsbGJhY2spIHtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydGllcztcbiAgICBjb25zdCB0YWJsZU5hbWUgPSBwcm9wZXJ0aWVzLnRhYmxlX25hbWU7XG4gICAgY29uc3QgbWVzc2FnZSA9IHV0aWwuZm9ybWF0KFxuICAgICAgJ1NjaGVtYSBmb3IgdGFibGUgXCIlc1wiIGhhcyBjaGFuZ2VkIGluIGEgd2F5IHdoZXJlIGFsdGVyIG1pZ3JhdGlvbiBpcyBub3QgcG9zc2libGUsIGFsbCBkYXRhIGluIHRoZSB0YWJsZSB3aWxsIGJlIGxvc3QsIGFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkcm9wIHRoZSB0YWJsZT8nLFxuICAgICAgdGFibGVOYW1lLFxuICAgICk7XG4gICAgY29uc3QgcGVybWlzc2lvbiA9IHRoaXMuX2NvbmZpcm1fbWlncmF0aW9uKG1lc3NhZ2UpO1xuICAgIGlmIChwZXJtaXNzaW9uICE9PSAneScpIHtcbiAgICAgIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLnRhYmxlY3JlYXRpb24uc2NoZW1hbWlzbWF0Y2gnLCB0YWJsZU5hbWUsICdtaWdyYXRpb24gc3VzcGVuZGVkLCBwbGVhc2UgYXBwbHkgdGhlIGNoYW5nZSBtYW51YWxseScpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFtYXRlcmlhbGl6ZWRWaWV3cykge1xuICAgICAgdGhpcy5fZHJvcF90YWJsZSh0YWJsZU5hbWUsIGNhbGxiYWNrKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBtdmlld3MgPSBPYmplY3Qua2V5cyhtYXRlcmlhbGl6ZWRWaWV3cyk7XG4gICAgdGhpcy5kcm9wX212aWV3cyhtdmlld3MsIChlcnIpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9kcm9wX3RhYmxlKHRhYmxlTmFtZSwgY2FsbGJhY2spO1xuICAgIH0pO1xuICB9LFxuXG4gIGRyb3BfcmVjcmVhdGVfdGFibGUobW9kZWxTY2hlbWEsIG1hdGVyaWFsaXplZFZpZXdzLCBjYWxsYmFjaykge1xuICAgIGlmICh0aGlzLl9lc19idWlsZGVyKSB7XG4gICAgICB0aGlzLl9lc19idWlsZGVyLmRlbGV0ZV9pbmRleCh0aGlzLl9wcm9wZXJ0aWVzLmtleXNwYWNlLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuZHJvcF90YWJsZShtYXRlcmlhbGl6ZWRWaWV3cywgKGVycjEpID0+IHtcbiAgICAgICAgICBpZiAoZXJyMSkge1xuICAgICAgICAgICAgY2FsbGJhY2soZXJyMSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuY3JlYXRlX3RhYmxlKG1vZGVsU2NoZW1hLCBjYWxsYmFjayk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZHJvcF90YWJsZShtYXRlcmlhbGl6ZWRWaWV3cywgKGVycjEpID0+IHtcbiAgICAgIGlmIChlcnIxKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycjEpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmNyZWF0ZV90YWJsZShtb2RlbFNjaGVtYSwgY2FsbGJhY2spO1xuICAgIH0pO1xuICB9LFxuXG4gIGdldF9pbmRleGVzKGNhbGxiYWNrKSB7XG4gICAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXM7XG4gICAgY29uc3Qga2V5c3BhY2VOYW1lID0gcHJvcGVydGllcy5rZXlzcGFjZTtcbiAgICBjb25zdCB0YWJsZU5hbWUgPSBwcm9wZXJ0aWVzLnRhYmxlX25hbWU7XG4gICAgY29uc3QgZGJTY2hlbWEgPSB7fTtcbiAgICBjb25zdCBxdWVyeSA9ICdTRUxFQ1QgKiBGUk9NIHN5c3RlbV9zY2hlbWEuaW5kZXhlcyBXSEVSRSB0YWJsZV9uYW1lID0gPyBBTkQga2V5c3BhY2VfbmFtZSA9ID87JztcblxuICAgIHRoaXMuX2RyaXZlci5leGVjdXRlX3F1ZXJ5KHF1ZXJ5LCBbdGFibGVOYW1lLCBrZXlzcGFjZU5hbWVdLCAoZXJyLCByZXN1bHRJbmRleGVzKSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLnRhYmxlY3JlYXRpb24uZGJzY2hlbWFxdWVyeScsIGVycikpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgcmVzdWx0SW5kZXhlcy5yb3dzLmxlbmd0aDsgcisrKSB7XG4gICAgICAgIGNvbnN0IHJvdyA9IHJlc3VsdEluZGV4ZXMucm93c1tyXTtcblxuICAgICAgICBpZiAocm93LmluZGV4X25hbWUgJiYgcm93Lm9wdGlvbnMudGFyZ2V0KSB7XG4gICAgICAgICAgY29uc3QgaW5kZXhPcHRpb25zID0gcm93Lm9wdGlvbnM7XG4gICAgICAgICAgbGV0IHRhcmdldCA9IGluZGV4T3B0aW9ucy50YXJnZXQ7XG4gICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnJlcGxhY2UoL1tcIlxcc10vZywgJycpO1xuICAgICAgICAgIGRlbGV0ZSBpbmRleE9wdGlvbnMudGFyZ2V0O1xuXG4gICAgICAgICAgLy8ga2VlcGluZyB0cmFjayBvZiBpbmRleCBuYW1lcyB0byBkcm9wIGluZGV4IHdoZW4gbmVlZGVkXG4gICAgICAgICAgaWYgKCFkYlNjaGVtYS5pbmRleF9uYW1lcykgZGJTY2hlbWEuaW5kZXhfbmFtZXMgPSB7fTtcblxuICAgICAgICAgIGlmIChyb3cua2luZCA9PT0gJ0NVU1RPTScpIHtcbiAgICAgICAgICAgIGNvbnN0IHVzaW5nID0gaW5kZXhPcHRpb25zLmNsYXNzX25hbWU7XG4gICAgICAgICAgICBkZWxldGUgaW5kZXhPcHRpb25zLmNsYXNzX25hbWU7XG5cbiAgICAgICAgICAgIGlmICghZGJTY2hlbWEuY3VzdG9tX2luZGV4ZXMpIGRiU2NoZW1hLmN1c3RvbV9pbmRleGVzID0gW107XG4gICAgICAgICAgICBjb25zdCBjdXN0b21JbmRleE9iamVjdCA9IHtcbiAgICAgICAgICAgICAgb246IHRhcmdldCxcbiAgICAgICAgICAgICAgdXNpbmcsXG4gICAgICAgICAgICAgIG9wdGlvbnM6IGluZGV4T3B0aW9ucyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBkYlNjaGVtYS5jdXN0b21faW5kZXhlcy5wdXNoKGN1c3RvbUluZGV4T2JqZWN0KTtcbiAgICAgICAgICAgIGRiU2NoZW1hLmluZGV4X25hbWVzW29iamVjdEhhc2goY3VzdG9tSW5kZXhPYmplY3QpXSA9IHJvdy5pbmRleF9uYW1lO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoIWRiU2NoZW1hLmluZGV4ZXMpIGRiU2NoZW1hLmluZGV4ZXMgPSBbXTtcbiAgICAgICAgICAgIGRiU2NoZW1hLmluZGV4ZXMucHVzaCh0YXJnZXQpO1xuICAgICAgICAgICAgZGJTY2hlbWEuaW5kZXhfbmFtZXNbdGFyZ2V0XSA9IHJvdy5pbmRleF9uYW1lO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjYWxsYmFjayhudWxsLCBkYlNjaGVtYSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgX2NyZWF0ZV9pbmRleF9xdWVyeSh0YWJsZU5hbWUsIGluZGV4TmFtZSkge1xuICAgIGxldCBxdWVyeTtcbiAgICBjb25zdCBpbmRleEV4cHJlc3Npb24gPSBpbmRleE5hbWUucmVwbGFjZSgvW1wiXFxzXS9nLCAnJykuc3BsaXQoL1soKV0vZyk7XG4gICAgaWYgKGluZGV4RXhwcmVzc2lvbi5sZW5ndGggPiAxKSB7XG4gICAgICBpbmRleEV4cHJlc3Npb25bMF0gPSBpbmRleEV4cHJlc3Npb25bMF0udG9Mb3dlckNhc2UoKTtcbiAgICAgIHF1ZXJ5ID0gdXRpbC5mb3JtYXQoXG4gICAgICAgICdDUkVBVEUgSU5ERVggSUYgTk9UIEVYSVNUUyBPTiBcIiVzXCIgKCVzKFwiJXNcIikpOycsXG4gICAgICAgIHRhYmxlTmFtZSxcbiAgICAgICAgaW5kZXhFeHByZXNzaW9uWzBdLFxuICAgICAgICBpbmRleEV4cHJlc3Npb25bMV0sXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBxdWVyeSA9IHV0aWwuZm9ybWF0KFxuICAgICAgICAnQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgT04gXCIlc1wiIChcIiVzXCIpOycsXG4gICAgICAgIHRhYmxlTmFtZSxcbiAgICAgICAgaW5kZXhFeHByZXNzaW9uWzBdLFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIHF1ZXJ5O1xuICB9LFxuXG4gIGNyZWF0ZV9pbmRleGVzKGluZGV4ZXMsIGNhbGxiYWNrKSB7XG4gICAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXM7XG4gICAgY29uc3QgdGFibGVOYW1lID0gcHJvcGVydGllcy50YWJsZV9uYW1lO1xuICAgIGFzeW5jLmVhY2hTZXJpZXMoaW5kZXhlcywgKGlkeCwgbmV4dCkgPT4ge1xuICAgICAgdGhpcy5fZHJpdmVyLmV4ZWN1dGVfZGVmaW5pdGlvbl9xdWVyeSh0aGlzLl9jcmVhdGVfaW5kZXhfcXVlcnkodGFibGVOYW1lLCBpZHgpLCBbXSwgKGVyciwgcmVzdWx0KSA9PiB7XG4gICAgICAgIGlmIChlcnIpIG5leHQoYnVpbGRFcnJvcignbW9kZWwudGFibGVjcmVhdGlvbi5kYmluZGV4Y3JlYXRlJywgZXJyKSk7XG4gICAgICAgIGVsc2UgbmV4dChudWxsLCByZXN1bHQpO1xuICAgICAgfSk7XG4gICAgfSwgY2FsbGJhY2spO1xuICB9LFxuXG4gIF9jcmVhdGVfY3VzdG9tX2luZGV4X3F1ZXJ5KHRhYmxlTmFtZSwgY3VzdG9tSW5kZXgpIHtcbiAgICBsZXQgcXVlcnkgPSB1dGlsLmZvcm1hdChcbiAgICAgICdDUkVBVEUgQ1VTVE9NIElOREVYIElGIE5PVCBFWElTVFMgT04gXCIlc1wiIChcIiVzXCIpIFVTSU5HIFxcJyVzXFwnJyxcbiAgICAgIHRhYmxlTmFtZSxcbiAgICAgIGN1c3RvbUluZGV4Lm9uLFxuICAgICAgY3VzdG9tSW5kZXgudXNpbmcsXG4gICAgKTtcblxuICAgIGlmIChPYmplY3Qua2V5cyhjdXN0b21JbmRleC5vcHRpb25zKS5sZW5ndGggPiAwKSB7XG4gICAgICBxdWVyeSArPSAnIFdJVEggT1BUSU9OUyA9IHsnO1xuICAgICAgT2JqZWN0LmtleXMoY3VzdG9tSW5kZXgub3B0aW9ucykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgIHF1ZXJ5ICs9IHV0aWwuZm9ybWF0KFwiJyVzJzogJyVzJywgXCIsIGtleSwgY3VzdG9tSW5kZXgub3B0aW9uc1trZXldKTtcbiAgICAgIH0pO1xuICAgICAgcXVlcnkgPSBxdWVyeS5zbGljZSgwLCAtMik7XG4gICAgICBxdWVyeSArPSAnfSc7XG4gICAgfVxuXG4gICAgcXVlcnkgKz0gJzsnO1xuXG4gICAgcmV0dXJuIHF1ZXJ5O1xuICB9LFxuXG4gIGNyZWF0ZV9jdXN0b21faW5kZXhlcyhjdXN0b21JbmRleGVzLCBjYWxsYmFjaykge1xuICAgIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLl9wcm9wZXJ0aWVzO1xuICAgIGNvbnN0IHRhYmxlTmFtZSA9IHByb3BlcnRpZXMudGFibGVfbmFtZTtcbiAgICBhc3luYy5lYWNoU2VyaWVzKGN1c3RvbUluZGV4ZXMsIChpZHgsIG5leHQpID0+IHtcbiAgICAgIHRoaXMuX2RyaXZlci5leGVjdXRlX2RlZmluaXRpb25fcXVlcnkodGhpcy5fY3JlYXRlX2N1c3RvbV9pbmRleF9xdWVyeSh0YWJsZU5hbWUsIGlkeCksIFtdLCAoZXJyLCByZXN1bHQpID0+IHtcbiAgICAgICAgaWYgKGVycikgbmV4dChidWlsZEVycm9yKCdtb2RlbC50YWJsZWNyZWF0aW9uLmRiaW5kZXhjcmVhdGUnLCBlcnIpKTtcbiAgICAgICAgZWxzZSBuZXh0KG51bGwsIHJlc3VsdCk7XG4gICAgICB9KTtcbiAgICB9LCBjYWxsYmFjayk7XG4gIH0sXG5cbiAgZHJvcF9pbmRleGVzKGluZGV4ZXMsIGNhbGxiYWNrKSB7XG4gICAgYXN5bmMuZWFjaChpbmRleGVzLCAoaWR4LCBuZXh0KSA9PiB7XG4gICAgICBjb25zdCBxdWVyeSA9IHV0aWwuZm9ybWF0KCdEUk9QIElOREVYIElGIEVYSVNUUyBcIiVzXCI7JywgaWR4KTtcbiAgICAgIHRoaXMuX2RyaXZlci5leGVjdXRlX2RlZmluaXRpb25fcXVlcnkocXVlcnksIFtdLCBuZXh0KTtcbiAgICB9LCAoZXJyKSA9PiB7XG4gICAgICBpZiAoZXJyKSBjYWxsYmFjayhidWlsZEVycm9yKCdtb2RlbC50YWJsZWNyZWF0aW9uLmRiaW5kZXhkcm9wJywgZXJyKSk7XG4gICAgICBlbHNlIGNhbGxiYWNrKCk7XG4gICAgfSk7XG4gIH0sXG5cbiAgZ2V0X212aWV3cyhjYWxsYmFjaykge1xuICAgIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLl9wcm9wZXJ0aWVzO1xuICAgIGNvbnN0IGtleXNwYWNlTmFtZSA9IHByb3BlcnRpZXMua2V5c3BhY2U7XG4gICAgY29uc3QgdGFibGVOYW1lID0gcHJvcGVydGllcy50YWJsZV9uYW1lO1xuICAgIGNvbnN0IGRiU2NoZW1hID0ge307XG4gICAgbGV0IHF1ZXJ5ID0gJ1NFTEVDVCB2aWV3X25hbWUsYmFzZV90YWJsZV9uYW1lIEZST00gc3lzdGVtX3NjaGVtYS52aWV3cyBXSEVSRSBrZXlzcGFjZV9uYW1lPT8gQU5EIGJhc2VfdGFibGVfbmFtZT0/IEFMTE9XIEZJTFRFUklORzsnO1xuXG4gICAgdGhpcy5fZHJpdmVyLmV4ZWN1dGVfcXVlcnkocXVlcnksIFtrZXlzcGFjZU5hbWUsIHRhYmxlTmFtZV0sIChlcnIsIHJlc3VsdFZpZXdzKSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLnRhYmxlY3JlYXRpb24uZGJzY2hlbWFxdWVyeScsIGVycikpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgcmVzdWx0Vmlld3Mucm93cy5sZW5ndGg7IHIrKykge1xuICAgICAgICBjb25zdCByb3cgPSByZXN1bHRWaWV3cy5yb3dzW3JdO1xuXG4gICAgICAgIGlmIChyb3cudmlld19uYW1lKSB7XG4gICAgICAgICAgaWYgKCFkYlNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3MpIGRiU2NoZW1hLm1hdGVyaWFsaXplZF92aWV3cyA9IHt9O1xuICAgICAgICAgIGRiU2NoZW1hLm1hdGVyaWFsaXplZF92aWV3c1tyb3cudmlld19uYW1lXSA9IHt9O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghZGJTY2hlbWEubWF0ZXJpYWxpemVkX3ZpZXdzKSB7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIGRiU2NoZW1hKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBxdWVyeSA9ICdTRUxFQ1QgKiBGUk9NIHN5c3RlbV9zY2hlbWEuY29sdW1ucyBXSEVSRSBrZXlzcGFjZV9uYW1lPT8gYW5kIHRhYmxlX25hbWUgSU4gPzsnO1xuXG4gICAgICBjb25zdCB2aWV3TmFtZXMgPSBPYmplY3Qua2V5cyhkYlNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3MpO1xuICAgICAgdGhpcy5fZHJpdmVyLmV4ZWN1dGVfcXVlcnkocXVlcnksIFtrZXlzcGFjZU5hbWUsIHZpZXdOYW1lc10sIChlcnIxLCByZXN1bHRNYXRWaWV3cykgPT4ge1xuICAgICAgICBpZiAoZXJyMSkge1xuICAgICAgICAgIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLnRhYmxlY3JlYXRpb24uZGJzY2hlbWFxdWVyeScsIGVycjEpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGxldCByID0gMDsgciA8IHJlc3VsdE1hdFZpZXdzLnJvd3MubGVuZ3RoOyByKyspIHtcbiAgICAgICAgICBjb25zdCByb3cgPSByZXN1bHRNYXRWaWV3cy5yb3dzW3JdO1xuXG4gICAgICAgICAgaWYgKCFkYlNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3Nbcm93LnRhYmxlX25hbWVdLnNlbGVjdCkge1xuICAgICAgICAgICAgZGJTY2hlbWEubWF0ZXJpYWxpemVkX3ZpZXdzW3Jvdy50YWJsZV9uYW1lXS5zZWxlY3QgPSBbXTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBkYlNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3Nbcm93LnRhYmxlX25hbWVdLnNlbGVjdC5wdXNoKHJvdy5jb2x1bW5fbmFtZSk7XG5cbiAgICAgICAgICBpZiAocm93LmtpbmQgPT09ICdwYXJ0aXRpb25fa2V5Jykge1xuICAgICAgICAgICAgaWYgKCFkYlNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3Nbcm93LnRhYmxlX25hbWVdLmtleSkge1xuICAgICAgICAgICAgICBkYlNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3Nbcm93LnRhYmxlX25hbWVdLmtleSA9IFtbXV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRiU2NoZW1hLm1hdGVyaWFsaXplZF92aWV3c1tyb3cudGFibGVfbmFtZV0ua2V5WzBdW3Jvdy5wb3NpdGlvbl0gPSByb3cuY29sdW1uX25hbWU7XG4gICAgICAgICAgfSBlbHNlIGlmIChyb3cua2luZCA9PT0gJ2NsdXN0ZXJpbmcnKSB7XG4gICAgICAgICAgICBpZiAoIWRiU2NoZW1hLm1hdGVyaWFsaXplZF92aWV3c1tyb3cudGFibGVfbmFtZV0ua2V5KSB7XG4gICAgICAgICAgICAgIGRiU2NoZW1hLm1hdGVyaWFsaXplZF92aWV3c1tyb3cudGFibGVfbmFtZV0ua2V5ID0gW1tdXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZGJTY2hlbWEubWF0ZXJpYWxpemVkX3ZpZXdzW3Jvdy50YWJsZV9uYW1lXS5jbHVzdGVyaW5nX29yZGVyKSB7XG4gICAgICAgICAgICAgIGRiU2NoZW1hLm1hdGVyaWFsaXplZF92aWV3c1tyb3cudGFibGVfbmFtZV0uY2x1c3RlcmluZ19vcmRlciA9IHt9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkYlNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3Nbcm93LnRhYmxlX25hbWVdLmtleVtyb3cucG9zaXRpb24gKyAxXSA9IHJvdy5jb2x1bW5fbmFtZTtcbiAgICAgICAgICAgIGlmIChyb3cuY2x1c3RlcmluZ19vcmRlciAmJiByb3cuY2x1c3RlcmluZ19vcmRlci50b0xvd2VyQ2FzZSgpID09PSAnZGVzYycpIHtcbiAgICAgICAgICAgICAgZGJTY2hlbWEubWF0ZXJpYWxpemVkX3ZpZXdzW3Jvdy50YWJsZV9uYW1lXS5jbHVzdGVyaW5nX29yZGVyW3Jvdy5jb2x1bW5fbmFtZV0gPSAnREVTQyc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBkYlNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3Nbcm93LnRhYmxlX25hbWVdLmNsdXN0ZXJpbmdfb3JkZXJbcm93LmNvbHVtbl9uYW1lXSA9ICdBU0MnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIGRiU2NoZW1hKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9LFxuXG4gIF9jcmVhdGVfbWF0ZXJpYWxpemVkX3ZpZXdfcXVlcnkodGFibGVOYW1lLCB2aWV3TmFtZSwgdmlld1NjaGVtYSkge1xuICAgIGNvbnN0IHJvd3MgPSBbXTtcblxuICAgIGZvciAobGV0IGsgPSAwOyBrIDwgdmlld1NjaGVtYS5zZWxlY3QubGVuZ3RoOyBrKyspIHtcbiAgICAgIGlmICh2aWV3U2NoZW1hLnNlbGVjdFtrXSA9PT0gJyonKSByb3dzLnB1c2godXRpbC5mb3JtYXQoJyVzJywgdmlld1NjaGVtYS5zZWxlY3Rba10pKTtcbiAgICAgIGVsc2Ugcm93cy5wdXNoKHV0aWwuZm9ybWF0KCdcIiVzXCInLCB2aWV3U2NoZW1hLnNlbGVjdFtrXSkpO1xuICAgIH1cblxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSB2aWV3U2NoZW1hLmtleVswXTtcbiAgICBsZXQgY2x1c3RlcmluZ0tleSA9IHZpZXdTY2hlbWEua2V5LnNsaWNlKDEsIHZpZXdTY2hlbWEua2V5Lmxlbmd0aCk7XG4gICAgY29uc3QgY2x1c3RlcmluZ09yZGVyID0gW107XG5cbiAgICBmb3IgKGxldCBmaWVsZCA9IDA7IGZpZWxkIDwgY2x1c3RlcmluZ0tleS5sZW5ndGg7IGZpZWxkKyspIHtcbiAgICAgIGlmICh2aWV3U2NoZW1hLmNsdXN0ZXJpbmdfb3JkZXJcbiAgICAgICAgICAmJiB2aWV3U2NoZW1hLmNsdXN0ZXJpbmdfb3JkZXJbY2x1c3RlcmluZ0tleVtmaWVsZF1dXG4gICAgICAgICAgJiYgdmlld1NjaGVtYS5jbHVzdGVyaW5nX29yZGVyW2NsdXN0ZXJpbmdLZXlbZmllbGRdXS50b0xvd2VyQ2FzZSgpID09PSAnZGVzYycpIHtcbiAgICAgICAgY2x1c3RlcmluZ09yZGVyLnB1c2godXRpbC5mb3JtYXQoJ1wiJXNcIiBERVNDJywgY2x1c3RlcmluZ0tleVtmaWVsZF0pKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNsdXN0ZXJpbmdPcmRlci5wdXNoKHV0aWwuZm9ybWF0KCdcIiVzXCIgQVNDJywgY2x1c3RlcmluZ0tleVtmaWVsZF0pKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgY2x1c3RlcmluZ09yZGVyUXVlcnkgPSAnJztcbiAgICBpZiAoY2x1c3RlcmluZ09yZGVyLmxlbmd0aCA+IDApIHtcbiAgICAgIGNsdXN0ZXJpbmdPcmRlclF1ZXJ5ID0gdXRpbC5mb3JtYXQoJyBXSVRIIENMVVNURVJJTkcgT1JERVIgQlkgKCVzKScsIGNsdXN0ZXJpbmdPcmRlci50b1N0cmluZygpKTtcbiAgICB9XG5cbiAgICBpZiAoXy5pc0FycmF5KHBhcnRpdGlvbktleSkpIHtcbiAgICAgIHBhcnRpdGlvbktleSA9IHBhcnRpdGlvbktleS5tYXAoKHYpID0+IHV0aWwuZm9ybWF0KCdcIiVzXCInLCB2KSkuam9pbignLCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXJ0aXRpb25LZXkgPSB1dGlsLmZvcm1hdCgnXCIlc1wiJywgcGFydGl0aW9uS2V5KTtcbiAgICB9XG5cbiAgICBpZiAoY2x1c3RlcmluZ0tleS5sZW5ndGgpIHtcbiAgICAgIGNsdXN0ZXJpbmdLZXkgPSBjbHVzdGVyaW5nS2V5Lm1hcCgodikgPT4gKHV0aWwuZm9ybWF0KCdcIiVzXCInLCB2KSkpLmpvaW4oJywnKTtcbiAgICAgIGNsdXN0ZXJpbmdLZXkgPSB1dGlsLmZvcm1hdCgnLCVzJywgY2x1c3RlcmluZ0tleSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNsdXN0ZXJpbmdLZXkgPSAnJztcbiAgICB9XG5cbiAgICBsZXQgd2hlcmVDbGF1c2UgPSBwYXJ0aXRpb25LZXkuc3BsaXQoJywnKS5qb2luKCcgSVMgTk9UIE5VTEwgQU5EICcpO1xuICAgIGlmIChjbHVzdGVyaW5nS2V5KSB3aGVyZUNsYXVzZSArPSBjbHVzdGVyaW5nS2V5LnNwbGl0KCcsJykuam9pbignIElTIE5PVCBOVUxMIEFORCAnKTtcbiAgICB3aGVyZUNsYXVzZSArPSAnIElTIE5PVCBOVUxMJztcblxuICAgIGNvbnN0IHF1ZXJ5ID0gdXRpbC5mb3JtYXQoXG4gICAgICAnQ1JFQVRFIE1BVEVSSUFMSVpFRCBWSUVXIElGIE5PVCBFWElTVFMgXCIlc1wiIEFTIFNFTEVDVCAlcyBGUk9NIFwiJXNcIiBXSEVSRSAlcyBQUklNQVJZIEtFWSgoJXMpJXMpJXM7JyxcbiAgICAgIHZpZXdOYW1lLFxuICAgICAgcm93cy5qb2luKCcgLCAnKSxcbiAgICAgIHRhYmxlTmFtZSxcbiAgICAgIHdoZXJlQ2xhdXNlLFxuICAgICAgcGFydGl0aW9uS2V5LFxuICAgICAgY2x1c3RlcmluZ0tleSxcbiAgICAgIGNsdXN0ZXJpbmdPcmRlclF1ZXJ5LFxuICAgICk7XG5cbiAgICByZXR1cm4gcXVlcnk7XG4gIH0sXG5cbiAgY3JlYXRlX212aWV3cyhtYXRlcmlhbGl6ZWRWaWV3cywgY2FsbGJhY2spIHtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydGllcztcbiAgICBjb25zdCB0YWJsZU5hbWUgPSBwcm9wZXJ0aWVzLnRhYmxlX25hbWU7XG4gICAgYXN5bmMuZWFjaFNlcmllcyhPYmplY3Qua2V5cyhtYXRlcmlhbGl6ZWRWaWV3cyksICh2aWV3TmFtZSwgbmV4dCkgPT4ge1xuICAgICAgY29uc3QgbWF0Vmlld1F1ZXJ5ID0gdGhpcy5fY3JlYXRlX21hdGVyaWFsaXplZF92aWV3X3F1ZXJ5KFxuICAgICAgICB0YWJsZU5hbWUsXG4gICAgICAgIHZpZXdOYW1lLFxuICAgICAgICBtYXRlcmlhbGl6ZWRWaWV3c1t2aWV3TmFtZV0sXG4gICAgICApO1xuICAgICAgdGhpcy5fZHJpdmVyLmV4ZWN1dGVfZGVmaW5pdGlvbl9xdWVyeShtYXRWaWV3UXVlcnksIFtdLCAoZXJyLCByZXN1bHQpID0+IHtcbiAgICAgICAgaWYgKGVycikgbmV4dChidWlsZEVycm9yKCdtb2RlbC50YWJsZWNyZWF0aW9uLm1hdHZpZXdjcmVhdGUnLCBlcnIpKTtcbiAgICAgICAgZWxzZSBuZXh0KG51bGwsIHJlc3VsdCk7XG4gICAgICB9KTtcbiAgICB9LCBjYWxsYmFjayk7XG4gIH0sXG5cbiAgZHJvcF9tdmlld3MobXZpZXdzLCBjYWxsYmFjaykge1xuICAgIGFzeW5jLmVhY2gobXZpZXdzLCAodmlldywgbmV4dCkgPT4ge1xuICAgICAgY29uc3QgcXVlcnkgPSB1dGlsLmZvcm1hdCgnRFJPUCBNQVRFUklBTElaRUQgVklFVyBJRiBFWElTVFMgXCIlc1wiOycsIHZpZXcpO1xuICAgICAgdGhpcy5fZHJpdmVyLmV4ZWN1dGVfZGVmaW5pdGlvbl9xdWVyeShxdWVyeSwgW10sIG5leHQpO1xuICAgIH0sIChlcnIpID0+IHtcbiAgICAgIGlmIChlcnIpIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLnRhYmxlY3JlYXRpb24ubWF0dmlld2Ryb3AnLCBlcnIpKTtcbiAgICAgIGVsc2UgY2FsbGJhY2soKTtcbiAgICB9KTtcbiAgfSxcblxuICBfYXBwbHlfYWx0ZXJfb3BlcmF0aW9ucyhhbHRlck9wZXJhdGlvbnMsIGRiU2NoZW1hLCBub3JtYWxpemVkTW9kZWxTY2hlbWEsIG5vcm1hbGl6ZWREQlNjaGVtYSwgY2FsbGJhY2spIHtcbiAgICAvLyBpdCBzaG91bGQgY3JlYXRlL2Ryb3AgaW5kZXhlcy9jdXN0b21faW5kZXhlcy9tYXRlcmlhbGl6ZWRfdmlld3MgdGhhdCBhcmUgYWRkZWQvcmVtb3ZlZCBpbiBtb2RlbCBzY2hlbWFcbiAgICAvLyByZW1vdmUgY29tbW9uIGluZGV4ZXMvY3VzdG9tX2luZGV4ZXMvbWF0ZXJpYWxpemVkX3ZpZXdzIGZyb20gbm9ybWFsaXplZE1vZGVsU2NoZW1hIGFuZCBub3JtYWxpemVkREJTY2hlbWFcbiAgICAvLyB0aGVuIGRyb3AgYWxsIHJlbWFpbmluZyBpbmRleGVzL2N1c3RvbV9pbmRleGVzL21hdGVyaWFsaXplZF92aWV3cyBmcm9tIG5vcm1hbGl6ZWREQlNjaGVtYVxuICAgIC8vIGFuZCBhZGQgYWxsIHJlbWFpbmluZyBpbmRleGVzL2N1c3RvbV9pbmRleGVzL21hdGVyaWFsaXplZF92aWV3cyBmcm9tIG5vcm1hbGl6ZWRNb2RlbFNjaGVtYVxuICAgIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLl9wcm9wZXJ0aWVzO1xuICAgIGNvbnN0IHRhYmxlTmFtZSA9IHByb3BlcnRpZXMudGFibGVfbmFtZTtcbiAgICBjb25zdCBhZGRlZEluZGV4ZXMgPSBfLmRpZmZlcmVuY2Uobm9ybWFsaXplZE1vZGVsU2NoZW1hLmluZGV4ZXMsIG5vcm1hbGl6ZWREQlNjaGVtYS5pbmRleGVzKTtcbiAgICBjb25zdCByZW1vdmVkSW5kZXhlcyA9IF8uZGlmZmVyZW5jZShub3JtYWxpemVkREJTY2hlbWEuaW5kZXhlcywgbm9ybWFsaXplZE1vZGVsU2NoZW1hLmluZGV4ZXMpO1xuICAgIGNvbnN0IHJlbW92ZWRJbmRleE5hbWVzID0gW107XG4gICAgcmVtb3ZlZEluZGV4ZXMuZm9yRWFjaCgocmVtb3ZlZEluZGV4KSA9PiB7XG4gICAgICByZW1vdmVkSW5kZXhOYW1lcy5wdXNoKGRiU2NoZW1hLmluZGV4X25hbWVzW3JlbW92ZWRJbmRleF0pO1xuICAgIH0pO1xuXG4gICAgY29uc3QgYWRkZWRDdXN0b21JbmRleGVzID0gXy5maWx0ZXIoXG4gICAgICBub3JtYWxpemVkTW9kZWxTY2hlbWEuY3VzdG9tX2luZGV4ZXMsXG4gICAgICAob2JqKSA9PiAoIV8uZmluZChub3JtYWxpemVkREJTY2hlbWEuY3VzdG9tX2luZGV4ZXMsIG9iaikpLFxuICAgICk7XG4gICAgY29uc3QgcmVtb3ZlZEN1c3RvbUluZGV4ZXMgPSBfLmZpbHRlcihcbiAgICAgIG5vcm1hbGl6ZWREQlNjaGVtYS5jdXN0b21faW5kZXhlcyxcbiAgICAgIChvYmopID0+ICghXy5maW5kKG5vcm1hbGl6ZWRNb2RlbFNjaGVtYS5jdXN0b21faW5kZXhlcywgb2JqKSksXG4gICAgKTtcbiAgICByZW1vdmVkQ3VzdG9tSW5kZXhlcy5mb3JFYWNoKChyZW1vdmVkSW5kZXgpID0+IHtcbiAgICAgIHJlbW92ZWRJbmRleE5hbWVzLnB1c2goZGJTY2hlbWEuaW5kZXhfbmFtZXNbb2JqZWN0SGFzaChyZW1vdmVkSW5kZXgpXSk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBhZGRlZE1hdGVyaWFsaXplZFZpZXdzTmFtZXMgPSBfLmZpbHRlcihcbiAgICAgIE9iamVjdC5rZXlzKG5vcm1hbGl6ZWRNb2RlbFNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3MpLFxuICAgICAgKHZpZXdOYW1lKSA9PiAoIV8uaXNFcXVhbChcbiAgICAgICAgbm9ybWFsaXplZERCU2NoZW1hLm1hdGVyaWFsaXplZF92aWV3c1t2aWV3TmFtZV0sXG4gICAgICAgIG5vcm1hbGl6ZWRNb2RlbFNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3Nbdmlld05hbWVdLFxuICAgICAgKSksXG4gICAgKTtcblxuICAgIGNvbnN0IHJlbW92ZWRNYXRlcmlhbGl6ZWRWaWV3TmFtZXMgPSBfLmZpbHRlcihcbiAgICAgIE9iamVjdC5rZXlzKG5vcm1hbGl6ZWREQlNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3MpLFxuICAgICAgKHZpZXdOYW1lKSA9PiAoIV8uaXNFcXVhbChcbiAgICAgICAgbm9ybWFsaXplZERCU2NoZW1hLm1hdGVyaWFsaXplZF92aWV3c1t2aWV3TmFtZV0sXG4gICAgICAgIG5vcm1hbGl6ZWRNb2RlbFNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3Nbdmlld05hbWVdLFxuICAgICAgKSksXG4gICAgKTtcblxuICAgIGNvbnN0IGFkZGVkTWF0ZXJpYWxpemVkVmlld3MgPSB7fTtcbiAgICBhZGRlZE1hdGVyaWFsaXplZFZpZXdzTmFtZXMuZm9yRWFjaCgodmlld05hbWUpID0+IHtcbiAgICAgIGFkZGVkTWF0ZXJpYWxpemVkVmlld3Nbdmlld05hbWVdID0gbm9ybWFsaXplZE1vZGVsU2NoZW1hLm1hdGVyaWFsaXplZF92aWV3c1t2aWV3TmFtZV07XG4gICAgfSk7XG5cbiAgICAvLyByZW1vdmUgYWx0ZXJlZCBtYXRlcmlhbGl6ZWQgdmlld3NcbiAgICBpZiAocmVtb3ZlZE1hdGVyaWFsaXplZFZpZXdOYW1lcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gdXRpbC5mb3JtYXQoXG4gICAgICAgICdTY2hlbWEgZm9yIHRhYmxlIFwiJXNcIiBoYXMgcmVtb3ZlZCBtYXRlcmlhbGl6ZWRfdmlld3M6ICVqLCBhcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZHJvcCB0aGVtPycsXG4gICAgICAgIHRhYmxlTmFtZSxcbiAgICAgICAgcmVtb3ZlZE1hdGVyaWFsaXplZFZpZXdOYW1lcyxcbiAgICAgICk7XG4gICAgICBjb25zdCBwZXJtaXNzaW9uID0gdGhpcy5fY29uZmlybV9taWdyYXRpb24obWVzc2FnZSk7XG4gICAgICBpZiAocGVybWlzc2lvbiAhPT0gJ3knKSB7XG4gICAgICAgIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLnRhYmxlY3JlYXRpb24uc2NoZW1hbWlzbWF0Y2gnLCB0YWJsZU5hbWUsICdtaWdyYXRpb24gc3VzcGVuZGVkLCBwbGVhc2UgYXBwbHkgdGhlIGNoYW5nZSBtYW51YWxseScpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuZHJvcF9tdmlld3MocmVtb3ZlZE1hdGVyaWFsaXplZFZpZXdOYW1lcywgKGVycjIpID0+IHtcbiAgICAgIGlmIChlcnIyKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycjIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChyZW1vdmVkSW5kZXhOYW1lcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB1dGlsLmZvcm1hdChcbiAgICAgICAgICAnU2NoZW1hIGZvciB0YWJsZSBcIiVzXCIgaGFzIHJlbW92ZWQgaW5kZXhlczogJWosIGFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkcm9wIHRoZW0/JyxcbiAgICAgICAgICB0YWJsZU5hbWUsXG4gICAgICAgICAgcmVtb3ZlZEluZGV4TmFtZXMsXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHBlcm1pc3Npb24gPSB0aGlzLl9jb25maXJtX21pZ3JhdGlvbihtZXNzYWdlKTtcbiAgICAgICAgaWYgKHBlcm1pc3Npb24gIT09ICd5Jykge1xuICAgICAgICAgIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLnRhYmxlY3JlYXRpb24uc2NoZW1hbWlzbWF0Y2gnLCB0YWJsZU5hbWUsICdtaWdyYXRpb24gc3VzcGVuZGVkLCBwbGVhc2UgYXBwbHkgdGhlIGNoYW5nZSBtYW51YWxseScpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gcmVtb3ZlIGFsdGVyZWQgaW5kZXhlcyBieSBpbmRleCBuYW1lXG4gICAgICB0aGlzLmRyb3BfaW5kZXhlcyhyZW1vdmVkSW5kZXhOYW1lcywgKGVycjMpID0+IHtcbiAgICAgICAgaWYgKGVycjMpIHtcbiAgICAgICAgICBjYWxsYmFjayhlcnIzKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBub3cgYXBwbHkgYWx0ZXJPcGVyYXRpb25zIGhlcmVcbiAgICAgICAgYXN5bmMuZWFjaFNlcmllcyhhbHRlck9wZXJhdGlvbnMsIChhbHRlck9wZXJhdGlvbiwgbmV4dCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHBlcm1pc3Npb24gPSB0aGlzLl9jb25maXJtX21pZ3JhdGlvbihhbHRlck9wZXJhdGlvbi5tZXNzYWdlKTtcbiAgICAgICAgICBpZiAocGVybWlzc2lvbiAhPT0gJ3knKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhidWlsZEVycm9yKCdtb2RlbC50YWJsZWNyZWF0aW9uLnNjaGVtYW1pc21hdGNoJywgdGFibGVOYW1lLCAnbWlncmF0aW9uIHN1c3BlbmRlZCwgcGxlYXNlIGFwcGx5IHRoZSBjaGFuZ2UgbWFudWFsbHknKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuYWx0ZXJfdGFibGUoYWx0ZXJPcGVyYXRpb24ub3BlcmF0aW9uLCBhbHRlck9wZXJhdGlvbi5maWVsZE5hbWUsIGFsdGVyT3BlcmF0aW9uLnR5cGUsIG5leHQpO1xuICAgICAgICB9LCAoZXJyNCkgPT4ge1xuICAgICAgICAgIGlmIChlcnI0KSB7XG4gICAgICAgICAgICBjYWxsYmFjayhlcnI0KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBhZGQgYWx0ZXJlZCBpbmRleGVzXG4gICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1uZXN0ZWQtY2FsbGJhY2tzXG4gICAgICAgICAgdGhpcy5jcmVhdGVfaW5kZXhlcyhhZGRlZEluZGV4ZXMsIChlcnI1KSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyNSkge1xuICAgICAgICAgICAgICBjYWxsYmFjayhlcnI1KTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBhZGQgYWx0ZXJlZCBjdXN0b20gaW5kZXhlc1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1uZXN0ZWQtY2FsbGJhY2tzXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZV9jdXN0b21faW5kZXhlcyhhZGRlZEN1c3RvbUluZGV4ZXMsIChlcnI2KSA9PiB7XG4gICAgICAgICAgICAgIGlmIChlcnI2KSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyNik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8gYWRkIGFsdGVyZWQgbWF0ZXJpYWxpemVkX3ZpZXdzXG4gICAgICAgICAgICAgIHRoaXMuY3JlYXRlX212aWV3cyhhZGRlZE1hdGVyaWFsaXplZFZpZXdzLCBjYWxsYmFjayk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSxcblxuICBpbml0X2FsdGVyX29wZXJhdGlvbnMobW9kZWxTY2hlbWEsIGRiU2NoZW1hLCBub3JtYWxpemVkTW9kZWxTY2hlbWEsIG5vcm1hbGl6ZWREQlNjaGVtYSwgY2FsbGJhY2spIHtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydGllcztcbiAgICBjb25zdCB0YWJsZU5hbWUgPSBwcm9wZXJ0aWVzLnRhYmxlX25hbWU7XG4gICAgY29uc3QgYWx0ZXJPcGVyYXRpb25zID0gW107XG4gICAgY29uc3QgZGlmZmVyZW5jZXMgPSBkZWVwRGlmZihub3JtYWxpemVkREJTY2hlbWEuZmllbGRzLCBub3JtYWxpemVkTW9kZWxTY2hlbWEuZmllbGRzKTtcbiAgICBsZXQgZHJvcHBlZEZpZWxkcyA9IGZhbHNlO1xuICAgIGFzeW5jLmVhY2hTZXJpZXMoZGlmZmVyZW5jZXMsIChkaWZmLCBuZXh0KSA9PiB7XG4gICAgICBjb25zdCBmaWVsZE5hbWUgPSBkaWZmLnBhdGhbMF07XG4gICAgICBpZiAoZGlmZi5raW5kID09PSAnTicpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHV0aWwuZm9ybWF0KFxuICAgICAgICAgICdTY2hlbWEgZm9yIHRhYmxlIFwiJXNcIiBoYXMgYWRkZWQgZmllbGQgXCIlc1wiLCBhcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gYWx0ZXIgdG8gYWRkIHRoZSBmaWVsZD8nLFxuICAgICAgICAgIHRhYmxlTmFtZSxcbiAgICAgICAgICBmaWVsZE5hbWUsXG4gICAgICAgICk7XG4gICAgICAgIGFsdGVyT3BlcmF0aW9ucy5wdXNoKHtcbiAgICAgICAgICBmaWVsZE5hbWUsXG4gICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICBvcGVyYXRpb246ICdBREQnLFxuICAgICAgICAgIHR5cGU6IHBhcnNlci5leHRyYWN0X2FsdGVyZWRfdHlwZShub3JtYWxpemVkTW9kZWxTY2hlbWEsIGRpZmYpLFxuICAgICAgICB9KTtcbiAgICAgICAgbmV4dCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoZGlmZi5raW5kID09PSAnRCcpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHV0aWwuZm9ybWF0KFxuICAgICAgICAgICdTY2hlbWEgZm9yIHRhYmxlIFwiJXNcIiBoYXMgcmVtb3ZlZCBmaWVsZCBcIiVzXCIsIGFsbCBkYXRhIGluIHRoZSBmaWVsZCB3aWxsIGxvc3QsIGFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBhbHRlciB0byBkcm9wIHRoZSBmaWVsZD8nLFxuICAgICAgICAgIHRhYmxlTmFtZSxcbiAgICAgICAgICBmaWVsZE5hbWUsXG4gICAgICAgICk7XG4gICAgICAgIGFsdGVyT3BlcmF0aW9ucy5wdXNoKHtcbiAgICAgICAgICBmaWVsZE5hbWUsXG4gICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICBvcGVyYXRpb246ICdEUk9QJyxcbiAgICAgICAgfSk7XG4gICAgICAgIGRyb3BwZWRGaWVsZHMgPSB0cnVlO1xuICAgICAgICBub3JtYWxpemVyLnJlbW92ZV9kZXBlbmRlbnRfdmlld3NfZnJvbV9ub3JtYWxpemVkX3NjaGVtYShub3JtYWxpemVkREJTY2hlbWEsIGRiU2NoZW1hLCBmaWVsZE5hbWUpO1xuICAgICAgICBuZXh0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChkaWZmLmtpbmQgPT09ICdFJykge1xuICAgICAgICAvLyBjaGVjayBpZiB0aGUgYWx0ZXIgZmllbGQgdHlwZSBpcyBwb3NzaWJsZSwgb3RoZXJ3aXNlIHRyeSBEIGFuZCB0aGVuIE5cbiAgICAgICAgaWYgKGRpZmYucGF0aFsxXSA9PT0gJ3R5cGUnKSB7XG4gICAgICAgICAgLy8gY2hlY2sgaWYgZmllbGQgcGFydCBvZiBwcmltYXJ5IGtleVxuICAgICAgICAgIGlmIChub3JtYWxpemVkREJTY2hlbWEua2V5WzBdLmluY2x1ZGVzKGZpZWxkTmFtZSkgfHwgbm9ybWFsaXplZERCU2NoZW1hLmtleS5pbmRleE9mKGZpZWxkTmFtZSkgPiAwKSB7XG4gICAgICAgICAgICAvLyBhbHRlciBmaWVsZCB0eXBlIGltcG9zc2libGVcbiAgICAgICAgICAgIG5leHQobmV3IEVycm9yKCdhbHRlcl9pbXBvc3NpYmxlJykpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoWyd0ZXh0JywgJ2FzY2lpJywgJ2JpZ2ludCcsICdib29sZWFuJywgJ2RlY2ltYWwnLFxuICAgICAgICAgICAgJ2RvdWJsZScsICdmbG9hdCcsICdpbmV0JywgJ2ludCcsICd0aW1lc3RhbXAnLCAndGltZXV1aWQnLFxuICAgICAgICAgICAgJ3V1aWQnLCAndmFyY2hhcicsICd2YXJpbnQnXS5pbmNsdWRlcyhkaWZmLmxocykgJiYgZGlmZi5yaHMgPT09ICdibG9iJykge1xuICAgICAgICAgICAgLy8gYWx0ZXIgZmllbGQgdHlwZSBwb3NzaWJsZVxuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHV0aWwuZm9ybWF0KFxuICAgICAgICAgICAgICAnU2NoZW1hIGZvciB0YWJsZSBcIiVzXCIgaGFzIG5ldyB0eXBlIGZvciBmaWVsZCBcIiVzXCIsIGFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBhbHRlciB0byB1cGRhdGUgdGhlIGZpZWxkIHR5cGU/JyxcbiAgICAgICAgICAgICAgdGFibGVOYW1lLFxuICAgICAgICAgICAgICBmaWVsZE5hbWUsXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgYWx0ZXJPcGVyYXRpb25zLnB1c2goe1xuICAgICAgICAgICAgICBmaWVsZE5hbWUsXG4gICAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICAgIG9wZXJhdGlvbjogJ0FMVEVSJyxcbiAgICAgICAgICAgICAgdHlwZTogZGlmZi5yaHMsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGRpZmYubGhzID09PSAnaW50JyAmJiBkaWZmLnJocyA9PT0gJ3ZhcmludCcpIHtcbiAgICAgICAgICAgIC8vIGFsdGVyIGZpZWxkIHR5cGUgcG9zc2libGVcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB1dGlsLmZvcm1hdChcbiAgICAgICAgICAgICAgJ1NjaGVtYSBmb3IgdGFibGUgXCIlc1wiIGhhcyBuZXcgdHlwZSBmb3IgZmllbGQgXCIlc1wiLCBhcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gYWx0ZXIgdG8gdXBkYXRlIHRoZSBmaWVsZCB0eXBlPycsXG4gICAgICAgICAgICAgIHRhYmxlTmFtZSxcbiAgICAgICAgICAgICAgZmllbGROYW1lLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGFsdGVyT3BlcmF0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgZmllbGROYW1lLFxuICAgICAgICAgICAgICBtZXNzYWdlLFxuICAgICAgICAgICAgICBvcGVyYXRpb246ICdBTFRFUicsXG4gICAgICAgICAgICAgIHR5cGU6IGRpZmYucmhzLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChkaWZmLmxocyA9PT0gJ3RpbWV1dWlkJyAmJiBkaWZmLnJocyA9PT0gJ3V1aWQnKSB7XG4gICAgICAgICAgICAvLyBhbHRlciBmaWVsZCB0eXBlIHBvc3NpYmxlXG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gdXRpbC5mb3JtYXQoXG4gICAgICAgICAgICAgICdTY2hlbWEgZm9yIHRhYmxlIFwiJXNcIiBoYXMgbmV3IHR5cGUgZm9yIGZpZWxkIFwiJXNcIiwgYXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGFsdGVyIHRvIHVwZGF0ZSB0aGUgZmllbGQgdHlwZT8nLFxuICAgICAgICAgICAgICB0YWJsZU5hbWUsXG4gICAgICAgICAgICAgIGZpZWxkTmFtZSxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBhbHRlck9wZXJhdGlvbnMucHVzaCh7XG4gICAgICAgICAgICAgIGZpZWxkTmFtZSxcbiAgICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgICAgb3BlcmF0aW9uOiAnQUxURVInLFxuICAgICAgICAgICAgICB0eXBlOiBkaWZmLnJocyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBhbHRlciB0eXBlIGltcG9zc2libGVcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB1dGlsLmZvcm1hdChcbiAgICAgICAgICAgICAgJ1NjaGVtYSBmb3IgdGFibGUgXCIlc1wiIGhhcyBuZXcgdHlwZSBmb3IgZmllbGQgXCIlc1wiLCBhbGwgZGF0YSBpbiB0aGUgZmllbGQgd2lsbCBiZSBsb3N0LCBhcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZHJvcCB0aGUgZmllbGQgJiByZWNyZWF0ZSBpdD8nLFxuICAgICAgICAgICAgICB0YWJsZU5hbWUsXG4gICAgICAgICAgICAgIGZpZWxkTmFtZSxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBhbHRlck9wZXJhdGlvbnMucHVzaCh7XG4gICAgICAgICAgICAgIGZpZWxkTmFtZSxcbiAgICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgICAgb3BlcmF0aW9uOiAnRFJPUCcsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGFsdGVyT3BlcmF0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgZmllbGROYW1lLFxuICAgICAgICAgICAgICBvcGVyYXRpb246ICdBREQnLFxuICAgICAgICAgICAgICB0eXBlOiBwYXJzZXIuZXh0cmFjdF9hbHRlcmVkX3R5cGUobm9ybWFsaXplZE1vZGVsU2NoZW1hLCBkaWZmKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZHJvcHBlZEZpZWxkcyA9IHRydWU7XG4gICAgICAgICAgICBub3JtYWxpemVyLnJlbW92ZV9kZXBlbmRlbnRfdmlld3NfZnJvbV9ub3JtYWxpemVkX3NjaGVtYShub3JtYWxpemVkREJTY2hlbWEsIGRiU2NoZW1hLCBmaWVsZE5hbWUpO1xuICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBhbHRlciB0eXBlIGltcG9zc2libGVcbiAgICAgICAgICBjb25zdCBtZXNzYWdlID0gdXRpbC5mb3JtYXQoXG4gICAgICAgICAgICAnU2NoZW1hIGZvciB0YWJsZSBcIiVzXCIgaGFzIG5ldyB0eXBlIGZvciBmaWVsZCBcIiVzXCIsIGFsbCBkYXRhIGluIHRoZSBmaWVsZCB3aWxsIGJlIGxvc3QsIGFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkcm9wIHRoZSBmaWVsZCAmIHJlY3JlYXRlIGl0PycsXG4gICAgICAgICAgICB0YWJsZU5hbWUsXG4gICAgICAgICAgICBmaWVsZE5hbWUsXG4gICAgICAgICAgKTtcbiAgICAgICAgICBhbHRlck9wZXJhdGlvbnMucHVzaCh7XG4gICAgICAgICAgICBmaWVsZE5hbWUsXG4gICAgICAgICAgICBtZXNzYWdlLFxuICAgICAgICAgICAgb3BlcmF0aW9uOiAnRFJPUCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYWx0ZXJPcGVyYXRpb25zLnB1c2goe1xuICAgICAgICAgICAgZmllbGROYW1lLFxuICAgICAgICAgICAgb3BlcmF0aW9uOiAnQUREJyxcbiAgICAgICAgICAgIHR5cGU6IHBhcnNlci5leHRyYWN0X2FsdGVyZWRfdHlwZShub3JtYWxpemVkTW9kZWxTY2hlbWEsIGRpZmYpLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGRyb3BwZWRGaWVsZHMgPSB0cnVlO1xuICAgICAgICAgIG5vcm1hbGl6ZXIucmVtb3ZlX2RlcGVuZGVudF92aWV3c19mcm9tX25vcm1hbGl6ZWRfc2NoZW1hKG5vcm1hbGl6ZWREQlNjaGVtYSwgZGJTY2hlbWEsIGZpZWxkTmFtZSk7XG4gICAgICAgICAgbmV4dCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbmV4dCgpO1xuICAgIH0sIChlcnIpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKGRyb3BwZWRGaWVsZHMgJiYgdGhpcy5fZXNfYnVpbGRlcikge1xuICAgICAgICB0aGlzLl9lc19idWlsZGVyLmRlbGV0ZV9pbmRleChwcm9wZXJ0aWVzLmtleXNwYWNlLCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5fYXBwbHlfYWx0ZXJfb3BlcmF0aW9ucyhhbHRlck9wZXJhdGlvbnMsIGRiU2NoZW1hLCBub3JtYWxpemVkTW9kZWxTY2hlbWEsIG5vcm1hbGl6ZWREQlNjaGVtYSwgY2FsbGJhY2spO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5fYXBwbHlfYWx0ZXJfb3BlcmF0aW9ucyhhbHRlck9wZXJhdGlvbnMsIGRiU2NoZW1hLCBub3JtYWxpemVkTW9kZWxTY2hlbWEsIG5vcm1hbGl6ZWREQlNjaGVtYSwgY2FsbGJhY2spO1xuICAgIH0pO1xuICB9LFxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBUYWJsZUJ1aWxkZXI7XG4iXX0=