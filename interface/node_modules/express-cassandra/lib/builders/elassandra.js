'use strict';

var debug = require('debug')('express-cassandra');

var ElassandraBuilder = function f(client) {
  this._client = client;
};

ElassandraBuilder.prototype = {
  create_index(indexName, callback) {
    debug('creating elassandra index: %s', indexName);
    this._client.indices.create({
      index: indexName,
      body: {
        settings: {
          keyspace: indexName
        }
      }
    }, function (err) {
      if (err) {
        callback(err);
        return;
      }

      callback();
    });
  },

  check_index_exist(indexName, callback) {
    debug('check for elassandra index: %s', indexName);
    this._client.indices.exists({ index: indexName }, function (err, res) {
      if (err) {
        callback(err);
        return;
      }

      callback(null, res);
    });
  },

  assert_index(indexName, callback) {
    var _this = this;

    this.check_index_exist(indexName, function (err, exist) {
      if (err) {
        callback(err);
        return;
      }

      if (!exist) {
        _this.create_index(indexName, callback);
        return;
      }

      callback();
    });
  },

  delete_index(indexName, callback) {
    debug('removing elassandra index: %s', indexName);
    this._client.indices.delete({
      index: indexName
    }, function (err) {
      if (err) {
        callback(err);
        return;
      }

      callback();
    });
  },

  put_mapping(indexName, mappingName, mappingBody, callback) {
    debug('syncing elassandra mapping: %s', mappingName);
    this._client.indices.putMapping({
      index: indexName,
      type: mappingName,
      body: mappingBody
    }, function (err) {
      if (err) {
        callback(err);
        return;
      }

      callback();
    });
  }
};

module.exports = ElassandraBuilder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9idWlsZGVycy9lbGFzc2FuZHJhLmpzIl0sIm5hbWVzIjpbImRlYnVnIiwicmVxdWlyZSIsIkVsYXNzYW5kcmFCdWlsZGVyIiwiZiIsImNsaWVudCIsIl9jbGllbnQiLCJwcm90b3R5cGUiLCJjcmVhdGVfaW5kZXgiLCJpbmRleE5hbWUiLCJjYWxsYmFjayIsImluZGljZXMiLCJjcmVhdGUiLCJpbmRleCIsImJvZHkiLCJzZXR0aW5ncyIsImtleXNwYWNlIiwiZXJyIiwiY2hlY2tfaW5kZXhfZXhpc3QiLCJleGlzdHMiLCJyZXMiLCJhc3NlcnRfaW5kZXgiLCJleGlzdCIsImRlbGV0ZV9pbmRleCIsImRlbGV0ZSIsInB1dF9tYXBwaW5nIiwibWFwcGluZ05hbWUiLCJtYXBwaW5nQm9keSIsInB1dE1hcHBpbmciLCJ0eXBlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxRQUFRQyxRQUFRLE9BQVIsRUFBaUIsbUJBQWpCLENBQWQ7O0FBRUEsSUFBTUMsb0JBQW9CLFNBQVNDLENBQVQsQ0FBV0MsTUFBWCxFQUFtQjtBQUMzQyxPQUFLQyxPQUFMLEdBQWVELE1BQWY7QUFDRCxDQUZEOztBQUlBRixrQkFBa0JJLFNBQWxCLEdBQThCO0FBQzVCQyxlQUFhQyxTQUFiLEVBQXdCQyxRQUF4QixFQUFrQztBQUNoQ1QsVUFBTSwrQkFBTixFQUF1Q1EsU0FBdkM7QUFDQSxTQUFLSCxPQUFMLENBQWFLLE9BQWIsQ0FBcUJDLE1BQXJCLENBQTRCO0FBQzFCQyxhQUFPSixTQURtQjtBQUUxQkssWUFBTTtBQUNKQyxrQkFBVTtBQUNSQyxvQkFBVVA7QUFERjtBQUROO0FBRm9CLEtBQTVCLEVBT0csVUFBQ1EsR0FBRCxFQUFTO0FBQ1YsVUFBSUEsR0FBSixFQUFTO0FBQ1BQLGlCQUFTTyxHQUFUO0FBQ0E7QUFDRDs7QUFFRFA7QUFDRCxLQWREO0FBZUQsR0FsQjJCOztBQW9CNUJRLG9CQUFrQlQsU0FBbEIsRUFBNkJDLFFBQTdCLEVBQXVDO0FBQ3JDVCxVQUFNLGdDQUFOLEVBQXdDUSxTQUF4QztBQUNBLFNBQUtILE9BQUwsQ0FBYUssT0FBYixDQUFxQlEsTUFBckIsQ0FBNEIsRUFBRU4sT0FBT0osU0FBVCxFQUE1QixFQUFrRCxVQUFDUSxHQUFELEVBQU1HLEdBQU4sRUFBYztBQUM5RCxVQUFJSCxHQUFKLEVBQVM7QUFDUFAsaUJBQVNPLEdBQVQ7QUFDQTtBQUNEOztBQUVEUCxlQUFTLElBQVQsRUFBZVUsR0FBZjtBQUNELEtBUEQ7QUFRRCxHQTlCMkI7O0FBZ0M1QkMsZUFBYVosU0FBYixFQUF3QkMsUUFBeEIsRUFBa0M7QUFBQTs7QUFDaEMsU0FBS1EsaUJBQUwsQ0FBdUJULFNBQXZCLEVBQWtDLFVBQUNRLEdBQUQsRUFBTUssS0FBTixFQUFnQjtBQUNoRCxVQUFJTCxHQUFKLEVBQVM7QUFDUFAsaUJBQVNPLEdBQVQ7QUFDQTtBQUNEOztBQUVELFVBQUksQ0FBQ0ssS0FBTCxFQUFZO0FBQ1YsY0FBS2QsWUFBTCxDQUFrQkMsU0FBbEIsRUFBNkJDLFFBQTdCO0FBQ0E7QUFDRDs7QUFFREE7QUFDRCxLQVpEO0FBYUQsR0E5QzJCOztBQWdENUJhLGVBQWFkLFNBQWIsRUFBd0JDLFFBQXhCLEVBQWtDO0FBQ2hDVCxVQUFNLCtCQUFOLEVBQXVDUSxTQUF2QztBQUNBLFNBQUtILE9BQUwsQ0FBYUssT0FBYixDQUFxQmEsTUFBckIsQ0FBNEI7QUFDMUJYLGFBQU9KO0FBRG1CLEtBQTVCLEVBRUcsVUFBQ1EsR0FBRCxFQUFTO0FBQ1YsVUFBSUEsR0FBSixFQUFTO0FBQ1BQLGlCQUFTTyxHQUFUO0FBQ0E7QUFDRDs7QUFFRFA7QUFDRCxLQVREO0FBVUQsR0E1RDJCOztBQThENUJlLGNBQVloQixTQUFaLEVBQXVCaUIsV0FBdkIsRUFBb0NDLFdBQXBDLEVBQWlEakIsUUFBakQsRUFBMkQ7QUFDekRULFVBQU0sZ0NBQU4sRUFBd0N5QixXQUF4QztBQUNBLFNBQUtwQixPQUFMLENBQWFLLE9BQWIsQ0FBcUJpQixVQUFyQixDQUFnQztBQUM5QmYsYUFBT0osU0FEdUI7QUFFOUJvQixZQUFNSCxXQUZ3QjtBQUc5QlosWUFBTWE7QUFId0IsS0FBaEMsRUFJRyxVQUFDVixHQUFELEVBQVM7QUFDVixVQUFJQSxHQUFKLEVBQVM7QUFDUFAsaUJBQVNPLEdBQVQ7QUFDQTtBQUNEOztBQUVEUDtBQUNELEtBWEQ7QUFZRDtBQTVFMkIsQ0FBOUI7O0FBK0VBb0IsT0FBT0MsT0FBUCxHQUFpQjVCLGlCQUFqQiIsImZpbGUiOiJlbGFzc2FuZHJhLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZGVidWcgPSByZXF1aXJlKCdkZWJ1ZycpKCdleHByZXNzLWNhc3NhbmRyYScpO1xuXG5jb25zdCBFbGFzc2FuZHJhQnVpbGRlciA9IGZ1bmN0aW9uIGYoY2xpZW50KSB7XG4gIHRoaXMuX2NsaWVudCA9IGNsaWVudDtcbn07XG5cbkVsYXNzYW5kcmFCdWlsZGVyLnByb3RvdHlwZSA9IHtcbiAgY3JlYXRlX2luZGV4KGluZGV4TmFtZSwgY2FsbGJhY2spIHtcbiAgICBkZWJ1ZygnY3JlYXRpbmcgZWxhc3NhbmRyYSBpbmRleDogJXMnLCBpbmRleE5hbWUpO1xuICAgIHRoaXMuX2NsaWVudC5pbmRpY2VzLmNyZWF0ZSh7XG4gICAgICBpbmRleDogaW5kZXhOYW1lLFxuICAgICAgYm9keToge1xuICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgIGtleXNwYWNlOiBpbmRleE5hbWUsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sIChlcnIpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjYWxsYmFjaygpO1xuICAgIH0pO1xuICB9LFxuXG4gIGNoZWNrX2luZGV4X2V4aXN0KGluZGV4TmFtZSwgY2FsbGJhY2spIHtcbiAgICBkZWJ1ZygnY2hlY2sgZm9yIGVsYXNzYW5kcmEgaW5kZXg6ICVzJywgaW5kZXhOYW1lKTtcbiAgICB0aGlzLl9jbGllbnQuaW5kaWNlcy5leGlzdHMoeyBpbmRleDogaW5kZXhOYW1lIH0sIChlcnIsIHJlcykgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlcyk7XG4gICAgfSk7XG4gIH0sXG5cbiAgYXNzZXJ0X2luZGV4KGluZGV4TmFtZSwgY2FsbGJhY2spIHtcbiAgICB0aGlzLmNoZWNrX2luZGV4X2V4aXN0KGluZGV4TmFtZSwgKGVyciwgZXhpc3QpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWV4aXN0KSB7XG4gICAgICAgIHRoaXMuY3JlYXRlX2luZGV4KGluZGV4TmFtZSwgY2FsbGJhY2spO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfSk7XG4gIH0sXG5cbiAgZGVsZXRlX2luZGV4KGluZGV4TmFtZSwgY2FsbGJhY2spIHtcbiAgICBkZWJ1ZygncmVtb3ZpbmcgZWxhc3NhbmRyYSBpbmRleDogJXMnLCBpbmRleE5hbWUpO1xuICAgIHRoaXMuX2NsaWVudC5pbmRpY2VzLmRlbGV0ZSh7XG4gICAgICBpbmRleDogaW5kZXhOYW1lLFxuICAgIH0sIChlcnIpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjYWxsYmFjaygpO1xuICAgIH0pO1xuICB9LFxuXG4gIHB1dF9tYXBwaW5nKGluZGV4TmFtZSwgbWFwcGluZ05hbWUsIG1hcHBpbmdCb2R5LCBjYWxsYmFjaykge1xuICAgIGRlYnVnKCdzeW5jaW5nIGVsYXNzYW5kcmEgbWFwcGluZzogJXMnLCBtYXBwaW5nTmFtZSk7XG4gICAgdGhpcy5fY2xpZW50LmluZGljZXMucHV0TWFwcGluZyh7XG4gICAgICBpbmRleDogaW5kZXhOYW1lLFxuICAgICAgdHlwZTogbWFwcGluZ05hbWUsXG4gICAgICBib2R5OiBtYXBwaW5nQm9keSxcbiAgICB9LCAoZXJyKSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY2FsbGJhY2soKTtcbiAgICB9KTtcbiAgfSxcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gRWxhc3NhbmRyYUJ1aWxkZXI7XG4iXX0=